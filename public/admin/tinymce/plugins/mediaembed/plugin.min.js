/* Ephox Media Embed
 *
 * Copyright 2010-2017 Ephox Corporation. All rights reserved.
 *
 * Version: 2.0.0-62
 */

!function(a) {
    "use strict";
    var n, r, e, t, o, u, i, c, f, s, l, d, m, p = function(n) {
        return parseInt(n, 10)
    }, h = function(n, r, e) {
        return {
            major: n,
            minor: r,
            patch: e
        }
    }, v = function(n) {
        var r = /([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(n);
        return r ? h(p(r[1]), p(r[2]), p(r[3])) : h(0, 0, 0)
    }, g = function(n, r) {
        var e = n - r;
        return 0 === e ? 0 : 0 < e ? 1 : -1
    }, w = function(n, r) {
        return -1 === function(n, r) {
            var e = g(n.major, r.major);
            if (0 !== e)
                return e;
            var t = g(n.minor, r.minor);
            if (0 !== t)
                return t;
            var o = g(n.patch, r.patch);
            return 0 !== o ? o : 0
        }((e = n) ? v([(t = e).majorVersion, t.minorVersion].join(".").split(".").slice(0, 3).join(".")) : null, v(r));
        var e, t
    }, b = function() {
        for (var n = [], r = 0; r < arguments.length; r++)
            n[r] = arguments[r]
    }, y = function(e, t) {
        return function() {
            for (var n = [], r = 0; r < arguments.length; r++)
                n[r] = arguments[r];
            return e(t.apply(null, n))
        }
    }, x = function(n) {
        return function() {
            return n
        }
    }, E = function(n) {
        return n
    }, O = x(!1), T = x(!0), S = O, N = T, k = function() {
        return j
    }, j = (t = {
        fold: function(n, r) {
            return n()
        },
        is: S,
        isSome: S,
        isNone: N,
        getOr: e = function(n) {
            return n
        }
        ,
        getOrThunk: r = function(n) {
            return n()
        }
        ,
        getOrDie: function(n) {
            throw new Error(n || "error: getOrDie called on none.")
        },
        getOrNull: function() {
            return null
        },
        getOrUndefined: function() {},
        or: e,
        orThunk: r,
        map: k,
        ap: k,
        each: function() {},
        bind: k,
        flatten: k,
        exists: S,
        forall: N,
        filter: k,
        equals: n = function(n) {
            return n.isNone()
        }
        ,
        equals_: n,
        toArray: function() {
            return []
        },
        toString: x("none()")
    },
    Object.freeze && Object.freeze(t),
    t), _ = function(e) {
        var n = function() {
            return e
        }
          , r = function() {
            return o
        }
          , t = function(n) {
            return n(e)
        }
          , o = {
            fold: function(n, r) {
                return r(e)
            },
            is: function(n) {
                return e === n
            },
            isSome: N,
            isNone: S,
            getOr: n,
            getOrThunk: n,
            getOrDie: n,
            getOrNull: n,
            getOrUndefined: n,
            or: r,
            orThunk: r,
            map: function(n) {
                return _(n(e))
            },
            ap: function(n) {
                return n.fold(k, function(n) {
                    return _(n(e))
                })
            },
            each: function(n) {
                n(e)
            },
            bind: t,
            flatten: n,
            exists: t,
            forall: t,
            filter: function(n) {
                return n(e) ? o : j
            },
            equals: function(n) {
                return n.is(e)
            },
            equals_: function(n, r) {
                return n.fold(S, function(n) {
                    return r(e, n)
                })
            },
            toArray: function() {
                return [e]
            },
            toString: function() {
                return "some(" + e + ")"
            }
        };
        return o
    }, D = {
        some: _,
        none: k,
        from: function(n) {
            return null == n ? j : _(n)
        }
    }, A = function(r) {
        return function(n) {
            return function(n) {
                if (null === n)
                    return "null";
                var r = typeof n;
                return "object" === r && Array.prototype.isPrototypeOf(n) ? "array" : "object" === r && String.prototype.isPrototypeOf(n) ? "string" : r
            }(n) === r
        }
    }, C = A("string"), R = A("object"), I = A("array"), M = A("boolean"), P = A("function"), F = A("number"), L = void 0 === (o = Array.prototype.indexOf) ? function(n, r) {
        return B(n, r)
    }
    : function(n, r) {
        return o.call(n, r)
    }
    , q = function(n, r) {
        return -1 < L(n, r)
    }, V = function(n, r) {
        for (var e = n.length, t = new Array(e), o = 0; o < e; o++) {
            var u = n[o];
            t[o] = r(u, o, n)
        }
        return t
    }, W = function(n, r) {
        for (var e = 0, t = n.length; e < t; e++)
            r(n[e], e, n)
    }, H = function(n, r) {
        for (var e = 0, t = n.length; e < t; e++) {
            var o = n[e];
            if (r(o, e, n))
                return D.some(o)
        }
        return D.none()
    }, U = function(n, r) {
        for (var e = 0, t = n.length; e < t; e++)
            if (r(n[e], e, n))
                return D.some(e);
        return D.none()
    }, B = function(n, r) {
        for (var e = 0, t = n.length; e < t; ++e)
            if (n[e] === r)
                return e;
        return -1
    }, z = Array.prototype.push, X = function(n) {
        for (var r = [], e = 0, t = n.length; e < t; ++e) {
            if (!Array.prototype.isPrototypeOf(n[e]))
                throw new Error("Arr.flatten item " + e + " was not an array, input: " + n);
            z.apply(r, n[e])
        }
        return r
    }, $ = function(n, r) {
        for (var e = 0, t = n.length; e < t; ++e)
            if (!0 !== r(n[e], e, n))
                return !1;
        return !0
    }, Y = Array.prototype.slice, G = P(Array.from) ? Array.from : function(n) {
        return Y.call(n)
    }
    , J = function(n, r) {
        for (var e = [], t = 0; t < n.length; t++) {
            var o = n[t];
            if (!o.isSome())
                return D.none();
            e.push(o.getOrDie())
        }
        return D.some(r.apply(null, e))
    }, K = function() {
        for (var r = [], n = 0; n < arguments.length; n++)
            r[n] = arguments[n];
        return function() {
            for (var e = [], n = 0; n < arguments.length; n++)
                e[n] = arguments[n];
            if (r.length !== e.length)
                throw new Error('Wrong number of arguments to struct. Expected "[' + r.length + ']", got ' + e.length + " arguments");
            var t = {};
            return W(r, function(n, r) {
                t[n] = x(e[r])
            }),
            t
        }
    }, Q = Object.keys, Z = Object.hasOwnProperty, nn = function(n, r) {
        for (var e = Q(n), t = 0, o = e.length; t < o; t++) {
            var u = e[t];
            r(n[u], u, n)
        }
    }, rn = function(n, t) {
        return en(n, function(n, r, e) {
            return {
                k: r,
                v: t(n, r, e)
            }
        })
    }, en = function(t, o) {
        var u = {};
        return nn(t, function(n, r) {
            var e = o(n, r, t);
            u[e.k] = e.v
        }),
        u
    }, tn = function(n) {
        return n.slice(0).sort()
    }, on = function(r, n) {
        if (!I(n))
            throw new Error("The " + r + " fields must be an array. Was: " + n + ".");
        W(n, function(n) {
            if (!C(n))
                throw new Error("The value " + n + " in the " + r + " fields was not a string.")
        })
    }, un = function(n) {
        if (null == n)
            throw new Error("Node cannot be null or undefined");
        return {
            dom: x(n)
        }
    }, an = {
        fromHtml: function(n, r) {
            var e = (r || a.document).createElement("div");
            if (e.innerHTML = n,
            !e.hasChildNodes() || 1 < e.childNodes.length)
                throw a.console.error("HTML does not have a single root node", n),
                new Error("HTML must have a single root node");
            return un(e.childNodes[0])
        },
        fromTag: function(n, r) {
            var e = (r || a.document).createElement(n);
            return un(e)
        },
        fromText: function(n, r) {
            var e = (r || a.document).createTextNode(n);
            return un(e)
        },
        fromDom: un,
        fromPoint: function(n, r, e) {
            var t = n.dom();
            return D.from(t.elementFromPoint(r, e)).map(un)
        }
    }, cn = (a.Node.ATTRIBUTE_NODE,
    a.Node.CDATA_SECTION_NODE,
    a.Node.COMMENT_NODE,
    a.Node.DOCUMENT_NODE,
    a.Node.DOCUMENT_TYPE_NODE,
    a.Node.DOCUMENT_FRAGMENT_NODE,
    a.Node.ELEMENT_NODE,
    a.Node.TEXT_NODE), fn = (a.Node.PROCESSING_INSTRUCTION_NODE,
    a.Node.ENTITY_REFERENCE_NODE,
    a.Node.ENTITY_NODE,
    a.Node.NOTATION_NODE,
    function(n) {
        return n.dom().nodeName.toLowerCase()
    }
    ), sn = function(n) {
        return n.dom().nodeType
    }, ln = (u = cn,
    function(n) {
        return sn(n) === u
    }
    ), dn = function(n, r) {
        for (var e = [], t = function(n) {
            return e.push(n),
            r(n)
        }, o = r(n); (o = o.bind(t)).isSome(); )
            ;
        return e
    }, mn = "undefined" != typeof window ? window : Function("return this;")(), pn = function(n, r) {
        return function(n, r) {
            for (var e = null != r ? r : mn, t = 0; t < n.length && null != e; ++t)
                e = e[n[t]];
            return e
        }(n.split("."), r)
    }, hn = function(n, r) {
        var e = pn(n, r);
        if (null == e)
            throw n + " not available on this browser";
        return e
    }, vn = function() {
        return gn(0, 0)
    }, gn = function(n, r) {
        return {
            major: n,
            minor: r
        }
    }, wn = {
        nu: gn,
        detect: function(n, r) {
            var e = String(r).toLowerCase();
            return 0 === n.length ? vn() : function(n, r) {
                var e = function(n, r) {
                    for (var e = 0; e < n.length; e++) {
                        var t = n[e];
                        if (t.test(r))
                            return t
                    }
                }(n, r);
                if (!e)
                    return {
                        major: 0,
                        minor: 0
                    };
                var t = function(n) {
                    return Number(r.replace(e, "$" + n))
                };
                return gn(t(1), t(2))
            }(n, e)
        },
        unknown: vn
    }, bn = "Firefox", yn = function(n, r) {
        return function() {
            return r === n
        }
    }, xn = function(n) {
        var r = n.current;
        return {
            current: r,
            version: n.version,
            isEdge: yn("Edge", r),
            isChrome: yn("Chrome", r),
            isIE: yn("IE", r),
            isOpera: yn("Opera", r),
            isFirefox: yn(bn, r),
            isSafari: yn("Safari", r)
        }
    }, En = {
        unknown: function() {
            return xn({
                current: void 0,
                version: wn.unknown()
            })
        },
        nu: xn,
        edge: x("Edge"),
        chrome: x("Chrome"),
        ie: x("IE"),
        opera: x("Opera"),
        firefox: x(bn),
        safari: x("Safari")
    }, On = "Windows", Tn = "Android", Sn = "Solaris", Nn = "FreeBSD", kn = function(n, r) {
        return function() {
            return r === n
        }
    }, jn = function(n) {
        var r = n.current;
        return {
            current: r,
            version: n.version,
            isWindows: kn(On, r),
            isiOS: kn("iOS", r),
            isAndroid: kn(Tn, r),
            isOSX: kn("OSX", r),
            isLinux: kn("Linux", r),
            isSolaris: kn(Sn, r),
            isFreeBSD: kn(Nn, r)
        }
    }, _n = {
        unknown: function() {
            return jn({
                current: void 0,
                version: wn.unknown()
            })
        },
        nu: jn,
        windows: x(On),
        ios: x("iOS"),
        android: x(Tn),
        linux: x("Linux"),
        osx: x("OSX"),
        solaris: x(Sn),
        freebsd: x(Nn)
    }, Dn = function(n, r) {
        var e = String(r).toLowerCase();
        return H(n, function(n) {
            return n.search(e)
        })
    }, An = function(n, e) {
        return Dn(n, e).map(function(n) {
            var r = wn.detect(n.versionRegexes, e);
            return {
                current: n.name,
                version: r
            }
        })
    }, Cn = function(n, e) {
        return Dn(n, e).map(function(n) {
            var r = wn.detect(n.versionRegexes, e);
            return {
                current: n.name,
                version: r
            }
        })
    }, Rn = function(n, r) {
        return -1 !== n.indexOf(r)
    }, In = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/, Mn = function(r) {
        return function(n) {
            return Rn(n, r)
        }
    }, Pn = [{
        name: "Edge",
        versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],
        search: function(n) {
            return Rn(n, "edge/") && Rn(n, "chrome") && Rn(n, "safari") && Rn(n, "applewebkit")
        }
    }, {
        name: "Chrome",
        versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/, In],
        search: function(n) {
            return Rn(n, "chrome") && !Rn(n, "chromeframe")
        }
    }, {
        name: "IE",
        versionRegexes: [/.*?msie\ ?([0-9]+)\.([0-9]+).*/, /.*?rv:([0-9]+)\.([0-9]+).*/],
        search: function(n) {
            return Rn(n, "msie") || Rn(n, "trident")
        }
    }, {
        name: "Opera",
        versionRegexes: [In, /.*?opera\/([0-9]+)\.([0-9]+).*/],
        search: Mn("opera")
    }, {
        name: "Firefox",
        versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],
        search: Mn("firefox")
    }, {
        name: "Safari",
        versionRegexes: [In, /.*?cpu os ([0-9]+)_([0-9]+).*/],
        search: function(n) {
            return (Rn(n, "safari") || Rn(n, "mobile/")) && Rn(n, "applewebkit")
        }
    }], Fn = [{
        name: "Windows",
        search: Mn("win"),
        versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]
    }, {
        name: "iOS",
        search: function(n) {
            return Rn(n, "iphone") || Rn(n, "ipad")
        },
        versionRegexes: [/.*?version\/\ ?([0-9]+)\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]
    }, {
        name: "Android",
        search: Mn("android"),
        versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/]
    }, {
        name: "OSX",
        search: Mn("os x"),
        versionRegexes: [/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]
    }, {
        name: "Linux",
        search: Mn("linux"),
        versionRegexes: []
    }, {
        name: "Solaris",
        search: Mn("sunos"),
        versionRegexes: []
    }, {
        name: "FreeBSD",
        search: Mn("freebsd"),
        versionRegexes: []
    }], Ln = {
        browsers: x(Pn),
        oses: x(Fn)
    }, qn = function(n) {
        var r, e, t, o, u, i, a, c, f, s, l, d = Ln.browsers(), m = Ln.oses(), p = An(d, n).fold(En.unknown, En.nu), h = Cn(m, n).fold(_n.unknown, _n.nu);
        return {
            browser: p,
            os: h,
            deviceType: (e = p,
            t = n,
            o = (r = h).isiOS() && !0 === /ipad/i.test(t),
            u = r.isiOS() && !o,
            i = r.isAndroid() && 3 === r.version.major,
            a = r.isAndroid() && 4 === r.version.major,
            c = o || i || a && !0 === /mobile/i.test(t),
            f = r.isiOS() || r.isAndroid(),
            s = f && !c,
            l = e.isSafari() && r.isiOS() && !1 === /safari/i.test(t),
            {
                isiPad: x(o),
                isiPhone: x(u),
                isTablet: x(c),
                isPhone: x(s),
                isTouch: x(f),
                isAndroid: r.isAndroid,
                isiOS: r.isiOS,
                isWebView: x(l)
            })
        }
    }, Vn = ((i = function() {
        var n = a.navigator.userAgent;
        return qn(n)
    }
    ,
    f = !1,
    function() {
        for (var n = [], r = 0; r < arguments.length; r++)
            n[r] = arguments[r];
        return f || (f = !0,
        c = i.apply(null, n)),
        c
    }()).browser.isIE(),
    function(n) {
        var r = n.dom();
        return D.from(r.parentNode).map(an.fromDom)
    }
    ), Wn = function(n) {
        var r = n.dom();
        return D.from(r.previousSibling).map(an.fromDom)
    }, Hn = function(n) {
        var r = n.dom();
        return D.from(r.nextSibling).map(an.fromDom)
    }, Un = function(n) {
        return r = dn(n, Wn),
        (e = Y.call(r, 0)).reverse(),
        e;
        var r, e
    }, Bn = function(n) {
        return r = 0,
        e = n.dom().childNodes,
        D.from(e[r]).map(an.fromDom);
        var r, e
    }, zn = (K("element", "offset"),
    {
        isBlock: (s = ["article", "aside", "details", "div", "dt", "figcaption", "footer", "form", "fieldset", "header", "hgroup", "html", "main", "nav", "section", "summary", "body", "p", "dl", "multicol", "dd", "figure", "address", "center", "blockquote", "h1", "h2", "h3", "h4", "h5", "h6", "listing", "xmp", "pre", "plaintext", "menu", "dir", "ul", "ol", "li", "hr", "table", "tbody", "thead", "tfoot", "th", "tr", "td", "caption"],
        function(n) {
            return (l = l || function(n, r) {
                for (var e = {}, t = 0, o = n.length; t < o; t++) {
                    var u = n[t];
                    e[String(u)] = r(u, t)
                }
                return e
            }(s, x(!0))).hasOwnProperty(fn(n))
        }
        )
    }), Xn = function(r, e) {
        return function(n) {
            return r(n) || e(n)
        }
    }, $n = K("start", "end", "caret"), Yn = function(n) {
        return "br" === fn(n)
    }, Gn = function(r) {
        return J([Vn(r.start()), Vn(r.end())], function() {
            var n = a.document.createRange();
            return n.setStartBefore(r.start().dom()),
            n.setEndAfter(r.end().dom()),
            n
        })
    }, Jn = function(n) {
        if (!1 === n.collapsed)
            return D.none();
        var r, e, t, o = (e = (r = n).startContainer,
        t = r.startOffset,
        void 0 === e ? D.none() : 3 === e.nodeType ? 0 === t ? D.some(e).map(an.fromDom) : D.none() : D.from(e.childNodes[t]).map(an.fromDom)), u = o.bind(Wn).filter(Yn), i = u.map(Un).bind(function(n) {
            return H(n.reverse(), Xn(Yn, zn.isBlock)).fold(function() {
                return D.from(n[n.length - 1])
            }, Hn)
        });
        return J([i, u, o], $n)
    }, Kn = Gn, Qn = function(n) {
        return Gn(n).fold(x(""), function(n) {
            return n.toString()
        })
    }, Zn = function(n) {
        return C(n.mediaembed_service_url)
    }, nr = function(n) {
        return F(n.mediaembed_max_width) ? n.mediaembed_max_width : 650
    }, rr = function(n) {
        var r = n.api_key;
        return r || n.mediaembed_api_key
    }, er = function(n, r) {
        return C(n.mediaembed_content_css) ? n.mediaembed_content_css : r
    }, tr = function(n, r, e) {
        !function(n, r, e) {
            if (!(C(e) || M(e) || F(e)))
                throw a.console.error("Invalid call to Attr.set. Key ", r, ":: Value ", e, ":: Element ", n),
                new Error("Attribute value was not simple");
            n.setAttribute(r, e + "")
        }(n.dom(), r, e)
    }, or = function(n, t) {
        Hn(n).fold(function() {
            Vn(n).each(function(n) {
                ur(n, t)
            })
        }, function(n) {
            var r, e;
            e = t,
            Vn(r = n).each(function(n) {
                n.dom().insertBefore(e.dom(), r.dom())
            })
        })
    }, ur = function(n, r) {
        n.dom().appendChild(r.dom())
    }, ir = function(n) {
        var r;
        n.dom().textContent = "",
        W((r = n.dom(),
        V(r.childNodes, an.fromDom)), function(n) {
            ar(n)
        })
    }, ar = function(n) {
        var r = n.dom();
        null !== r.parentNode && r.parentNode.removeChild(r)
    }, cr = function(n) {
        return r = n,
        e = !0,
        an.fromDom(r.dom().cloneNode(e));
        var r, e
    }, fr = function(n) {
        return void 0 !== n.style
    }, sr = function(n, r, e) {
        !function(n, r, e) {
            if (!C(e))
                throw a.console.error("Invalid call to CSS.set. Property ", r, ":: Value ", e, ":: Element ", n),
                new Error("CSS value must be a string: " + e);
            fr(n) && n.style.setProperty(r, e)
        }(n.dom(), r, e)
    }, lr = function(n, r) {
        var e, t, o = n.dom(), u = a.window.getComputedStyle(o).getPropertyValue(r), i = "" !== u || null != (t = ln(e = n) ? e.dom().parentNode : e.dom()) && t.ownerDocument.body.contains(t) ? u : dr(o, r);
        return null === i ? void 0 : i
    }, dr = function(n, r) {
        return fr(n) ? n.style.getPropertyValue(r) : ""
    }, mr = function(n) {
        var r = an.fromTag("div")
          , e = an.fromDom(n.dom().cloneNode(!0));
        return ur(r, e),
        r.dom().innerHTML
    }, pr = function(n) {
        return 1 === sn(n) ? n : Hn(n).fold(function() {
            return n
        }, pr)
    }, hr = function(n, r) {
        var e = n.parser.parse(r, {
            isRootContent: !0,
            forced_root_block: !1
        })
          , t = new tinymce.html.Serializer({
            validate: !0
        },n.schema).serialize(e);
        return an.fromDom(n.dom.createFragment(t))
    }, vr = function(n, r) {
        return fn(r).toLowerCase() === n.toLowerCase()
    }, gr = function(n, r) {
        var e = n.dom.createFragment(r);
        return pr(an.fromDom(e.firstChild))
    }, wr = function(n, r, e) {
        var t = cr(e);
        return lr(t, "max-width") || sr(t, "max-width", r + "px"),
        tr(t, "data-ephox-embed-iri", n),
        tr(t, "contentEditable", !1),
        t
    }, br = function(n, r, e) {
        return vr("DIV", r) ? wr(n, e, r) : wr(n, e, ((vr("VIDEO", u = r) || vr("AUDIO", u)) && sr(u, "width", "100%"),
        t = u,
        o = an.fromTag("div"),
        ur(o, cr(t)),
        o));
        var t, o, u
    }, yr = function(n, r, e) {
        return vr("A", r) ? r : br(n, r, e)
    }, xr = function(c, n, f, s) {
        n.filter(function(n) {
            return Vn(n).isSome()
        }).map(function(n) {
            var r, e, t, o, u, i, a = yr(f, gr(c, s), nr(c.settings));
            vr("DIV", a) ? (u = n,
            i = hr(o = c, mr(a)),
            Bn(i).each(function(n) {
                o.undoManager.transact(function() {
                    or(u, n),
                    ar(u)
                })
            })) : (e = n,
            t = hr(r = c, mr(a)),
            r.undoManager.transact(function() {
                ir(e),
                ur(e, t)
            }))
        })
    }, Er = function(n, r, e) {
        var t = gr(n, e);
        return mr(yr(r, t, nr(n.settings)))
    }, Or = function(i, n, r, e) {
        n.map(function(u) {
            Kn(u).each(function(t) {
                var n = yr(r, gr(i, e), nr(i.settings))
                  , o = hr(i, mr(n));
                i.undoManager.transact(function() {
                    var n, r, e;
                    t.deleteContents(),
                    t.insertNode(o.dom()),
                    t.collapse(!1),
                    n = i,
                    r = u.caret().dom(),
                    e = n.dom.createRng(),
                    3 === r.nodeType ? (e.setStart(r, 0),
                    e.setEnd(r, 0)) : (e.setStartBefore(r),
                    e.setEndAfter(r)),
                    n.selection.setRng(e)
                })
            })
        })
    }, Tr = function(n) {
        var r, e, t = (r = n.split(" "),
        e = {},
        W(r, function(n) {
            e[n.toLowerCase()] = !0
        }),
        e);
        return function(n) {
            return !!n && n.nodeName.toLowerCase()in t
        }
    }, Sr = Tr("h1 h2 h3 h4 h5 h6 p span"), Nr = Tr("strong em b span a br"), kr = function(n) {
        return H((r = n,
        r ? G(r.querySelectorAll("*")) : []), (e = Nr,
        function() {
            for (var n = [], r = 0; r < arguments.length; r++)
                n[r] = arguments[r];
            return !e.apply(null, n)
        }
        )).isNone();
        var e, r
    }, jr = function(n) {
        return Sr(n.dom()) && kr(n.dom())
    }, _r = function(n) {
        return /^https?:\/\/\S+$/i.test(n.trim())
    }, Dr = function(n) {
        return n.dom().textContent
    }, Ar = function(n) {
        return D.from(n).filter(jr).map(Dr).filter(_r)
    }, Cr = function(a, c, f) {
        a.on("newBlock", function(n) {
            var r, t, o, u, i;
            r = n,
            t = a,
            o = c,
            u = f,
            (i = Wn(an.fromDom(r.newBlock))).bind(Ar).map(function(e) {
                o.getAndHandleResponse(e, function(n) {
                    var r = n.recommended().html();
                    xr(t, i, e, r)
                }, u.showNotificationError)
            })
        }),
        a.settings.forced_root_block || a.on("keydown", function(n) {
            var t, r, o, e, u;
            13 === n.keyCode && (r = c,
            o = f,
            e = (t = a).selection.getRng(),
            (u = Jn(e)).map(Qn).filter(_r).map(function(e) {
                r.getAndHandleResponse(e, function(n) {
                    var r = n.recommended().html();
                    Or(t, u, e, r)
                }, o.showNotificationError)
            }))
        })
    }, Rr = function(n) {
        W(n, function(n) {
            var r;
            (r = new tinymce.html.Node("span",1)).attr("class", "mce-shim"),
            r.attr("data-mce-bogus", "1"),
            n.append(r),
            n.attr("contenteditable", "false")
        })
    }, Ir = function(n) {
        W(n, function(n) {
            n.attr("contenteditable", null)
        })
    }, Mr = function(r) {
        r.on("click keyup", function() {
            var n = r.selection.getNode();
            n && r.dom.getAttrib(n, "data-ephox-embed-iri") && r.dom.getAttrib(n, "data-mce-selected") && n.setAttribute("data-mce-selected", "2")
        }),
        tinymce.Env.ceFalse && r.on("PreInit", function() {
            r.parser.addAttributeFilter("data-ephox-embed-iri", Rr),
            r.serializer.addAttributeFilter("data-ephox-embed-iri", Ir)
        })
    }, Pr = function(n, r, e) {
        var o, u, i;
        "media_url_resolver"in n.settings == 0 && (n.settings.media_url_resolver = (o = n,
        u = r,
        i = e,
        function(e, t) {
            !1 !== _r(e.url) ? u.getAndHandleResponse(e.url, function(n) {
                var r = n.recommended().html();
                t({
                    html: Er(o, e.url, r)
                })
            }, i.showDialogError) : t({
                html: ""
            })
        }
        ))
    }, Fr = [{
        code: 404,
        message: "The specified url was not found."
    }, {
        code: 600,
        message: "The specified service did not respond correctly."
    }, {
        code: 601,
        message: "The specified service did not respond correctly."
    }], Lr = function(n, r) {
        return "Media embed: " + H(Fr, function(n) {
            return n.code === r
        }).fold(function() {
            return "Server didn't produce a valid result. (" + r + ")"
        }, function(n) {
            return n.message
        })
    }, qr = function(n) {
        var e = D.none()
          , r = []
          , t = function(n) {
            o() ? i(n) : r.push(n)
        }
          , o = function() {
            return e.isSome()
        }
          , u = function(n) {
            W(n, i)
        }
          , i = function(r) {
            e.each(function(n) {
                setTimeout(function() {
                    r(n)
                }, 0)
            })
        };
        return n(function(n) {
            e = D.some(n),
            u(r),
            r = []
        }),
        {
            get: t,
            map: function(e) {
                return qr(function(r) {
                    t(function(n) {
                        r(e(n))
                    })
                })
            },
            isReady: o
        }
    }, Vr = {
        nu: qr,
        pure: function(r) {
            return qr(function(n) {
                n(r)
            })
        }
    }, Wr = function(r) {
        var n = function(n) {
            var t;
            r((t = n,
            function() {
                for (var n = [], r = 0; r < arguments.length; r++)
                    n[r] = arguments[r];
                var e = this;
                setTimeout(function() {
                    t.apply(e, n)
                }, 0)
            }
            ))
        }
          , e = function() {
            return Vr.nu(n)
        };
        return {
            map: function(t) {
                return Wr(function(e) {
                    n(function(n) {
                        var r = t(n);
                        e(r)
                    })
                })
            },
            bind: function(e) {
                return Wr(function(r) {
                    n(function(n) {
                        e(n).get(r)
                    })
                })
            },
            anonBind: function(e) {
                return Wr(function(r) {
                    n(function(n) {
                        e.get(r)
                    })
                })
            },
            toLazy: e,
            toCached: function() {
                var r = null;
                return Wr(function(n) {
                    null === r && (r = e()),
                    r.get(n)
                })
            },
            get: n
        }
    }, Hr = {
        nu: Wr,
        pure: function(r) {
            return Wr(function(n) {
                n(r)
            })
        }
    }, Ur = function(e) {
        return {
            is: function(n) {
                return e === n
            },
            isValue: T,
            isError: O,
            getOr: x(e),
            getOrThunk: x(e),
            getOrDie: x(e),
            or: function(n) {
                return Ur(e)
            },
            orThunk: function(n) {
                return Ur(e)
            },
            fold: function(n, r) {
                return r(e)
            },
            map: function(n) {
                return Ur(n(e))
            },
            mapError: function(n) {
                return Ur(e)
            },
            each: function(n) {
                n(e)
            },
            bind: function(n) {
                return n(e)
            },
            exists: function(n) {
                return n(e)
            },
            forall: function(n) {
                return n(e)
            },
            toOption: function() {
                return D.some(e)
            }
        }
    }, Br = function(e) {
        return {
            is: O,
            isValue: O,
            isError: T,
            getOr: E,
            getOrThunk: function(n) {
                return n()
            },
            getOrDie: function() {
                return n = String(e),
                function() {
                    throw new Error(n)
                }();
                var n
            },
            or: function(n) {
                return n
            },
            orThunk: function(n) {
                return n()
            },
            fold: function(n, r) {
                return n(e)
            },
            map: function(n) {
                return Br(e)
            },
            mapError: function(n) {
                return Br(n(e))
            },
            each: b,
            bind: function(n) {
                return Br(e)
            },
            exists: O,
            forall: T,
            toOption: D.none
        }
    }, zr = {
        value: Ur,
        error: Br
    }, Xr = {
        pure: y(Hr.pure, zr.value),
        failed: y(Hr.pure, zr.error),
        foldSync: function(n, r, e) {
            return n.map(function(n) {
                return n.fold(r, e)
            })
        },
        bindSync: function(n, r) {
            return n.map(function(n) {
                return n.bind(r)
            })
        },
        bindAsync: function(n, r) {
            return n.bind(function(n) {
                return n.bind(r)
            })
        },
        mapSync: function(n, r) {
            return n.map(function(n) {
                return n.map(r)
            })
        },
        handle: function(n, r, e) {
            return n.get(function(n) {
                return n.fold(r, e)
            })
        }
    }, $r = {
        now: function() {
            return (new Date).getTime()
        }
    }, Yr = 36e5, Gr = function(i) {
        if (!I(i))
            throw new Error("cases must be an array");
        if (0 === i.length)
            throw new Error("there must be at least one case");
        var a = []
          , e = {};
        return W(i, function(n, t) {
            var r = Q(n);
            if (1 !== r.length)
                throw new Error("one and only one name per case");
            var o = r[0]
              , u = n[o];
            if (void 0 !== e[o])
                throw new Error("duplicate key detected:" + o);
            if ("cata" === o)
                throw new Error("cannot have a case named cata (sorry)");
            if (!I(u))
                throw new Error("case arguments must be an array");
            a.push(o),
            e[o] = function() {
                var n = arguments.length;
                if (n !== u.length)
                    throw new Error("Wrong number of arguments to case " + o + ". Expected " + u.length + " (" + u + "), got " + n);
                for (var e = new Array(n), r = 0; r < e.length; r++)
                    e[r] = arguments[r];
                return {
                    fold: function() {
                        if (arguments.length !== i.length)
                            throw new Error("Wrong number of arguments to fold. Expected " + i.length + ", got " + arguments.length);
                        return arguments[t].apply(null, e)
                    },
                    match: function(n) {
                        var r = Q(n);
                        if (a.length !== r.length)
                            throw new Error("Wrong number of arguments to match. Expected: " + a.join(",") + "\nActual: " + r.join(","));
                        if (!$(a, function(n) {
                            return q(r, n)
                        }))
                            throw new Error("Not all branches were specified when using match. Specified: " + r.join(", ") + "\nRequired: " + a.join(", "));
                        return n[o].apply(null, e)
                    },
                    log: function(n) {
                        console.log(n, {
                            constructors: a,
                            constructor: o,
                            params: e
                        })
                    }
                }
            }
        }),
        e
    }, Jr = Object.prototype.hasOwnProperty, Kr = function(i) {
        return function() {
            for (var n = new Array(arguments.length), r = 0; r < n.length; r++)
                n[r] = arguments[r];
            if (0 === n.length)
                throw new Error("Can't merge zero objects");
            for (var e = {}, t = 0; t < n.length; t++) {
                var o = n[t];
                for (var u in o)
                    Jr.call(o, u) && (e[u] = i(e[u], o[u]))
            }
            return e
        }
    }, Qr = Kr(function(n, r) {
        return R(n) && R(r) ? Qr(n, r) : r
    }), Zr = Kr(function(n, r) {
        return r
    }), ne = Gr([{
        strict: []
    }, {
        defaultedThunk: ["fallbackThunk"]
    }, {
        asOption: []
    }, {
        asDefaultedOptionThunk: ["fallbackThunk"]
    }, {
        mergeWithThunk: ["baseThunk"]
    }]), re = ne.strict, ee = (ne.asOption,
    ne.defaultedThunk,
    ne.asDefaultedOptionThunk,
    ne.mergeWithThunk,
    function(n, r) {
        return ne.asOption,
        ne.defaultedThunk,
        ne.asDefaultedOptionThunk,
        ne.mergeWithThunk,
        t = e = n,
        o = u = r,
        Z.call(t, o) ? D.from(e[u]) : D.none();
        var e, t, o, u
    }
    ), te = function(n, r) {
        var e = {};
        return e[n] = r,
        e
    };
    Gr([{
        bothErrors: ["error1", "error2"]
    }, {
        firstError: ["error1", "value2"]
    }, {
        secondError: ["value1", "error2"]
    }, {
        bothValues: ["value1", "value2"]
    }]),
    (m = d || (d = {}))[m.Error = 0] = "Error",
    m[m.Value = 1] = "Value";
    var oe, ue, ie, ae, ce, fe, se = function(n, r, e) {
        return n.stype === d.Error ? r(n.serror) : e(n.svalue)
    }, le = function(n) {
        return {
            stype: d.Value,
            svalue: n
        }
    }, de = function(n) {
        return {
            stype: d.Error,
            serror: n
        }
    }, me = function(n) {
        return se(n, zr.error, zr.value)
    }, pe = le, he = function(n) {
        var r = []
          , e = [];
        return W(n, function(n) {
            se(n, function(n) {
                return e.push(n)
            }, function(n) {
                return r.push(n)
            })
        }),
        {
            values: r,
            errors: e
        }
    }, ve = de, ge = function(n, r) {
        return n.stype === d.Value ? r(n.svalue) : n
    }, we = function(n, r) {
        return n.stype === d.Error ? r(n.serror) : n
    }, be = function(n, r) {
        return n.stype === d.Value ? {
            stype: d.Value,
            svalue: r(n.svalue)
        } : n
    }, ye = function(n, r) {
        return n.stype === d.Error ? {
            stype: d.Error,
            serror: r(n.serror)
        } : n
    }, xe = function(n) {
        return y(ve, X)(n)
    }, Ee = function(n, r) {
        var e, t, o = he(n);
        return 0 < o.errors.length ? xe(o.errors) : (e = o.values,
        t = r,
        0 < e.length ? pe(Qr(t, Zr.apply(void 0, e))) : pe(t))
    }, Oe = Gr([{
        setOf: ["validator", "valueType"]
    }, {
        arrOf: ["valueType"]
    }, {
        objOf: ["fields"]
    }, {
        itemOf: ["validator"]
    }, {
        choiceOf: ["key", "branches"]
    }, {
        thunk: ["description"]
    }, {
        func: ["args", "outputSchema"]
    }]), Te = Gr([{
        field: ["name", "presence", "type"]
    }, {
        state: ["name"]
    }]), Se = function() {
        return hn("JSON")
    }, Ne = {
        parse: function(n) {
            return Se().parse(n)
        },
        stringify: function(n, r, e) {
            return Se().stringify(n, r, e)
        }
    }, ke = function(n) {
        return R(n) && 100 < Q(n).length ? " removed due to size" : Ne.stringify(n, null, 2)
    }, je = function(n, r) {
        return ve([{
            path: n,
            getErrorInfo: r
        }])
    }, _e = Gr([{
        field: ["key", "okey", "presence", "prop"]
    }, {
        state: ["okey", "instantiator"]
    }]), De = function(e, t, o) {
        return ee(t, o).fold(function() {
            return n = o,
            r = t,
            je(e, function() {
                return 'Could not find valid *strict* value for "' + n + '" in ' + ke(r)
            });
            var n, r
        }, pe)
    }, Ae = function(n, r, e) {
        var t = ee(n, r).fold(function() {
            return e(n)
        }, E);
        return pe(t)
    }, Ce = function(a, c, n, f) {
        return n.fold(function(o, e, n, t) {
            var u = function(n) {
                var r = t.extract(a.concat([o]), f, n);
                return be(r, function(n) {
                    return te(e, f(n))
                })
            }
              , i = function(n) {
                return n.fold(function() {
                    var n = te(e, f(D.none()));
                    return pe(n)
                }, function(n) {
                    var r = t.extract(a.concat([o]), f, n);
                    return be(r, function(n) {
                        return te(e, f(D.some(n)))
                    })
                })
            };
            return n.fold(function() {
                return ge(De(a, c, o), u)
            }, function(n) {
                return ge(Ae(c, o, n), u)
            }, function() {
                return ge(pe(ee(c, o)), i)
            }, function(n) {
                return ge((e = n,
                t = ee(r = c, o).map(function(n) {
                    return !0 === n ? e(r) : n
                }),
                pe(t)), i);
                var r, e, t
            }, function(n) {
                var r = n(c)
                  , e = be(Ae(c, o, x({})), function(n) {
                    return Qr(r, n)
                });
                return ge(e, u)
            })
        }, function(n, r) {
            var e = r(c);
            return pe(te(n, f(e)))
        })
    }, Re = function(t) {
        return {
            extract: function(e, n, r) {
                return we(t(r, n), function(n) {
                    return r = n,
                    je(e, function() {
                        return r
                    });
                    var r
                })
            },
            toString: function() {
                return "val"
            },
            toDsl: function() {
                return Oe.itemOf(t)
            }
        }
    }, Ie = function(a) {
        return {
            extract: function(n, r, e) {
                return t = n,
                o = e,
                u = r,
                i = V(a, function(n) {
                    return Ce(t, o, n, u)
                }),
                Ee(i, {});
                var t, o, u, i
            },
            toString: function() {
                return "obj{\n" + V(a, function(n) {
                    return n.fold(function(n, r, e, t) {
                        return n + " -> " + t.toString()
                    }, function(n, r) {
                        return "state(" + n + ")"
                    })
                }).join("\n") + "}"
            },
            toDsl: function() {
                return Oe.objOf(V(a, function(n) {
                    return n.fold(function(n, r, e, t) {
                        return Te.field(n, e, t)
                    }, function(n, r) {
                        return Te.state(n)
                    })
                }))
            }
        }
    }, Me = x(Re(pe)), Pe = _e.field, Fe = function(n, r, e, t) {
        var o = r.extract([n], e, t);
        return ye(o, function(n) {
            return {
                input: t,
                errors: n
            }
        })
    }, Le = function(n, r, e) {
        return me(Fe(n, r, x, e))
    }, qe = function(n, r, e) {
        return me(Fe(n, r, E, e)).fold(function(n) {
            throw new Error(Ve(n))
        }, E)
    }, Ve = function(n) {
        return "Errors: \n" + (r = n.errors,
        e = 10 < r.length ? r.slice(0, 10).concat([{
            path: [],
            getErrorInfo: function() {
                return "... (only showing first ten failures)"
            }
        }]) : r,
        V(e, function(n) {
            return "Failed path: (" + n.path.join(" > ") + ")\n" + n.getErrorInfo()
        })) + "\n\nInput object: " + ke(n.input);
        var r, e
    }, We = Gr([{
        get: []
    }, {
        post: []
    }, {
        put: []
    }, {
        del: []
    }]), He = {
        get: We.get,
        post: We.post,
        put: We.put,
        del: We.del
    }, Ue = function(n, r, e, t) {
        var o = n.bind(function(n) {
            return n.match({
                file: function() {
                    return D.none()
                },
                form: function() {
                    return D.some("application/x-www-form-urlencoded; charset=UTF-8")
                },
                json: function() {
                    return D.some("application/json")
                },
                plain: function() {
                    return D.some("text/plain")
                },
                html: function() {
                    return D.some("text/html")
                }
            })
        })
          , u = e.match({
            none: D.none,
            xhr: x(D.some(!0))
        })
          , i = r.match({
            json: D.none,
            blob: x(D.some("blob")),
            xml: x(D.some("document")),
            html: x(D.some("document")),
            text: x(D.some("text"))
        })
          , a = r.match({
            json: x("application/json, text/javascript"),
            blob: x("application/octet-stream"),
            text: x("text/plain"),
            html: x("text/html"),
            xml: x("application/xml, text/xml")
        }) + ", */*; q=0.01"
          , c = t;
        return {
            contentType: x(o),
            credentials: x(u),
            responseType: x(i),
            accept: x(a),
            headers: x(c)
        }
    }, Be = function(e, n) {
        n.contentType().each(function(n) {
            e.setRequestHeader("Content-Type", n)
        });
        var r = n.accept();
        e.setRequestHeader("Accept", r),
        n.credentials().each(function(n) {
            e.withCredentials = n
        }),
        n.responseType().each(function(n) {
            e.responseType = n
        });
        var t = n.headers();
        nn(t, function(n, r) {
            C(r) || C(n) ? e.setRequestHeader(r, n) : a.console.error("Request header data was not a string: ", r, " -> ", n)
        })
    }, ze = function(r) {
        return Hr.nu(function(e) {
            var n = new (hn("FileReader"));
            n.onload = function(n) {
                var r = n.target;
                e(r.result)
            }
            ,
            n.readAsText(r)
        })
    }, Xe = function(n) {
        try {
            var r = Ne.parse(n);
            return zr.value(r)
        } catch (n) {
            return zr.error("Response was not JSON")
        }
    }, $e = function(o, u) {
        var e, i = o.concat(u);
        if (0 === i.length)
            throw new Error("You must specify at least one required or optional field.");
        return on("required", o),
        on("optional", u),
        e = tn(i),
        H(e, function(n, r) {
            return r < e.length - 1 && n === e[r + 1]
        }).each(function(n) {
            throw new Error("The field: " + n + " occurs more than once in the combined fields: [" + e.join(", ") + "].")
        }),
        function(r) {
            var e = Q(r);
            $(o, function(n) {
                return q(e, n)
            }) || function(n, r) {
                throw new Error("All required keys (" + tn(n).join(", ") + ") were not specified. Specified keys were: " + tn(r).join(", ") + ".")
            }(o, e);
            var n = function(n, r) {
                for (var e = [], t = 0, o = n.length; t < o; t++) {
                    var u = n[t];
                    r(u, t, n) && e.push(u)
                }
                return e
            }(e, function(n) {
                return !q(i, n)
            });
            0 < n.length && function(n) {
                throw new Error("Unsupported keys for object: " + tn(n).join(", "))
            }(n);
            var t = {};
            return W(o, function(n) {
                t[n] = x(r[n])
            }),
            W(u, function(n) {
                t[n] = x(Object.prototype.hasOwnProperty.call(r, n) ? D.some(r[n]) : D.none())
            }),
            t
        }
    }(["message", "status", "responseText"], []), Ye = function(n) {
        var r = $e(n);
        return r.toString = r.message,
        r
    }, Ge = {
        handle: function(e, n, t) {
            var r = function() {
                return Hr.pure(t.response)
            };
            return n.match({
                json: function() {
                    return Xe(t.response).fold(r, Hr.pure)
                },
                blob: function() {
                    return n = t,
                    D.from(n.response).map(ze).getOr(Hr.pure("no response content"));
                    var n
                },
                text: r,
                html: r,
                xml: r
            }).map(function(n) {
                var r = 0 === t.status ? "Unknown HTTP error (possible cross-domain request)" : 'Could not load url "' + e + '": ' + t.statusText;
                return Ye({
                    message: r,
                    status: t.status,
                    responseText: n
                })
            })
        },
        nu: Ye
    }, Je = function() {
        return (Je = Object.assign || function(n) {
            for (var r, e = 1, t = arguments.length; e < t; e++)
                for (var o in r = arguments[e])
                    Object.prototype.hasOwnProperty.call(r, o) && (n[o] = r[o]);
            return n
        }
        ).apply(this, arguments)
    }, Ke = function(u) {
        return Je({}, u, {
            toCached: function() {
                return Ke(u.toCached())
            },
            bindFuture: function(r) {
                return Ke(u.bind(function(n) {
                    return n.fold(function(n) {
                        return Hr.pure(zr.error(n))
                    }, function(n) {
                        return r(n)
                    })
                }))
            },
            bindResult: function(r) {
                return Ke(u.map(function(n) {
                    return n.bind(r)
                }))
            },
            mapResult: function(r) {
                return Ke(u.map(function(n) {
                    return n.map(r)
                }))
            },
            mapError: function(r) {
                return Ke(u.map(function(n) {
                    return n.mapError(r)
                }))
            },
            foldResult: function(r, e) {
                return u.map(function(n) {
                    return n.fold(r, e)
                })
            },
            withTimeout: function(n, o) {
                return Ke(Hr.nu(function(r) {
                    var e = !1
                      , t = window.setTimeout(function() {
                        e = !0,
                        r(zr.error(o()))
                    }, n);
                    u.get(function(n) {
                        e || (window.clearTimeout(t),
                        r(n))
                    })
                }))
            }
        })
    }, Qe = function(n) {
        return Ke(Hr.nu(n))
    }, Ze = function(n) {
        return Ke(Hr.pure(zr.value(n)))
    }, nt = Qe, rt = Ze, et = function(n) {
        return Ke(Hr.pure(zr.error(n)))
    }, tt = function(n, r) {
        var e, t, o = function() {
            return rt(r.response)
        }, u = function(n) {
            return Ge.nu({
                message: n,
                status: r.status,
                responseText: r.responseText
            })
        };
        return n.match({
            json: function() {
                return Xe(r.response).fold(function(n) {
                    return et(u(n))
                }, rt)
            },
            blob: o,
            text: o,
            html: o,
            xml: (e = "Invalid XML document",
            t = o,
            function() {
                return t().bindResult(function(n) {
                    return null === n ? zr.error(u(e)) : zr.value(n)
                })
            }
            )
        })
    }, ot = function(i, e, a, c, f, n) {
        var s = void 0 !== n ? n : {};
        return nt(function(t) {
            var n = e.match({
                get: x("get"),
                put: x("put"),
                post: x("post"),
                del: x("delete")
            })
              , o = new (hn("XMLHttpRequest"));
            o.open(n, i, !0);
            var r = Ue(a, c, f, s);
            Be(o, r);
            var u = function() {
                Ge.handle(i, c, o).get(function(n) {
                    t(zr.error(n))
                })
            };
            o.onload = function() {
                var n, r, e;
                0 === o.status && (n = i,
                e = 0,
                "" != (r = "file:") && (n.length < r.length || n.substr(e, e + r.length) !== r)) ? u() : o.status < 100 || 400 <= o.status ? u() : tt(c, o).get(t)
            }
            ,
            o.onerror = u,
            a.fold(function() {
                o.send()
            }, function(n) {
                var r = n.match({
                    file: E,
                    form: E,
                    json: Ne.stringify,
                    plain: E,
                    html: E
                });
                o.send(r)
            })
        }).toLazy()
    }, ut = Gr([{
        file: ["data"]
    }, {
        form: ["data"]
    }, {
        json: ["data"]
    }, {
        plain: ["data"]
    }, {
        html: ["data"]
    }]), it = (ut.file,
    ut.form,
    ut.json,
    ut.plain,
    ut.html,
    Gr([{
        none: []
    }, {
        xhr: []
    }])), at = {
        none: it.none,
        xhr: it.xhr
    }, ct = Gr([{
        json: []
    }, {
        blob: []
    }, {
        text: []
    }, {
        html: []
    }, {
        xml: []
    }]), ft = {
        json: ct.json,
        blob: ct.blob,
        text: ct.text,
        html: ct.html,
        xml: ct.xml,
        cata: function(n, r, e, t, o, u) {
            return n.match({
                json: r,
                blob: e,
                text: t,
                html: o,
                xml: u
            })
        }
    }, st = function(n, r) {
        var e = -1 === n.indexOf("?") ? "?" : "&";
        return r ? n + e + "apiKey=" + encodeURIComponent(r) : n
    }, lt = function(n) {
        return n.hasOwnProperty("tiny-api-key") ? n["tiny-api-key"] : n.hasOwnProperty("tinymce-api-key") ? n["tinymce-api-key"] : n["textbox-api-key"]
    }, dt = function(n) {
        return n.fold(function(n) {
            var r = n.responseText()
              , e = R(r) ? r : n.message();
            return zr.error(e)
        }, zr.value)
    }, mt = function(s, l, d, m) {
        var p = lt(m);
        return {
            execute: function(n) {
                var o, r, e, t, u, i, a = qe(s + ".ajax.service.get", l, n), c = rn(a, function(n) {
                    return M(n) ? String(n) : n
                }), f = st((o = c,
                d.replace(/\$\{([^{}]*)\}/g, function(n, r) {
                    var e, t = o[r];
                    return "string" == (e = typeof t) || "number" === e ? t.toString() : n
                })), p);
                return (r = f,
                e = ft.json(),
                t = at.xhr(),
                u = m,
                i = He.get(),
                ot(r, i, D.none(), e, t, u)).map(dt)
            }
        }
    }, pt = function(n, r, e, t, o) {
        return (!0 === o ? D.none() : r.get(t, e)).fold(function() {
            return n(e, o).map(function(n) {
                return n.map(function(n) {
                    return r.set(e, n, t),
                    n
                })
            })
        }, function(n) {
            return Xr.pure(n)
        })
    }, ht = function(n) {
        return Pe(n, n, re(), Me())
    }, vt = "iframely", gt = "oembed", wt = "fallback", bt = "wikipedia", yt = function(n) {
        return "[" + n.join(", ") + "]"
    }, xt = [vt, gt, wt], Et = function(r, n, e) {
        return U(n, function(n) {
            return q(r, n)
        }).isSome() ? zr.error("Embed response source: " + yt(r) + " contains more than one of " + yt(xt)) : zr.value(e)
    }, Ot = (x(vt),
    x(gt),
    x(wt),
    function(n) {
        return q(n, vt) ? Et(n, [gt, wt, bt], vt) : q(n, gt) ? Et(n, [vt, wt, bt], gt) : q(n, wt) ? Et(n, [vt, gt, bt], wt) : q(n, bt) ? Et(n, [vt, gt, wt], bt) : zr.error("Embed response source: " + yt(n) + " did not contain any of: " + yt(xt))
    }
    ), Tt = Ie([ht("url"), ht("maxWidth"), (oe = "fresh",
    ue = !1,
    Pe(oe, oe, (ie = ue,
    ne.defaultedThunk(x(ie))), Me()))]), St = Ie([ht("status_code"), ht("sub_code"), ht("msg")]), Nt = Ie([ht("html"), (ae = "rels",
    ce = [Pe("source", "source", re(), (fe = function(n) {
        return I(n) ? Ot(n) : zr.error("Sources was not an array: " + n)
    }
    ,
    Re(function(n) {
        return fe(n).fold(ve, pe)
    })))],
    Pe(ae, ae, re(), Ie(ce)))]), kt = {
        requestOne: x(Tt),
        responseFailed: x(St),
        responseSucceeded: x(Nt)
    }, jt = function(n) {
        return Le("EmbedResponse.failure", kt.responseFailed(), n).fold(function(n) {
            return zr.error({
                code: x(600),
                subcode: x(0),
                msg: x(Ve(n))
            })
        }, function(n) {
            return zr.error({
                code: n.status_code,
                subcode: n.sub_code,
                msg: n.msg
            })
        })
    }, _t = function(n) {
        return Le("EmbedResponse.success", kt.responseSucceeded(), n).fold(function(n) {
            return zr.error({
                code: x(601),
                subcode: x(0),
                msg: x(Ve(n))
            })
        }, function(n) {
            return zr.value({
                recommended: x({
                    html: n.html,
                    source: n.rels().source
                })
            })
        })
    };
    function Dt(n, r, e) {
        var t, o, u, i, a, c, f, s, l = (t = e,
        a = void 0 !== o ? o : Yr,
        c = K("result", "timestamp"),
        f = {},
        s = function(n, r, e) {
            f[n] = c(r, e)
        }
        ,
        R(t) && (u = t,
        i = $r.now(),
        rn(u, function(n, r) {
            i - n.timestamp < a && s(r, n.result, n.timestamp)
        })),
        {
            set: s,
            get: function(r, n) {
                return D.from(f[n]).filter(function(n) {
                    return r - n.timestamp() < a
                }).map(function(n) {
                    return n.result()
                })
            },
            dump: function() {
                return rn(f, function(n) {
                    return {
                        result: n.result(),
                        timestamp: n.timestamp()
                    }
                })
            }
        }), d = mt("ephox.media.service.one", kt.requestOne(), n + "/1/embed?url=${url}&maxWidth=${maxWidth}", r);
        return {
            checkOne: function(e, t, n) {
                var r = $r.now()
                  , o = pt(function(n, r) {
                    return d.execute({
                        url: encodeURIComponent(e),
                        maxWidth: t,
                        fresh: r
                    })
                }, l, t + "&" + e, r, void 0 !== n && n);
                return Xr.foldSync(o, jt, _t)
            },
            dumpCache: l.dump
        }
    }
    var At = function(t) {
        var n, r, o = (n = t.mediaembed_service_url,
        r = rr(t),
        Dt(n, r ? {
            "tinymce-api-key": r
        } : {})), u = function(n, r, e) {
            return o.checkOne(n, r, e)
        }, i = {};
        return {
            getOne: u,
            dumpCache: function() {
                o.dumpCache()
            },
            getAndHandleResponse: function(e, n, r) {
                void 0 !== i[e] ? i[e] = i[e].concat(n) : (i[e] = [n],
                Xr.handle(u(e.trim(), nr(t)), function(n) {
                    r(n),
                    delete i[e]
                }, function(r) {
                    W(i[e], function(n) {
                        n(r)
                    }),
                    delete i[e]
                }))
            }
        }
    }
      , Ct = function(t, o) {
        return function() {
            for (var n = [], r = 0; r < arguments.length; r++)
                n[r] = arguments[r];
            var e = t.console;
            e && o in e && e[o].apply(e, arguments)
        }
    }
      , Rt = {
        log: Ct(window, "log"),
        error: Ct(window, "error"),
        warn: Ct(window, "warm")
    }
      , It = function(t, o) {
        var u, i, r, n = (u = t,
        {
            formatMessage: Lr,
            showNotificationError: function(n) {
                r(Lr(n.msg(), n.code()))
            },
            showDialogError: function(n) {
                var r = n.msg()
                  , e = n.code();
                r !== i && u.windowManager.alert(Lr(0, e), function() {
                    i = ""
                }),
                i = r
            },
            showNotificationMsg: r = function(n) {
                u.notificationManager.open({
                    text: n,
                    type: "error"
                })
            }
        }), e = At(t.settings);
        return Mr(t),
        t.on("Init", function() {
            var n, r, e;
            r = o + "/content.min.css",
            e = er((n = t).settings, r),
            n.dom.loadCSS(e)
        }),
        t.on("SkinLoaded", function() {
            Zn(t.settings) ? (Cr(t, e, n),
            Pr(t, e, n)) : n.showNotificationMsg("You need to specify the mediaembed_service_url setting")
        }),
        {}
    };
    tinymce.PluginManager.add("mediaembed", function(n, r) {
        return tinymce.Env.ceFalse ? w(tinymce, "4.5.2") ? (Rt.error("The mediaembed plugin requires at least 4.5.2 version of TinyMCE."),
        {}) : It(n, r) : {}
    })
}(window);
