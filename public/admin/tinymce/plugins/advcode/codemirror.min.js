tinymce.codeMirrorLazyLoader.define("ephox.wrap.CodeMirror", [], function() {
    var e = window.CodeMirror;
    window.CodeMirror = void 0,
    function(e) {
        (this || window).CodeMirror = e();
    }(function() {
        "use strict";
        var e = navigator.userAgent
          , t = navigator.platform
          , g = /gecko\/\d/i.test(e)
          , n = /MSIE \d/.test(e)
          , r = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e)
          , w = n || r
          , x = w && (n ? document.documentMode || 6 : r[1])
          , m = /WebKit\//.test(e)
          , i = m && /Qt\/\d+\.\d+/.test(e)
          , o = /Chrome\//.test(e)
          , v = /Opera\//.test(e)
          , a = /Apple Computer/.test(navigator.vendor)
          , l = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e)
          , c = /PhantomJS/.test(e)
          , s = /AppleWebKit/.test(e) && /Mobile\/\w+/.test(e)
          , u = s || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e)
          , y = s || /Mac/.test(t)
          , f = /win/i.test(t)
          , h = v && e.match(/Version\/(\d*\.\d*)/);
        h && (h = Number(h[1])),
        h && 15 <= h && (m = !(v = !1));
        var d = y && (i || v && (null == h || h < 12.11))
          , p = g || w && 9 <= x
          , b = !1
          , C = !1;
        function S(e, t) {
            if (!(this instanceof S))
                return new S(e,t);
            this.options = t = t ? bo(t) : {},
            bo(Zn, t, !1),
            P(t);
            var n = t.value;
            "string" == typeof n && (n = new pi(n,t.mode,null,t.lineSeparator)),
            this.doc = n;
            var r = new S.inputStyles[t.inputStyle](this)
              , i = this.display = new k(e,n,r);
            W(i.wrapper.CodeMirror = this),
            O(this),
            t.lineWrapping && (this.display.wrapper.className += " CodeMirror-wrap"),
            t.autofocus && !u && i.input.focus(),
            R(this),
            this.state = {
                keyMaps: [],
                overlays: [],
                modeGen: 0,
                overwrite: !1,
                delayingBlurEvent: !1,
                focused: !1,
                suppressEdits: !1,
                pasteIncoming: !1,
                cutIncoming: !1,
                selectingText: !1,
                draggingText: !1,
                highlight: new so(),
                keySeq: null,
                specialChars: null
            };
            var o = this;
            for (var l in w && x < 11 && setTimeout(function() {
                o.display.input.reset(!0);
            }, 20),
            function(i) {
                var o = i.display;
                Vi(o.scroller, "mousedown", qt(i, an)),
                Vi(o.scroller, "dblclick", w && x < 11 ? qt(i, function(e) {
                    if (!Qi(i, e)) {
                        var t = sn(i, e);
                        if (t && !un(i, e) && !ln(i.display, e)) {
                            zi(e);
                            var n = i.findWordAt(t);
                            Be(i.doc, n.anchor, n.head);
                        }
                    }
                }) : function(e) {
                    Qi(i, e) || zi(e);
                }
                );
                p || Vi(o.scroller, "contextmenu", function(e) {
                    An(i, e);
                });
                var n, r = {
                    end: 0
                };
                function l() {
                    o.activeTouch && (n = setTimeout(function() {
                        o.activeTouch = null;
                    }, 1e3),
                    (r = o.activeTouch).end = +new Date());
                }
                function s(e, t) {
                    if (null == t.left)
                        return !0;
                    var n = t.left - e.left
                      , r = t.top - e.top;
                    return 400 < n * n + r * r;
                }
                Vi(o.scroller, "touchstart", function(e) {
                    if (!Qi(i, e) && !function(e) {
                        if (1 != e.touches.length)
                            return !1;
                        var t = e.touches[0];
                        return t.radiusX <= 1 && t.radiusY <= 1;
                    }(e)) {
                        clearTimeout(n);
                        var t = +new Date();
                        o.activeTouch = {
                            start: t,
                            moved: !1,
                            prev: t - r.end <= 300 ? r : null
                        },
                        1 == e.touches.length && (o.activeTouch.left = e.touches[0].pageX,
                        o.activeTouch.top = e.touches[0].pageY);
                    }
                }),
                Vi(o.scroller, "touchmove", function() {
                    o.activeTouch && (o.activeTouch.moved = !0);
                }),
                Vi(o.scroller, "touchend", function(e) {
                    var t = o.activeTouch;
                    if (t && !ln(o, e) && null != t.left && !t.moved && new Date() - t.start < 300) {
                        var n, r = i.coordsChar(o.activeTouch, "page");
                        n = !t.prev || s(t, t.prev) ? new Fe(r,r) : !t.prev.prev || s(t, t.prev.prev) ? i.findWordAt(r) : new Fe(he(r.line, 0),Ie(i.doc, he(r.line + 1, 0))),
                        i.setSelection(n.anchor, n.head),
                        i.focus(),
                        zi(e);
                    }
                    l();
                }),
                Vi(o.scroller, "touchcancel", l),
                Vi(o.scroller, "scroll", function() {
                    o.scroller.clientHeight && (pn(i, o.scroller.scrollTop),
                    gn(i, o.scroller.scrollLeft, !0),
                    Xi(i, "scroll", i));
                }),
                Vi(o.scroller, "mousewheel", function(e) {
                    bn(i, e);
                }),
                Vi(o.scroller, "DOMMouseScroll", function(e) {
                    bn(i, e);
                }),
                Vi(o.wrapper, "scroll", function() {
                    o.wrapper.scrollTop = o.wrapper.scrollLeft = 0;
                }),
                o.dragFunctions = {
                    enter: function(e) {
                        Qi(i, e) || Ui(e);
                    },
                    over: function(e) {
                        Qi(i, e) || (!function(e, t) {
                            var n = sn(e, t);
                            if (!n)
                                return;
                            var r = document.createDocumentFragment();
                            tt(e, n, r),
                            e.display.dragCursor || (e.display.dragCursor = No("div", null, "CodeMirror-cursors CodeMirror-dragcursors"),
                            e.display.lineSpace.insertBefore(e.display.dragCursor, e.display.cursorDiv));
                            Ao(e.display.dragCursor, r);
                        }(i, e),
                        Ui(e));
                    },
                    start: function(e) {
                        !function(e, t) {
                            if (w && (!e.state.draggingText || +new Date() - fn < 100))
                                return Ui(t);
                            if (Qi(e, t) || ln(e.display, t))
                                return;
                            if (t.dataTransfer.setData("Text", e.getSelection()),
                            t.dataTransfer.setDragImage && !a) {
                                var n = No("img", null, null, "position: fixed; left: 0; top: 0;");
                                n.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",
                                v && (n.width = n.height = 1,
                                e.display.wrapper.appendChild(n),
                                n._top = n.offsetTop),
                                t.dataTransfer.setDragImage(n, 0, 0),
                                v && n.parentNode.removeChild(n);
                            }
                        }(i, e);
                    },
                    drop: qt(i, hn),
                    leave: function(e) {
                        Qi(i, e) || dn(i);
                    }
                };
                var e = o.input.getField();
                Vi(e, "keyup", function(e) {
                    Mn.call(i, e);
                }),
                Vi(e, "keydown", qt(i, Ln)),
                Vi(e, "keypress", qt(i, Tn)),
                Vi(e, "focus", wo(Nn, i)),
                Vi(e, "blur", wo(On, i));
            }(this),
            function() {
                if (zo)
                    return;
                Vi(window, "resize", function() {
                    null == e && (e = setTimeout(function() {
                        e = null,
                        Eo(on);
                    }, 100));
                }),
                Vi(window, "blur", function() {
                    Eo(On);
                }),
                zo = !0;
                var e;
            }(),
            Bt(this),
            this.curOp.forceUpdate = !0,
            yi(this, n),
            t.autofocus && !u || o.hasFocus() ? setTimeout(wo(Nn, this), 20) : On(this),
            Qn)
                Qn.hasOwnProperty(l) && Qn[l](this, t[l], er);
            V(this),
            t.finishInit && t.finishInit(this);
            for (var s = 0; s < ir.length; ++s)
                ir[s](this);
            Ut(this),
            m && t.lineWrapping && "optimizelegibility" == getComputedStyle(i.lineDiv).textRendering && (i.lineDiv.style.textRendering = "auto");
        }
        function k(e, t, n) {
            var r = this;
            this.input = n,
            r.scrollbarFiller = No("div", null, "CodeMirror-scrollbar-filler"),
            r.scrollbarFiller.setAttribute("cm-not-content", "true"),
            r.gutterFiller = No("div", null, "CodeMirror-gutter-filler"),
            r.gutterFiller.setAttribute("cm-not-content", "true"),
            r.lineDiv = No("div", null, "CodeMirror-code"),
            r.selectionDiv = No("div", null, null, "position: relative; z-index: 1"),
            r.cursorDiv = No("div", null, "CodeMirror-cursors"),
            r.measure = No("div", null, "CodeMirror-measure"),
            r.lineMeasure = No("div", null, "CodeMirror-measure"),
            r.lineSpace = No("div", [r.measure, r.lineMeasure, r.selectionDiv, r.cursorDiv, r.lineDiv], null, "position: relative; outline: none"),
            r.mover = No("div", [No("div", [r.lineSpace], "CodeMirror-lines")], null, "position: relative"),
            r.sizer = No("div", [r.mover], "CodeMirror-sizer"),
            r.sizerWidth = null,
            r.heightForcer = No("div", null, null, "position: absolute; height: " + no + "px; width: 1px;"),
            r.gutters = No("div", null, "CodeMirror-gutters"),
            r.lineGutter = null,
            r.scroller = No("div", [r.sizer, r.heightForcer, r.gutters], "CodeMirror-scroll"),
            r.scroller.setAttribute("tabIndex", "-1"),
            r.wrapper = No("div", [r.scrollbarFiller, r.gutterFiller, r.scroller], "CodeMirror"),
            w && x < 8 && (r.gutters.style.zIndex = -1,
            r.scroller.style.paddingRight = 0),
            m || g && u || (r.scroller.draggable = !0),
            e && (e.appendChild ? e.appendChild(r.wrapper) : e(r.wrapper)),
            r.viewFrom = r.viewTo = t.first,
            r.reportedViewFrom = r.reportedViewTo = t.first,
            r.view = [],
            r.renderedView = null,
            r.externalMeasured = null,
            r.viewOffset = 0,
            r.lastWrapHeight = r.lastWrapWidth = 0,
            r.updateLineNumbers = null,
            r.nativeBarWidth = r.barHeight = r.barWidth = 0,
            r.scrollbarsClipped = !1,
            r.lineNumWidth = r.lineNumInnerWidth = r.lineNumChars = null,
            r.alignWidgets = !1,
            r.cachedCharWidth = r.cachedTextHeight = r.cachedPaddingH = null,
            r.maxLine = null,
            r.maxLineLength = 0,
            r.maxLineChanged = !1,
            r.wheelDX = r.wheelDY = r.wheelStartX = r.wheelStartY = null,
            r.shift = !1,
            r.selForContextMenu = null,
            r.activeTouch = null,
            n.init(r);
        }
        function L(e) {
            e.doc.mode = S.getMode(e.options, e.doc.modeOption),
            M(e);
        }
        function M(e) {
            e.doc.iter(function(e) {
                e.stateAfter && (e.stateAfter = null),
                e.styles && (e.styles = null);
            }),
            e.doc.frontier = e.doc.first,
            it(e, 100),
            e.state.modeGen++,
            e.curOp && Qt(e);
        }
        function T(r) {
            var i = Dt(r.display)
              , o = r.options.lineWrapping
              , l = o && Math.max(5, r.display.scroller.clientWidth / Pt(r.display) - 3);
            return function(e) {
                if (Br(r.doc, e))
                    return 0;
                var t = 0;
                if (e.widgets)
                    for (var n = 0; n < e.widgets.length; n++)
                        e.widgets[n].height && (t += e.widgets[n].height);
                return o ? t + (Math.ceil(e.text.length / l) || 1) * i : t + i;
            }
            ;
        }
        function N(e) {
            var t = e.doc
              , n = T(e);
            t.iter(function(e) {
                var t = n(e);
                t != e.height && Ci(e, t);
            });
        }
        function O(e) {
            e.display.wrapper.className = e.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + e.options.theme.replace(/(^|\s)\s*/g, " cm-s-"),
            St(e);
        }
        function A(e) {
            W(e),
            Qt(e),
            setTimeout(function() {
                K(e);
            }, 20);
        }
        function W(e) {
            var t = e.display.gutters
              , n = e.options.gutters;
            Oo(t);
            for (var r = 0; r < n.length; ++r) {
                var i = n[r]
                  , o = t.appendChild(No("div", null, "CodeMirror-gutter " + i));
                "CodeMirror-linenumbers" == i && ((e.display.lineGutter = o).style.width = (e.display.lineNumWidth || 1) + "px");
            }
            t.style.display = r ? "" : "none",
            F(e);
        }
        function F(e) {
            var t = e.display.gutters.offsetWidth;
            e.display.sizer.style.marginLeft = t + "px";
        }
        function H(e) {
            if (0 == e.height)
                return 0;
            for (var t, n = e.text.length, r = e; t = Dr(r); ) {
                r = (i = t.find(0, !0)).from.line,
                n += i.from.ch - i.to.ch;
            }
            for (r = e; t = Pr(r); ) {
                var i = t.find(0, !0);
                n -= r.text.length - i.from.ch,
                n += (r = i.to.line).text.length - i.to.ch;
            }
            return n;
        }
        function D(e) {
            var n = e.display
              , t = e.doc;
            n.maxLine = bi(t, t.first),
            n.maxLineLength = H(n.maxLine),
            n.maxLineChanged = !0,
            t.iter(function(e) {
                var t = H(e);
                t > n.maxLineLength && (n.maxLineLength = t,
                n.maxLine = e);
            });
        }
        function P(e) {
            var t = go(e.gutters, "CodeMirror-linenumbers");
            -1 == t && e.lineNumbers ? e.gutters = e.gutters.concat(["CodeMirror-linenumbers"]) : -1 < t && !e.lineNumbers && (e.gutters = e.gutters.slice(0),
            e.gutters.splice(t, 1));
        }
        function I(e) {
            var t = e.display
              , n = t.gutters.offsetWidth
              , r = Math.round(e.doc.height + at(e.display));
            return {
                clientHeight: t.scroller.clientHeight,
                viewHeight: t.wrapper.clientHeight,
                scrollWidth: t.scroller.scrollWidth,
                clientWidth: t.scroller.clientWidth,
                viewWidth: t.wrapper.clientWidth,
                barLeft: e.options.fixedGutter ? n : 0,
                docHeight: r,
                scrollHeight: r + ut(e) + t.barHeight,
                nativeBarWidth: t.nativeBarWidth,
                gutterWidth: n
            };
        }
        function E(e, t, n) {
            this.cm = n;
            var r = this.vert = No("div", [No("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar")
              , i = this.horiz = No("div", [No("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
            e(r),
            e(i),
            Vi(r, "scroll", function() {
                r.clientHeight && t(r.scrollTop, "vertical");
            }),
            Vi(i, "scroll", function() {
                i.clientWidth && t(i.scrollLeft, "horizontal");
            }),
            this.checkedZeroWidth = !1,
            w && x < 8 && (this.horiz.style.minHeight = this.vert.style.minWidth = "18px");
        }
        function z() {}
        function R(n) {
            n.display.scrollbars && (n.display.scrollbars.clear(),
            n.display.scrollbars.addClass && Do(n.display.wrapper, n.display.scrollbars.addClass)),
            n.display.scrollbars = new S.scrollbarModel[n.options.scrollbarStyle](function(e) {
                n.display.wrapper.insertBefore(e, n.display.scrollbarFiller),
                Vi(e, "mousedown", function() {
                    n.state.focused && setTimeout(function() {
                        n.display.input.focus();
                    }, 0);
                }),
                e.setAttribute("cm-not-content", "true");
            }
            ,function(e, t) {
                "horizontal" == t ? gn(n, e) : pn(n, e);
            }
            ,n),
            n.display.scrollbars.addClass && Po(n.display.wrapper, n.display.scrollbars.addClass);
        }
        function B(e, t) {
            t || (t = I(e));
            var n = e.display.barWidth
              , r = e.display.barHeight;
            U(e, t);
            for (var i = 0; i < 4 && n != e.display.barWidth || r != e.display.barHeight; i++)
                n != e.display.barWidth && e.options.lineWrapping && Q(e),
                U(e, I(e)),
                n = e.display.barWidth,
                r = e.display.barHeight;
        }
        function U(e, t) {
            var n = e.display
              , r = n.scrollbars.update(t);
            n.sizer.style.paddingRight = (n.barWidth = r.right) + "px",
            n.sizer.style.paddingBottom = (n.barHeight = r.bottom) + "px",
            n.heightForcer.style.borderBottom = r.bottom + "px solid transparent",
            r.right && r.bottom ? (n.scrollbarFiller.style.display = "block",
            n.scrollbarFiller.style.height = r.bottom + "px",
            n.scrollbarFiller.style.width = r.right + "px") : n.scrollbarFiller.style.display = "",
            r.bottom && e.options.coverGutterNextToScrollbar && e.options.fixedGutter ? (n.gutterFiller.style.display = "block",
            n.gutterFiller.style.height = r.bottom + "px",
            n.gutterFiller.style.width = t.gutterWidth + "px") : n.gutterFiller.style.display = "";
        }
        function G(e, t, n) {
            var r = n && null != n.top ? Math.max(0, n.top) : e.scroller.scrollTop;
            r = Math.floor(r - st(e));
            var i = n && null != n.bottom ? n.bottom : r + e.wrapper.clientHeight
              , o = ki(t, r)
              , l = ki(t, i);
            if (n && n.ensure) {
                var s = n.ensure.from.line
                  , a = n.ensure.to.line;
                s < o ? l = ki(t, Li(bi(t, o = s)) + e.wrapper.clientHeight) : Math.min(a, t.lastLine()) >= l && (o = ki(t, Li(bi(t, a)) - e.wrapper.clientHeight),
                l = a);
            }
            return {
                from: o,
                to: Math.max(l, o + 1)
            };
        }
        function K(e) {
            var t = e.display
              , n = t.view;
            if (t.alignWidgets || t.gutters.firstChild && e.options.fixedGutter) {
                for (var r = _(t) - t.scroller.scrollLeft + e.doc.scrollLeft, i = t.gutters.offsetWidth, o = r + "px", l = 0; l < n.length; l++)
                    if (!n[l].hidden) {
                        e.options.fixedGutter && n[l].gutter && (n[l].gutter.style.left = o);
                        var s = n[l].alignable;
                        if (s)
                            for (var a = 0; a < s.length; a++)
                                s[a].style.left = o;
                    }
                e.options.fixedGutter && (t.gutters.style.left = r + i + "px");
            }
        }
        function V(e) {
            if (!e.options.lineNumbers)
                return !1;
            var t = e.doc
              , n = j(e.options, t.first + t.size - 1)
              , r = e.display;
            if (n.length != r.lineNumChars) {
                var i = r.measure.appendChild(No("div", [No("div", n)], "CodeMirror-linenumber CodeMirror-gutter-elt"))
                  , o = i.firstChild.offsetWidth
                  , l = i.offsetWidth - o;
                return r.lineGutter.style.width = "",
                r.lineNumInnerWidth = Math.max(o, r.lineGutter.offsetWidth - l) + 1,
                r.lineNumWidth = r.lineNumInnerWidth + l,
                r.lineNumChars = r.lineNumInnerWidth ? n.length : -1,
                r.lineGutter.style.width = r.lineNumWidth + "px",
                F(e),
                !0;
            }
            return !1;
        }
        function j(e, t) {
            return String(e.lineNumberFormatter(t + e.firstLineNumber));
        }
        function _(e) {
            return e.scroller.getBoundingClientRect().left - e.sizer.getBoundingClientRect().left;
        }
        function q(e, t, n) {
            var r = e.display;
            this.viewport = t,
            this.visible = G(r, e.doc, t),
            this.editorIsHidden = !r.wrapper.offsetWidth,
            this.wrapperHeight = r.wrapper.clientHeight,
            this.wrapperWidth = r.wrapper.clientWidth,
            this.oldDisplayWidth = ft(e),
            this.force = n,
            this.dims = ee(e),
            this.events = [];
        }
        function X(e, t) {
            var n = e.display
              , r = e.doc;
            if (t.editorIsHidden)
                return en(e),
                !1;
            if (!t.force && t.visible.from >= n.viewFrom && t.visible.to <= n.viewTo && (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo) && n.renderedView == n.view && 0 == rn(e))
                return !1;
            V(e) && (en(e),
            t.dims = ee(e));
            var i = r.first + r.size
              , o = Math.max(t.visible.from - e.options.viewportMargin, r.first)
              , l = Math.min(i, t.visible.to + e.options.viewportMargin);
            n.viewFrom < o && o - n.viewFrom < 20 && (o = Math.max(r.first, n.viewFrom)),
            n.viewTo > l && n.viewTo - l < 20 && (l = Math.min(i, n.viewTo)),
            C && (o = zr(e.doc, o),
            l = Rr(e.doc, l));
            var s = o != n.viewFrom || l != n.viewTo || n.lastWrapHeight != t.wrapperHeight || n.lastWrapWidth != t.wrapperWidth;
            !function(e, t, n) {
                var r = e.display;
                0 == r.view.length || t >= r.viewTo || n <= r.viewFrom ? (r.view = Zt(e, t, n),
                r.viewFrom = t) : (r.viewFrom > t ? r.view = Zt(e, t, r.viewFrom).concat(r.view) : r.viewFrom < t && (r.view = r.view.slice(tn(e, t))),
                r.viewFrom = t,
                r.viewTo < n ? r.view = r.view.concat(Zt(e, r.viewTo, n)) : r.viewTo > n && (r.view = r.view.slice(0, tn(e, n))));
                r.viewTo = n;
            }(e, o, l),
            n.viewOffset = Li(bi(e.doc, n.viewFrom)),
            e.display.mover.style.top = n.viewOffset + "px";
            var a = rn(e);
            if (!s && 0 == a && !t.force && n.renderedView == n.view && (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo))
                return !1;
            var c = Fo();
            return 4 < a && (n.lineDiv.style.display = "none"),
            function(n, e, t) {
                var r = n.display
                  , i = n.options.lineNumbers
                  , o = r.lineDiv
                  , l = o.firstChild;
                function s(e) {
                    var t = e.nextSibling;
                    return m && y && n.display.currentWheelTarget == e ? e.style.display = "none" : e.parentNode.removeChild(e),
                    t;
                }
                for (var a = r.view, c = r.viewFrom, u = 0; u < a.length; u++) {
                    var f = a[u];
                    if (f.hidden)
                        ;
                    else if (f.node && f.node.parentNode == o) {
                        for (; l != f.node; )
                            l = s(l);
                        var h = i && null != e && e <= c && f.lineNumber;
                        f.changes && (-1 < go(f.changes, "gutter") && (h = !1),
                        te(n, f, c, t)),
                        h && (Oo(f.lineNumber),
                        f.lineNumber.appendChild(document.createTextNode(j(n.options, c)))),
                        l = f.node.nextSibling;
                    } else {
                        var d = ae(n, f, c, t);
                        o.insertBefore(d, l);
                    }
                    c += f.size;
                }
                for (; l; )
                    l = s(l);
            }(e, n.updateLineNumbers, t.dims),
            4 < a && (n.lineDiv.style.display = ""),
            n.renderedView = n.view,
            c && Fo() != c && c.offsetHeight && c.focus(),
            Oo(n.cursorDiv),
            Oo(n.selectionDiv),
            n.gutters.style.height = n.sizer.style.minHeight = 0,
            s && (n.lastWrapHeight = t.wrapperHeight,
            n.lastWrapWidth = t.wrapperWidth,
            it(e, 400)),
            !(n.updateLineNumbers = null);
        }
        function Y(e, t) {
            for (var n = t.viewport, r = !0; (r && e.options.lineWrapping && t.oldDisplayWidth != ft(e) || (n && null != n.top && (n = {
                top: Math.min(e.doc.height + at(e.display) - ht(e), n.top)
            }),
            t.visible = G(e.display, e.doc, n),
            !(t.visible.from >= e.display.viewFrom && t.visible.to <= e.display.viewTo))) && X(e, t); r = !1) {
                Q(e);
                var i = I(e);
                Je(e),
                B(e, i),
                Z(e, i);
            }
            t.signal(e, "update", e),
            e.display.viewFrom == e.display.reportedViewFrom && e.display.viewTo == e.display.reportedViewTo || (t.signal(e, "viewportChange", e, e.display.viewFrom, e.display.viewTo),
            e.display.reportedViewFrom = e.display.viewFrom,
            e.display.reportedViewTo = e.display.viewTo);
        }
        function $(e, t) {
            var n = new q(e,t);
            if (X(e, n)) {
                Q(e),
                Y(e, n);
                var r = I(e);
                Je(e),
                B(e, r),
                Z(e, r),
                n.finish();
            }
        }
        function Z(e, t) {
            e.display.sizer.style.minHeight = t.docHeight + "px",
            e.display.heightForcer.style.top = t.docHeight + "px",
            e.display.gutters.style.height = t.docHeight + e.display.barHeight + ut(e) + "px";
        }
        function Q(e) {
            for (var t = e.display, n = t.lineDiv.offsetTop, r = 0; r < t.view.length; r++) {
                var i, o = t.view[r];
                if (!o.hidden) {
                    if (w && x < 8) {
                        var l = o.node.offsetTop + o.node.offsetHeight;
                        i = l - n,
                        n = l;
                    } else {
                        var s = o.node.getBoundingClientRect();
                        i = s.bottom - s.top;
                    }
                    var a = o.line.height - i;
                    if (i < 2 && (i = Dt(t)),
                    (.001 < a || a < -.001) && (Ci(o.line, i),
                    J(o.line),
                    o.rest))
                        for (var c = 0; c < o.rest.length; c++)
                            J(o.rest[c]);
                }
            }
        }
        function J(e) {
            if (e.widgets)
                for (var t = 0; t < e.widgets.length; ++t)
                    e.widgets[t].height = e.widgets[t].node.parentNode.offsetHeight;
        }
        function ee(e) {
            for (var t = e.display, n = {}, r = {}, i = t.gutters.clientLeft, o = t.gutters.firstChild, l = 0; o; o = o.nextSibling,
            ++l)
                n[e.options.gutters[l]] = o.offsetLeft + o.clientLeft + i,
                r[e.options.gutters[l]] = o.clientWidth;
            return {
                fixedPos: _(t),
                gutterTotalWidth: t.gutters.offsetWidth,
                gutterLeft: n,
                gutterWidth: r,
                wrapperWidth: t.wrapper.clientWidth
            };
        }
        function te(e, t, n, r) {
            for (var i = 0; i < t.changes.length; i++) {
                var o = t.changes[i];
                "text" == o ? ie(e, t) : "gutter" == o ? le(e, t, n, r) : "class" == o ? oe(t) : "widget" == o && se(e, t, r);
            }
            t.changes = null;
        }
        function ne(e) {
            return e.node == e.text && (e.node = No("div", null, null, "position: relative"),
            e.text.parentNode && e.text.parentNode.replaceChild(e.node, e.text),
            e.node.appendChild(e.text),
            w && x < 8 && (e.node.style.zIndex = 2)),
            e.node;
        }
        function re(e, t) {
            var n = e.display.externalMeasured;
            return n && n.line == t.line ? (e.display.externalMeasured = null,
            t.measure = n.measure,
            n.built) : ri(e, t);
        }
        function ie(e, t) {
            var n = t.text.className
              , r = re(e, t);
            t.text == t.node && (t.node = r.pre),
            t.text.parentNode.replaceChild(r.pre, t.text),
            t.text = r.pre,
            r.bgClass != t.bgClass || r.textClass != t.textClass ? (t.bgClass = r.bgClass,
            t.textClass = r.textClass,
            oe(t)) : n && (t.text.className = n);
        }
        function oe(e) {
            !function(e) {
                var t = e.bgClass ? e.bgClass + " " + (e.line.bgClass || "") : e.line.bgClass;
                if (t && (t += " CodeMirror-linebackground"),
                e.background)
                    t ? e.background.className = t : (e.background.parentNode.removeChild(e.background),
                    e.background = null);
                else if (t) {
                    var n = ne(e);
                    e.background = n.insertBefore(No("div", null, t), n.firstChild);
                }
            }(e),
            e.line.wrapClass ? ne(e).className = e.line.wrapClass : e.node != e.text && (e.node.className = "");
            var t = e.textClass ? e.textClass + " " + (e.line.textClass || "") : e.line.textClass;
            e.text.className = t || "";
        }
        function le(e, t, n, r) {
            if (t.gutter && (t.node.removeChild(t.gutter),
            t.gutter = null),
            t.gutterBackground && (t.node.removeChild(t.gutterBackground),
            t.gutterBackground = null),
            t.line.gutterClass) {
                var i = ne(t);
                t.gutterBackground = No("div", null, "CodeMirror-gutter-background " + t.line.gutterClass, "left: " + (e.options.fixedGutter ? r.fixedPos : -r.gutterTotalWidth) + "px; width: " + r.gutterTotalWidth + "px"),
                i.insertBefore(t.gutterBackground, t.text);
            }
            var o = t.line.gutterMarkers;
            if (e.options.lineNumbers || o) {
                i = ne(t);
                var l = t.gutter = No("div", null, "CodeMirror-gutter-wrapper", "left: " + (e.options.fixedGutter ? r.fixedPos : -r.gutterTotalWidth) + "px");
                if (e.display.input.setUneditable(l),
                i.insertBefore(l, t.text),
                t.line.gutterClass && (l.className += " " + t.line.gutterClass),
                !e.options.lineNumbers || o && o["CodeMirror-linenumbers"] || (t.lineNumber = l.appendChild(No("div", j(e.options, n), "CodeMirror-linenumber CodeMirror-gutter-elt", "left: " + r.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + e.display.lineNumInnerWidth + "px"))),
                o)
                    for (var s = 0; s < e.options.gutters.length; ++s) {
                        var a = e.options.gutters[s]
                          , c = o.hasOwnProperty(a) && o[a];
                        c && l.appendChild(No("div", [c], "CodeMirror-gutter-elt", "left: " + r.gutterLeft[a] + "px; width: " + r.gutterWidth[a] + "px"));
                    }
            }
        }
        function se(e, t, n) {
            t.alignable && (t.alignable = null);
            for (var r = t.node.firstChild; r; r = i) {
                var i = r.nextSibling;
                "CodeMirror-linewidget" == r.className && t.node.removeChild(r);
            }
            ce(e, t, n);
        }
        function ae(e, t, n, r) {
            var i = re(e, t);
            return t.text = t.node = i.pre,
            i.bgClass && (t.bgClass = i.bgClass),
            i.textClass && (t.textClass = i.textClass),
            oe(t),
            le(e, t, n, r),
            ce(e, t, r),
            t.node;
        }
        function ce(e, t, n) {
            if (ue(e, t.line, t, n, !0),
            t.rest)
                for (var r = 0; r < t.rest.length; r++)
                    ue(e, t.rest[r], t, n, !1);
        }
        function ue(e, t, n, r, i) {
            if (t.widgets)
                for (var o = ne(n), l = 0, s = t.widgets; l < s.length; ++l) {
                    var a = s[l]
                      , c = No("div", [a.node], "CodeMirror-linewidget");
                    a.handleMouseEvents || c.setAttribute("cm-ignore-events", "true"),
                    fe(a, c, n, r),
                    e.display.input.setUneditable(c),
                    i && a.above ? o.insertBefore(c, n.gutter || n.text) : o.appendChild(c),
                    $i(a, "redraw");
                }
        }
        function fe(e, t, n, r) {
            if (e.noHScroll) {
                (n.alignable || (n.alignable = [])).push(t);
                var i = r.wrapperWidth;
                t.style.left = r.fixedPos + "px",
                e.coverGutter || (i -= r.gutterTotalWidth,
                t.style.paddingLeft = r.gutterTotalWidth + "px"),
                t.style.width = i + "px";
            }
            e.coverGutter && (t.style.zIndex = 5,
            t.style.position = "relative",
            e.noHScroll || (t.style.marginLeft = -r.gutterTotalWidth + "px"));
        }
        E.prototype = bo({
            update: function(e) {
                var t = e.scrollWidth > e.clientWidth + 1
                  , n = e.scrollHeight > e.clientHeight + 1
                  , r = e.nativeBarWidth;
                if (n) {
                    this.vert.style.display = "block",
                    this.vert.style.bottom = t ? r + "px" : "0";
                    var i = e.viewHeight - (t ? r : 0);
                    this.vert.firstChild.style.height = Math.max(0, e.scrollHeight - e.clientHeight + i) + "px";
                } else
                    this.vert.style.display = "",
                    this.vert.firstChild.style.height = "0";
                if (t) {
                    this.horiz.style.display = "block",
                    this.horiz.style.right = n ? r + "px" : "0",
                    this.horiz.style.left = e.barLeft + "px";
                    var o = e.viewWidth - e.barLeft - (n ? r : 0);
                    this.horiz.firstChild.style.width = e.scrollWidth - e.clientWidth + o + "px";
                } else
                    this.horiz.style.display = "",
                    this.horiz.firstChild.style.width = "0";
                return !this.checkedZeroWidth && 0 < e.clientHeight && (0 == r && this.zeroWidthHack(),
                this.checkedZeroWidth = !0),
                {
                    right: n ? r : 0,
                    bottom: t ? r : 0
                };
            },
            setScrollLeft: function(e) {
                this.horiz.scrollLeft != e && (this.horiz.scrollLeft = e),
                this.disableHoriz && this.enableZeroWidthBar(this.horiz, this.disableHoriz);
            },
            setScrollTop: function(e) {
                this.vert.scrollTop != e && (this.vert.scrollTop = e),
                this.disableVert && this.enableZeroWidthBar(this.vert, this.disableVert);
            },
            zeroWidthHack: function() {
                var e = y && !l ? "12px" : "18px";
                this.horiz.style.height = this.vert.style.width = e,
                this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none",
                this.disableHoriz = new so(),
                this.disableVert = new so();
            },
            enableZeroWidthBar: function(n, r) {
                n.style.pointerEvents = "auto",
                r.set(1e3, function e() {
                    var t = n.getBoundingClientRect();
                    document.elementFromPoint(t.left + 1, t.bottom - 1) != n ? n.style.pointerEvents = "none" : r.set(1e3, e);
                });
            },
            clear: function() {
                var e = this.horiz.parentNode;
                e.removeChild(this.horiz),
                e.removeChild(this.vert);
            }
        }, E.prototype),
        z.prototype = bo({
            update: function() {
                return {
                    bottom: 0,
                    right: 0
                };
            },
            setScrollLeft: function() {},
            setScrollTop: function() {},
            clear: function() {}
        }, z.prototype),
        S.scrollbarModel = {
            native: E,
            null: z
        },
        q.prototype.signal = function(e, t) {
            eo(e, t) && this.events.push(arguments);
        }
        ,
        q.prototype.finish = function() {
            for (var e = 0; e < this.events.length; e++)
                Xi.apply(null, this.events[e]);
        }
        ;
        var he = S.Pos = function(e, t) {
            if (!(this instanceof he))
                return new he(e,t);
            this.line = e,
            this.ch = t;
        }
          , de = S.cmpPos = function(e, t) {
            return e.line - t.line || e.ch - t.ch;
        }
        ;
        function pe(e) {
            return he(e.line, e.ch);
        }
        function ge(e, t) {
            return de(e, t) < 0 ? t : e;
        }
        function me(e, t) {
            return de(e, t) < 0 ? e : t;
        }
        function ve(e) {
            e.state.focused || (e.display.input.focus(),
            Nn(e));
        }
        var ye = null;
        function be(e, t, n, r, i) {
            var o = e.doc;
            e.display.shift = !1,
            r || (r = o.sel);
            var l = e.state.pasteIncoming || "paste" == i
              , s = o.splitLines(t)
              , a = null;
            if (l && 1 < r.ranges.length)
                if (ye && ye.join("\n") == t) {
                    if (r.ranges.length % ye.length == 0) {
                        a = [];
                        for (var c = 0; c < ye.length; c++)
                            a.push(o.splitLines(ye[c]));
                    }
                } else
                    s.length == r.ranges.length && (a = mo(s, function(e) {
                        return [e];
                    }));
            for (c = r.ranges.length - 1; 0 <= c; c--) {
                var u = r.ranges[c]
                  , f = u.from()
                  , h = u.to();
                u.empty() && (n && 0 < n ? f = he(f.line, f.ch - n) : e.state.overwrite && !l && (h = he(h.line, Math.min(bi(o, h.line).text.length, h.ch + ho(s).length))));
                var d = e.curOp.updateInput
                  , p = {
                    from: f,
                    to: h,
                    text: a ? a[c % a.length] : s,
                    origin: i || (l ? "paste" : e.state.cutIncoming ? "cut" : "+input")
                };
                In(e.doc, p),
                $i(e, "inputRead", e, p);
            }
            t && !l && xe(e, t),
            Vn(e),
            e.curOp.updateInput = d,
            e.curOp.typing = !0,
            e.state.pasteIncoming = e.state.cutIncoming = !1;
        }
        function we(e, t) {
            var n = e.clipboardData && e.clipboardData.getData("text/plain");
            if (n)
                return e.preventDefault(),
                t.isReadOnly() || t.options.disableInput || _t(t, function() {
                    be(t, n, 0, null, "paste");
                }),
                !0;
        }
        function xe(e, t) {
            if (e.options.electricChars && e.options.smartIndent)
                for (var n = e.doc.sel, r = n.ranges.length - 1; 0 <= r; r--) {
                    var i = n.ranges[r];
                    if (!(100 < i.head.ch || r && n.ranges[r - 1].head.line == i.head.line)) {
                        var o = e.getModeAt(i.head)
                          , l = !1;
                        if (o.electricChars) {
                            for (var s = 0; s < o.electricChars.length; s++)
                                if (-1 < t.indexOf(o.electricChars.charAt(s))) {
                                    l = _n(e, i.head.line, "smart");
                                    break;
                                }
                        } else
                            o.electricInput && o.electricInput.test(bi(e.doc, i.head.line).text.slice(0, i.head.ch)) && (l = _n(e, i.head.line, "smart"));
                        l && $i(e, "electricInput", e, i.head.line);
                    }
                }
        }
        function Ce(e) {
            for (var t = [], n = [], r = 0; r < e.doc.sel.ranges.length; r++) {
                var i = e.doc.sel.ranges[r].head.line
                  , o = {
                    anchor: he(i, 0),
                    head: he(i + 1, 0)
                };
                n.push(o),
                t.push(e.getRange(o.anchor, o.head));
            }
            return {
                text: t,
                ranges: n
            };
        }
        function Se(e) {
            e.setAttribute("autocorrect", "off"),
            e.setAttribute("autocapitalize", "off"),
            e.setAttribute("spellcheck", "false");
        }
        function ke(e) {
            this.cm = e,
            this.prevInput = "",
            this.pollingFast = !1,
            this.polling = new so(),
            this.inaccurateSelection = !1,
            this.hasSelection = !1,
            this.composing = null;
        }
        function Le() {
            var e = No("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none")
              , t = No("div", [e], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
            return m ? e.style.width = "1000px" : e.setAttribute("wrap", "off"),
            s && (e.style.border = "1px solid black"),
            Se(e),
            t;
        }
        function Me(e) {
            this.cm = e,
            this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null,
            this.polling = new so(),
            this.gracePeriod = !1;
        }
        function Te(e, t) {
            var n = gt(e, t.line);
            if (!n || n.hidden)
                return null;
            var r = bi(e.doc, t.line)
              , i = dt(n, r, t.line)
              , o = Mi(r)
              , l = "left";
            o && (l = rl(o, t.ch) % 2 ? "right" : "left");
            var s = wt(i.map, t.ch, l);
            return s.offset = "right" == s.collapse ? s.end : s.start,
            s;
        }
        function Ne(e, t) {
            return t && (e.bad = !0),
            e;
        }
        function Oe(e, t, n) {
            var r;
            if (t == e.display.lineDiv) {
                if (!(r = e.display.lineDiv.childNodes[n]))
                    return Ne(e.clipPos(he(e.display.viewTo - 1)), !0);
                t = null,
                n = 0;
            } else
                for (r = t; ; r = r.parentNode) {
                    if (!r || r == e.display.lineDiv)
                        return null;
                    if (r.parentNode && r.parentNode == e.display.lineDiv)
                        break;
                }
            for (var i = 0; i < e.display.view.length; i++) {
                var o = e.display.view[i];
                if (o.node == r)
                    return Ae(o, t, n);
            }
        }
        function Ae(c, e, t) {
            var n = c.text.firstChild
              , r = !1;
            if (!e || !Wo(n, e))
                return Ne(he(Si(c.line), 0), !0);
            if (e == n && (r = !0,
            e = n.childNodes[t],
            t = 0,
            !e)) {
                var i = c.rest ? ho(c.rest) : c.line;
                return Ne(he(Si(i), i.text.length), r);
            }
            var o = 3 == e.nodeType ? e : null
              , l = e;
            for (o || 1 != e.childNodes.length || 3 != e.firstChild.nodeType || (o = e.firstChild,
            t && (t = o.nodeValue.length)); l.parentNode != n; )
                l = l.parentNode;
            var u = c.measure
              , f = u.maps;
            function s(e, t, n) {
                for (var r = -1; r < (f ? f.length : 0); r++)
                    for (var i = r < 0 ? u.map : f[r], o = 0; o < i.length; o += 3) {
                        var l = i[o + 2];
                        if (l == e || l == t) {
                            var s = Si(r < 0 ? c.line : c.rest[r])
                              , a = i[o] + n;
                            return (n < 0 || l != e) && (a = i[o + (n ? 1 : 0)]),
                            he(s, a);
                        }
                    }
            }
            var a = s(o, l, t);
            if (a)
                return Ne(a, r);
            for (var h = l.nextSibling, d = o ? o.nodeValue.length - t : 0; h; h = h.nextSibling) {
                if (a = s(h, h.firstChild, 0))
                    return Ne(he(a.line, a.ch - d), r);
                d += h.textContent.length;
            }
            var p = l.previousSibling;
            for (d = t; p; p = p.previousSibling) {
                if (a = s(p, p.firstChild, -1))
                    return Ne(he(a.line, a.ch + d), r);
                d += h.textContent.length;
            }
        }
        function We(e, t) {
            this.ranges = e,
            this.primIndex = t;
        }
        function Fe(e, t) {
            this.anchor = e,
            this.head = t;
        }
        function He(e, t) {
            var n = e[t];
            e.sort(function(e, t) {
                return de(e.from(), t.from());
            }),
            t = go(e, n);
            for (var r = 1; r < e.length; r++) {
                var i = e[r]
                  , o = e[r - 1];
                if (0 <= de(o.to(), i.from())) {
                    var l = me(o.from(), i.from())
                      , s = ge(o.to(), i.to())
                      , a = o.empty() ? i.from() == i.head : o.from() == o.head;
                    r <= t && --t,
                    e.splice(--r, 2, new Fe(a ? s : l,a ? l : s));
                }
            }
            return new We(e,t);
        }
        function De(e, t) {
            return new We([new Fe(e,t || e)],0);
        }
        function Pe(e, t) {
            return Math.max(e.first, Math.min(t, e.first + e.size - 1));
        }
        function Ie(e, t) {
            if (t.line < e.first)
                return he(e.first, 0);
            var n, r, i, o = e.first + e.size - 1;
            return t.line > o ? he(o, bi(e, o).text.length) : (r = bi(e, (n = t).line).text.length,
            null == (i = n.ch) || r < i ? he(n.line, r) : i < 0 ? he(n.line, 0) : n);
        }
        function Ee(e, t) {
            return t >= e.first && t < e.first + e.size;
        }
        function ze(e, t) {
            for (var n = [], r = 0; r < t.length; r++)
                n[r] = Ie(e, t[r]);
            return n;
        }
        function Re(e, t, n, r) {
            if (e.cm && e.cm.display.shift || e.extend) {
                var i = t.anchor;
                if (r) {
                    var o = de(n, i) < 0;
                    o != de(r, i) < 0 ? (i = n,
                    n = r) : o != de(n, r) < 0 && (n = r);
                }
                return new Fe(i,n);
            }
            return new Fe(r || n,n);
        }
        function Be(e, t, n, r) {
            je(e, new We([Re(e, e.sel.primary(), t, n)],0), r);
        }
        function Ue(e, t, n) {
            for (var r = [], i = 0; i < e.sel.ranges.length; i++)
                r[i] = Re(e, e.sel.ranges[i], t[i], null);
            je(e, He(r, e.sel.primIndex), n);
        }
        function Ge(e, t, n, r) {
            var i = e.sel.ranges.slice(0);
            i[t] = n,
            je(e, He(i, e.sel.primIndex), r);
        }
        function Ke(e, t, n, r) {
            je(e, De(t, n), r);
        }
        function Ve(e, t, n) {
            var r = e.history.done
              , i = ho(r);
            i && i.ranges ? _e(e, r[r.length - 1] = t, n) : je(e, t, n);
        }
        function je(e, t, n) {
            _e(e, t, n),
            function(e, t, n, r) {
                var i = e.history
                  , o = r && r.origin;
                n == i.lastSelOp || o && i.lastSelOrigin == o && (i.lastModTime == i.lastSelTime && i.lastOrigin == o || (l = e,
                s = o,
                a = ho(i.done),
                c = t,
                u = s.charAt(0),
                "*" == u || "+" == u && a.ranges.length == c.ranges.length && a.somethingSelected() == c.somethingSelected() && new Date() - l.history.lastSelTime <= (l.cm ? l.cm.options.historyEventDelay : 500))) ? i.done[i.done.length - 1] = t : Wi(t, i.done);
                var l, s, a, c, u;
                i.lastSelTime = +new Date(),
                i.lastSelOrigin = o,
                i.lastSelOp = n,
                r && !1 !== r.clearRedo && Oi(i.undone);
            }(e, e.sel, e.cm ? e.cm.curOp.id : NaN, n);
        }
        function _e(e, t, n) {
            var r, i, o, l;
            (eo(e, "beforeSelectionChange") || e.cm && eo(e.cm, "beforeSelectionChange")) && (r = e,
            o = n,
            l = {
                ranges: (i = t).ranges,
                update: function(e) {
                    this.ranges = [];
                    for (var t = 0; t < e.length; t++)
                        this.ranges[t] = new Fe(Ie(r, e[t].anchor),Ie(r, e[t].head));
                },
                origin: o && o.origin
            },
            Xi(r, "beforeSelectionChange", r, l),
            r.cm && Xi(r.cm, "beforeSelectionChange", r.cm, l),
            t = l.ranges != i.ranges ? He(l.ranges, l.ranges.length - 1) : i),
            qe(e, Ye(e, t, n && n.bias || (de(t.primary().head, e.sel.primary().head) < 0 ? -1 : 1), !0)),
            n && !1 === n.scroll || !e.cm || Vn(e.cm);
        }
        function qe(e, t) {
            t.equals(e.sel) || (e.sel = t,
            e.cm && (e.cm.curOp.updateInput = e.cm.curOp.selectionChanged = !0,
            Ji(e.cm)),
            $i(e, "cursorActivity", e));
        }
        function Xe(e) {
            qe(e, Ye(e, e.sel, null, !1));
        }
        function Ye(e, t, n, r) {
            for (var i, o = 0; o < t.ranges.length; o++) {
                var l = t.ranges[o]
                  , s = t.ranges.length == e.sel.ranges.length && e.sel.ranges[o]
                  , a = Ze(e, l.anchor, s && s.anchor, n, r)
                  , c = Ze(e, l.head, s && s.head, n, r);
                (i || a != l.anchor || c != l.head) && (i || (i = t.ranges.slice(0, o)),
                i[o] = new Fe(a,c));
            }
            return i ? He(i, t.primIndex) : t;
        }
        function $e(e, t, n, r, i) {
            var o = bi(e, t.line);
            if (o.markedSpans)
                for (var l = 0; l < o.markedSpans.length; ++l) {
                    var s = o.markedSpans[l]
                      , a = s.marker;
                    if ((null == s.from || (a.inclusiveLeft ? s.from <= t.ch : s.from < t.ch)) && (null == s.to || (a.inclusiveRight ? s.to >= t.ch : s.to > t.ch))) {
                        if (i && (Xi(a, "beforeCursorEnter"),
                        a.explicitlyCleared)) {
                            if (o.markedSpans) {
                                --l;
                                continue;
                            }
                            break;
                        }
                        if (!a.atomic)
                            continue;
                        if (n) {
                            var c, u = a.find(r < 0 ? 1 : -1);
                            if ((r < 0 ? a.inclusiveRight : a.inclusiveLeft) && (u = Qe(e, u, -r, u && u.line == t.line ? o : null)),
                            u && u.line == t.line && (c = de(u, n)) && (r < 0 ? c < 0 : 0 < c))
                                return $e(e, u, t, r, i);
                        }
                        var f = a.find(r < 0 ? -1 : 1);
                        return (r < 0 ? a.inclusiveLeft : a.inclusiveRight) && (f = Qe(e, f, r, f.line == t.line ? o : null)),
                        f ? $e(e, f, t, r, i) : null;
                    }
                }
            return t;
        }
        function Ze(e, t, n, r, i) {
            var o = r || 1
              , l = $e(e, t, n, o, i) || !i && $e(e, t, n, o, !0) || $e(e, t, n, -o, i) || !i && $e(e, t, n, -o, !0);
            return l || (e.cantEdit = !0,
            he(e.first, 0));
        }
        function Qe(e, t, n, r) {
            return n < 0 && 0 == t.ch ? t.line > e.first ? Ie(e, he(t.line - 1)) : null : 0 < n && t.ch == (r || bi(e, t.line)).text.length ? t.line < e.first + e.size - 1 ? he(t.line + 1, 0) : null : new he(t.line,t.ch + n);
        }
        function Je(e) {
            e.display.input.showSelection(e.display.input.prepareSelection());
        }
        function et(e, t) {
            for (var n = e.doc, r = {}, i = r.cursors = document.createDocumentFragment(), o = r.selection = document.createDocumentFragment(), l = 0; l < n.sel.ranges.length; l++)
                if (!1 !== t || l != n.sel.primIndex) {
                    var s = n.sel.ranges[l];
                    if (!(s.from().line >= e.display.viewTo || s.to().line < e.display.viewFrom)) {
                        var a = s.empty();
                        (a || e.options.showCursorWhenSelecting) && tt(e, s.head, i),
                        a || nt(e, s, o);
                    }
                }
            return r;
        }
        function tt(e, t, n) {
            var r = Ot(e, t, "div", null, null, !e.options.singleCursorHeightPerLine)
              , i = n.appendChild(No("div", "\xa0", "CodeMirror-cursor"));
            if (i.style.left = r.left + "px",
            i.style.top = r.top + "px",
            i.style.height = Math.max(0, r.bottom - r.top) * e.options.cursorHeight + "px",
            r.other) {
                var o = n.appendChild(No("div", "\xa0", "CodeMirror-cursor CodeMirror-secondarycursor"));
                o.style.display = "",
                o.style.left = r.other.left + "px",
                o.style.top = r.other.top + "px",
                o.style.height = .85 * (r.other.bottom - r.other.top) + "px";
            }
        }
        function nt(i, e, t) {
            var n = i.display
              , o = i.doc
              , l = document.createDocumentFragment()
              , r = ct(i.display)
              , p = r.left
              , g = Math.max(n.sizerWidth, ft(i) - n.sizer.offsetLeft) - r.right;
            function m(e, t, n, r) {
                t < 0 && (t = 0),
                t = Math.round(t),
                r = Math.round(r),
                l.appendChild(No("div", null, "CodeMirror-selected", "position: absolute; left: " + e + "px; top: " + t + "px; width: " + (null == n ? g - e : n) + "px; height: " + (r - t) + "px"));
            }
            function s(n, a, c) {
                var u, f, r = bi(o, n), h = r.text.length;
                function d(e, t) {
                    return Nt(i, he(n, e), "div", r, t);
                }
                return function(e, t, n, r) {
                    if (!e)
                        return r(t, n, "ltr");
                    for (var i = !1, o = 0; o < e.length; ++o) {
                        var l = e[o];
                        (l.from < n && l.to > t || t == n && l.to == t) && (r(Math.max(l.from, t), Math.min(l.to, n), 1 == l.level ? "rtl" : "ltr"),
                        i = !0);
                    }
                    i || r(t, n, "ltr");
                }(Mi(r), a || 0, null == c ? h : c, function(e, t, n) {
                    var r, i, o, l = d(e, "left");
                    if (e == t)
                        i = o = (r = l).left;
                    else {
                        if (r = d(t - 1, "right"),
                        "rtl" == n) {
                            var s = l;
                            l = r,
                            r = s;
                        }
                        i = l.left,
                        o = r.right;
                    }
                    null == a && 0 == e && (i = p),
                    3 < r.top - l.top && (m(i, l.top, null, l.bottom),
                    i = p,
                    l.bottom < r.top && m(i, l.bottom, null, r.top)),
                    null == c && t == h && (o = g),
                    (!u || l.top < u.top || l.top == u.top && l.left < u.left) && (u = l),
                    (!f || r.bottom > f.bottom || r.bottom == f.bottom && r.right > f.right) && (f = r),
                    i < p + 1 && (i = p),
                    m(i, r.top, o - i, r.bottom);
                }),
                {
                    start: u,
                    end: f
                };
            }
            var a = e.from()
              , c = e.to();
            if (a.line == c.line)
                s(a.line, a.ch, c.ch);
            else {
                var u = bi(o, a.line)
                  , f = bi(o, c.line)
                  , h = Er(u) == Er(f)
                  , d = s(a.line, a.ch, h ? u.text.length + 1 : null).end
                  , v = s(c.line, h ? 0 : null, c.ch).start;
                h && (d.top < v.top - 2 ? (m(d.right, d.top, null, d.bottom),
                m(p, v.top, v.left, v.bottom)) : m(d.right, d.top, v.left - d.right, d.bottom)),
                d.bottom < v.top && m(p, d.bottom, null, v.top);
            }
            t.appendChild(l);
        }
        function rt(e) {
            if (e.state.focused) {
                var t = e.display;
                clearInterval(t.blinker);
                var n = !0;
                t.cursorDiv.style.visibility = "",
                0 < e.options.cursorBlinkRate ? t.blinker = setInterval(function() {
                    t.cursorDiv.style.visibility = (n = !n) ? "" : "hidden";
                }, e.options.cursorBlinkRate) : e.options.cursorBlinkRate < 0 && (t.cursorDiv.style.visibility = "hidden");
            }
        }
        function it(e, t) {
            e.doc.mode.startState && e.doc.frontier < e.display.viewTo && e.state.highlight.set(t, wo(ot, e));
        }
        function ot(a) {
            var c = a.doc;
            if (c.frontier < c.first && (c.frontier = c.first),
            !(c.frontier >= a.display.viewTo)) {
                var u = +new Date() + a.options.workTime
                  , f = lr(c.mode, lt(a, c.frontier))
                  , h = [];
                c.iter(c.frontier, Math.min(c.first + c.size, a.display.viewTo + 500), function(e) {
                    if (c.frontier >= a.display.viewFrom) {
                        var t = e.styles
                          , n = e.text.length > a.options.maxHighlightLength
                          , r = Zr(a, e, n ? lr(c.mode, f) : f, !0);
                        e.styles = r.styles;
                        var i = e.styleClasses
                          , o = r.classes;
                        o ? e.styleClasses = o : i && (e.styleClasses = null);
                        for (var l = !t || t.length != e.styles.length || i != o && (!i || !o || i.bgClass != o.bgClass || i.textClass != o.textClass), s = 0; !l && s < t.length; ++s)
                            l = t[s] != e.styles[s];
                        l && h.push(c.frontier),
                        e.stateAfter = n ? f : lr(c.mode, f);
                    } else
                        e.text.length <= a.options.maxHighlightLength && Jr(a, e.text, f),
                        e.stateAfter = c.frontier % 5 == 0 ? lr(c.mode, f) : null;
                    if (++c.frontier,
                    +new Date() > u)
                        return it(a, a.options.workDelay),
                        !0;
                }),
                h.length && _t(a, function() {
                    for (var e = 0; e < h.length; e++)
                        Jt(a, h[e], "text");
                });
            }
        }
        function lt(n, r, e) {
            var i = n.doc
              , o = n.display;
            if (!i.mode.startState)
                return !0;
            var l = function(e, t, n) {
                for (var r, i, o = e.doc, l = n ? -1 : t - (e.doc.mode.innerMode ? 1e3 : 100), s = t; l < s; --s) {
                    if (s <= o.first)
                        return o.first;
                    var a = bi(o, s - 1);
                    if (a.stateAfter && (!n || s <= o.frontier))
                        return s;
                    var c = ao(a.text, null, e.options.tabSize);
                    (null == i || c < r) && (i = s - 1,
                    r = c);
                }
                return i;
            }(n, r, e)
              , s = l > i.first && bi(i, l - 1).stateAfter;
            return s = s ? lr(i.mode, s) : sr(i.mode),
            i.iter(l, r, function(e) {
                Jr(n, e.text, s);
                var t = l == r - 1 || l % 5 == 0 || l >= o.viewFrom && l < o.viewTo;
                e.stateAfter = t ? lr(i.mode, s) : null,
                ++l;
            }),
            e && (i.frontier = l),
            s;
        }
        function st(e) {
            return e.lineSpace.offsetTop;
        }
        function at(e) {
            return e.mover.offsetHeight - e.lineSpace.offsetHeight;
        }
        function ct(e) {
            if (e.cachedPaddingH)
                return e.cachedPaddingH;
            var t = Ao(e.measure, No("pre", "x"))
              , n = window.getComputedStyle ? window.getComputedStyle(t) : t.currentStyle
              , r = {
                left: parseInt(n.paddingLeft),
                right: parseInt(n.paddingRight)
            };
            return isNaN(r.left) || isNaN(r.right) || (e.cachedPaddingH = r),
            r;
        }
        function ut(e) {
            return no - e.display.nativeBarWidth;
        }
        function ft(e) {
            return e.display.scroller.clientWidth - ut(e) - e.display.barWidth;
        }
        function ht(e) {
            return e.display.scroller.clientHeight - ut(e) - e.display.barHeight;
        }
        function dt(e, t, n) {
            if (e.line == t)
                return {
                    map: e.measure.map,
                    cache: e.measure.cache
                };
            for (var r = 0; r < e.rest.length; r++)
                if (e.rest[r] == t)
                    return {
                        map: e.measure.maps[r],
                        cache: e.measure.caches[r]
                    };
            for (r = 0; r < e.rest.length; r++)
                if (Si(e.rest[r]) > n)
                    return {
                        map: e.measure.maps[r],
                        cache: e.measure.caches[r],
                        before: !0
                    };
        }
        function pt(e, t, n, r) {
            return vt(e, mt(e, t), n, r);
        }
        function gt(e, t) {
            if (t >= e.display.viewFrom && t < e.display.viewTo)
                return e.display.view[tn(e, t)];
            var n = e.display.externalMeasured;
            return n && t >= n.lineN && t < n.lineN + n.size ? n : void 0;
        }
        function mt(e, t) {
            var n = Si(t)
              , r = gt(e, n);
            r && !r.text ? r = null : r && r.changes && (te(e, r, n, ee(e)),
            e.curOp.forceUpdate = !0),
            r || (r = function(e, t) {
                var n = Si(t = Er(t))
                  , r = e.display.externalMeasured = new $t(e.doc,t,n);
                r.lineN = n;
                var i = r.built = ri(e, r);
                return r.text = i.pre,
                Ao(e.display.lineMeasure, i.pre),
                r;
            }(e, t));
            var i = dt(r, t, n);
            return {
                line: t,
                view: r,
                rect: null,
                map: i.map,
                cache: i.cache,
                before: i.before,
                hasHeights: !1
            };
        }
        function vt(e, t, n, r, i) {
            t.before && (n = -1);
            var o, l = n + (r || "");
            return t.cache.hasOwnProperty(l) ? o = t.cache[l] : (t.rect || (t.rect = t.view.text.getBoundingClientRect()),
            t.hasHeights || (!function(e, t, n) {
                var r = e.options.lineWrapping
                  , i = r && ft(e);
                if (!t.measure.heights || r && t.measure.width != i) {
                    var o = t.measure.heights = [];
                    if (r) {
                        t.measure.width = i;
                        for (var l = t.text.firstChild.getClientRects(), s = 0; s < l.length - 1; s++) {
                            var a = l[s]
                              , c = l[s + 1];
                            2 < Math.abs(a.bottom - c.bottom) && o.push((a.bottom + c.top) / 2 - n.top);
                        }
                    }
                    o.push(n.bottom - n.top);
                }
            }(e, t.view, t.rect),
            t.hasHeights = !0),
            (o = function(e, t, n, r) {
                var i, o = wt(t.map, n, r), l = o.node, s = o.start, a = o.end, c = o.collapse;
                if (3 == l.nodeType) {
                    for (var u = 0; u < 4; u++) {
                        for (; s && To(t.line.text.charAt(o.coverStart + s)); )
                            --s;
                        for (; o.coverStart + a < o.coverEnd && To(t.line.text.charAt(o.coverStart + a)); )
                            ++a;
                        if (w && x < 9 && 0 == s && a == o.coverEnd - o.coverStart)
                            i = l.parentNode.getBoundingClientRect();
                        else if (w && e.options.lineWrapping) {
                            var f = Lo(l, s, a).getClientRects();
                            i = f.length ? f["right" == r ? f.length - 1 : 0] : bt;
                        } else
                            i = Lo(l, s, a).getBoundingClientRect() || bt;
                        if (i.left || i.right || 0 == s)
                            break;
                        a = s,
                        s -= 1,
                        c = "right";
                    }
                    w && x < 11 && (i = function(e, t) {
                        if (!window.screen || null == screen.logicalXDPI || screen.logicalXDPI == screen.deviceXDPI || !function(e) {
                            if (null != Xo)
                                return Xo;
                            var t = Ao(e, No("span", "x"))
                              , n = t.getBoundingClientRect()
                              , r = Lo(t, 0, 1).getBoundingClientRect();
                            return Xo = 1 < Math.abs(n.left - r.left);
                        }(e))
                            return t;
                        var n = screen.logicalXDPI / screen.deviceXDPI
                          , r = screen.logicalYDPI / screen.deviceYDPI;
                        return {
                            left: t.left * n,
                            right: t.right * n,
                            top: t.top * r,
                            bottom: t.bottom * r
                        };
                    }(e.display.measure, i));
                } else {
                    0 < s && (c = r = "right"),
                    i = e.options.lineWrapping && 1 < (f = l.getClientRects()).length ? f["right" == r ? f.length - 1 : 0] : l.getBoundingClientRect();
                }
                if (w && x < 9 && !s && (!i || !i.left && !i.right)) {
                    var h = l.parentNode.getClientRects()[0];
                    i = h ? {
                        left: h.left,
                        right: h.left + Pt(e.display),
                        top: h.top,
                        bottom: h.bottom
                    } : bt;
                }
                for (var d = i.top - t.rect.top, p = i.bottom - t.rect.top, g = (d + p) / 2, m = t.view.measure.heights, u = 0; u < m.length - 1 && !(g < m[u]); u++)
                    ;
                var v = u ? m[u - 1] : 0
                  , y = m[u]
                  , b = {
                    left: ("right" == c ? i.right : i.left) - t.rect.left,
                    right: ("left" == c ? i.left : i.right) - t.rect.left,
                    top: v,
                    bottom: y
                };
                i.left || i.right || (b.bogus = !0);
                e.options.singleCursorHeightPerLine || (b.rtop = d,
                b.rbottom = p);
                return b;
            }(e, t, n, r)).bogus || (t.cache[l] = o)),
            {
                left: o.left,
                right: o.right,
                top: i ? o.rtop : o.top,
                bottom: i ? o.rbottom : o.bottom
            };
        }
        ke.prototype = bo({
            init: function(t) {
                var n = this
                  , r = this.cm
                  , e = this.wrapper = Le()
                  , i = this.textarea = e.firstChild;
                function o(e) {
                    if (!Qi(r, e)) {
                        if (r.somethingSelected())
                            ye = r.getSelections(),
                            n.inaccurateSelection && (n.prevInput = "",
                            n.inaccurateSelection = !1,
                            i.value = ye.join("\n"),
                            po(i));
                        else {
                            if (!r.options.lineWiseCopyCut)
                                return;
                            var t = Ce(r);
                            ye = t.text,
                            "cut" == e.type ? r.setSelections(t.ranges, null, io) : (n.prevInput = "",
                            i.value = t.text.join("\n"),
                            po(i));
                        }
                        "cut" == e.type && (r.state.cutIncoming = !0);
                    }
                }
                t.wrapper.insertBefore(e, t.wrapper.firstChild),
                s && (i.style.width = "0px"),
                Vi(i, "input", function() {
                    w && 9 <= x && n.hasSelection && (n.hasSelection = null),
                    n.poll();
                }),
                Vi(i, "paste", function(e) {
                    Qi(r, e) || we(e, r) || (r.state.pasteIncoming = !0,
                    n.fastPoll());
                }),
                Vi(i, "cut", o),
                Vi(i, "copy", o),
                Vi(t.scroller, "paste", function(e) {
                    ln(t, e) || Qi(r, e) || (r.state.pasteIncoming = !0,
                    n.focus());
                }),
                Vi(t.lineSpace, "selectstart", function(e) {
                    ln(t, e) || zi(e);
                }),
                Vi(i, "compositionstart", function() {
                    var e = r.getCursor("from");
                    n.composing && n.composing.range.clear(),
                    n.composing = {
                        start: e,
                        range: r.markText(e, r.getCursor("to"), {
                            className: "CodeMirror-composing"
                        })
                    };
                }),
                Vi(i, "compositionend", function() {
                    n.composing && (n.poll(),
                    n.composing.range.clear(),
                    n.composing = null);
                });
            },
            prepareSelection: function() {
                var e = this.cm
                  , t = e.display
                  , n = e.doc
                  , r = et(e);
                if (e.options.moveInputWithCursor) {
                    var i = Ot(e, n.sel.primary().head, "div")
                      , o = t.wrapper.getBoundingClientRect()
                      , l = t.lineDiv.getBoundingClientRect();
                    r.teTop = Math.max(0, Math.min(t.wrapper.clientHeight - 10, i.top + l.top - o.top)),
                    r.teLeft = Math.max(0, Math.min(t.wrapper.clientWidth - 10, i.left + l.left - o.left));
                }
                return r;
            },
            showSelection: function(e) {
                var t = this.cm.display;
                Ao(t.cursorDiv, e.cursors),
                Ao(t.selectionDiv, e.selection),
                null != e.teTop && (this.wrapper.style.top = e.teTop + "px",
                this.wrapper.style.left = e.teLeft + "px");
            },
            reset: function(e) {
                if (!this.contextMenuPending) {
                    var t, n, r = this.cm, i = r.doc;
                    if (r.somethingSelected()) {
                        this.prevInput = "";
                        var o = i.sel.primary()
                          , l = (t = qo && (100 < o.to().line - o.from().line || 1e3 < (n = r.getSelection()).length)) ? "-" : n || r.getSelection();
                        this.textarea.value = l,
                        r.state.focused && po(this.textarea),
                        w && 9 <= x && (this.hasSelection = l);
                    } else
                        e || (this.prevInput = this.textarea.value = "",
                        w && 9 <= x && (this.hasSelection = null));
                    this.inaccurateSelection = t;
                }
            },
            getField: function() {
                return this.textarea;
            },
            supportsTouch: function() {
                return !1;
            },
            focus: function() {
                if ("nocursor" != this.cm.options.readOnly && (!u || Fo() != this.textarea))
                    try {
                        this.textarea.focus();
                    } catch (e) {}
            },
            blur: function() {
                this.textarea.blur();
            },
            resetPosition: function() {
                this.wrapper.style.top = this.wrapper.style.left = 0;
            },
            receivedFocus: function() {
                this.slowPoll();
            },
            slowPoll: function() {
                var e = this;
                e.pollingFast || e.polling.set(this.cm.options.pollInterval, function() {
                    e.poll(),
                    e.cm.state.focused && e.slowPoll();
                });
            },
            fastPoll: function() {
                var t = !1
                  , n = this;
                n.pollingFast = !0,
                n.polling.set(20, function e() {
                    n.poll() || t ? (n.pollingFast = !1,
                    n.slowPoll()) : (t = !0,
                    n.polling.set(60, e));
                });
            },
            poll: function() {
                var e = this.cm
                  , t = this.textarea
                  , n = this.prevInput;
                if (this.contextMenuPending || !e.state.focused || _o(t) && !n && !this.composing || e.isReadOnly() || e.options.disableInput || e.state.keySeq)
                    return !1;
                var r = t.value;
                if (r == n && !e.somethingSelected())
                    return !1;
                if (w && 9 <= x && this.hasSelection === r || y && /[\uf700-\uf7ff]/.test(r))
                    return e.display.input.reset(),
                    !1;
                if (e.doc.sel == e.display.selForContextMenu) {
                    var i = r.charCodeAt(0);
                    if (8203 != i || n || (n = "\u200b"),
                    8666 == i)
                        return this.reset(),
                        this.cm.execCommand("undo");
                }
                for (var o = 0, l = Math.min(n.length, r.length); o < l && n.charCodeAt(o) == r.charCodeAt(o); )
                    ++o;
                var s = this;
                return _t(e, function() {
                    be(e, r.slice(o), n.length - o, null, s.composing ? "*compose" : null),
                    1e3 < r.length || -1 < r.indexOf("\n") ? t.value = s.prevInput = "" : s.prevInput = r,
                    s.composing && (s.composing.range.clear(),
                    s.composing.range = e.markText(s.composing.start, e.getCursor("to"), {
                        className: "CodeMirror-composing"
                    }));
                }),
                !0;
            },
            ensurePolled: function() {
                this.pollingFast && this.poll() && (this.pollingFast = !1);
            },
            onKeyPress: function() {
                w && 9 <= x && (this.hasSelection = null),
                this.fastPoll();
            },
            onContextMenu: function(e) {
                var n = this
                  , r = n.cm
                  , i = r.display
                  , o = n.textarea
                  , t = sn(r, e)
                  , l = i.scroller.scrollTop;
                if (t && !v) {
                    r.options.resetSelectionOnContextMenu && -1 == r.doc.sel.contains(t) && qt(r, je)(r.doc, De(t), io);
                    var s = o.style.cssText
                      , a = n.wrapper.style.cssText;
                    n.wrapper.style.cssText = "position: absolute";
                    var c = n.wrapper.getBoundingClientRect();
                    if (o.style.cssText = "position: absolute; width: 30px; height: 30px; top: " + (e.clientY - c.top - 5) + "px; left: " + (e.clientX - c.left - 5) + "px; z-index: 1000; background: " + (w ? "rgba(255, 255, 255, .05)" : "transparent") + "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",
                    m)
                        var u = window.scrollY;
                    if (i.input.focus(),
                    m && window.scrollTo(null, u),
                    i.input.reset(),
                    r.somethingSelected() || (o.value = n.prevInput = " "),
                    n.contextMenuPending = !0,
                    i.selForContextMenu = r.doc.sel,
                    clearTimeout(i.detectingSelectAll),
                    w && 9 <= x && h(),
                    p) {
                        Ui(e);
                        var f = function() {
                            qi(window, "mouseup", f),
                            setTimeout(d, 20);
                        };
                        Vi(window, "mouseup", f);
                    } else
                        setTimeout(d, 50);
                }
                function h() {
                    if (null != o.selectionStart) {
                        var e = r.somethingSelected()
                          , t = "\u200b" + (e ? o.value : "");
                        o.value = "\u21da",
                        o.value = t,
                        n.prevInput = e ? "" : "\u200b",
                        o.selectionStart = 1,
                        o.selectionEnd = t.length,
                        i.selForContextMenu = r.doc.sel;
                    }
                }
                function d() {
                    if (n.contextMenuPending = !1,
                    n.wrapper.style.cssText = a,
                    o.style.cssText = s,
                    w && x < 9 && i.scrollbars.setScrollTop(i.scroller.scrollTop = l),
                    null != o.selectionStart) {
                        (!w || w && x < 9) && h();
                        var e = 0
                          , t = function() {
                            i.selForContextMenu == r.doc.sel && 0 == o.selectionStart && 0 < o.selectionEnd && "\u200b" == n.prevInput ? qt(r, ar.selectAll)(r) : e++ < 10 ? i.detectingSelectAll = setTimeout(t, 500) : i.input.reset();
                        };
                        i.detectingSelectAll = setTimeout(t, 200);
                    }
                }
            },
            readOnlyChanged: function(e) {
                e || this.reset();
            },
            setUneditable: vo,
            needsContentAttribute: !1
        }, ke.prototype),
        Me.prototype = bo({
            init: function(e) {
                var i = this
                  , o = i.cm
                  , t = i.div = e.lineDiv;
                function n(e) {
                    if (!Qi(o, e)) {
                        if (o.somethingSelected())
                            ye = o.getSelections(),
                            "cut" == e.type && o.replaceSelection("", null, "cut");
                        else {
                            if (!o.options.lineWiseCopyCut)
                                return;
                            var t = Ce(o);
                            ye = t.text,
                            "cut" == e.type && o.operation(function() {
                                o.setSelections(t.ranges, 0, io),
                                o.replaceSelection("", null, "cut");
                            });
                        }
                        if (e.clipboardData && !s)
                            e.preventDefault(),
                            e.clipboardData.clearData(),
                            e.clipboardData.setData("text/plain", ye.join("\n"));
                        else {
                            var n = Le()
                              , r = n.firstChild;
                            o.display.lineSpace.insertBefore(n, o.display.lineSpace.firstChild),
                            r.value = ye.join("\n");
                            var i = document.activeElement;
                            po(r),
                            setTimeout(function() {
                                o.display.lineSpace.removeChild(n),
                                i.focus();
                            }, 50);
                        }
                    }
                }
                Se(t),
                Vi(t, "paste", function(e) {
                    Qi(o, e) || we(e, o);
                }),
                Vi(t, "compositionstart", function(e) {
                    var t = e.data;
                    if (i.composing = {
                        sel: o.doc.sel,
                        data: t,
                        startData: t
                    },
                    t) {
                        var n = o.doc.sel.primary()
                          , r = o.getLine(n.head.line).indexOf(t, Math.max(0, n.head.ch - t.length));
                        -1 < r && r <= n.head.ch && (i.composing.sel = De(he(n.head.line, r), he(n.head.line, r + t.length)));
                    }
                }),
                Vi(t, "compositionupdate", function(e) {
                    i.composing.data = e.data;
                }),
                Vi(t, "compositionend", function(e) {
                    var t = i.composing;
                    t && (e.data == t.startData || /\u200b/.test(e.data) || (t.data = e.data),
                    setTimeout(function() {
                        t.handled || i.applyComposition(t),
                        i.composing == t && (i.composing = null);
                    }, 50));
                }),
                Vi(t, "touchstart", function() {
                    i.forceCompositionEnd();
                }),
                Vi(t, "input", function() {
                    i.composing || !o.isReadOnly() && i.pollContent() || _t(i.cm, function() {
                        Qt(o);
                    });
                }),
                Vi(t, "copy", n),
                Vi(t, "cut", n);
            },
            prepareSelection: function() {
                var e = et(this.cm, !1);
                return e.focus = this.cm.state.focused,
                e;
            },
            showSelection: function(e) {
                e && this.cm.display.view.length && (e.focus && this.showPrimarySelection(),
                this.showMultipleSelections(e));
            },
            showPrimarySelection: function() {
                var e = window.getSelection()
                  , t = this.cm.doc.sel.primary()
                  , n = Oe(this.cm, e.anchorNode, e.anchorOffset)
                  , r = Oe(this.cm, e.focusNode, e.focusOffset);
                if (!n || n.bad || !r || r.bad || 0 != de(me(n, r), t.from()) || 0 != de(ge(n, r), t.to())) {
                    var i = Te(this.cm, t.from())
                      , o = Te(this.cm, t.to());
                    if (i || o) {
                        var l = this.cm.display.view
                          , s = e.rangeCount && e.getRangeAt(0);
                        if (i) {
                            if (!o) {
                                var a = l[l.length - 1].measure
                                  , c = a.maps ? a.maps[a.maps.length - 1] : a.map;
                                o = {
                                    node: c[c.length - 1],
                                    offset: c[c.length - 2] - c[c.length - 3]
                                };
                            }
                        } else
                            i = {
                                node: l[0].measure.map[2],
                                offset: 0
                            };
                        try {
                            var u = Lo(i.node, i.offset, o.offset, o.node);
                        } catch (e) {}
                        u && (!g && this.cm.state.focused ? (e.collapse(i.node, i.offset),
                        u.collapsed || e.addRange(u)) : (e.removeAllRanges(),
                        e.addRange(u)),
                        s && null == e.anchorNode ? e.addRange(s) : g && this.startGracePeriod()),
                        this.rememberSelection();
                    }
                }
            },
            startGracePeriod: function() {
                var e = this;
                clearTimeout(this.gracePeriod),
                this.gracePeriod = setTimeout(function() {
                    e.gracePeriod = !1,
                    e.selectionChanged() && e.cm.operation(function() {
                        e.cm.curOp.selectionChanged = !0;
                    });
                }, 20);
            },
            showMultipleSelections: function(e) {
                Ao(this.cm.display.cursorDiv, e.cursors),
                Ao(this.cm.display.selectionDiv, e.selection);
            },
            rememberSelection: function() {
                var e = window.getSelection();
                this.lastAnchorNode = e.anchorNode,
                this.lastAnchorOffset = e.anchorOffset,
                this.lastFocusNode = e.focusNode,
                this.lastFocusOffset = e.focusOffset;
            },
            selectionInEditor: function() {
                var e = window.getSelection();
                if (!e.rangeCount)
                    return !1;
                var t = e.getRangeAt(0).commonAncestorContainer;
                return Wo(this.div, t);
            },
            focus: function() {
                "nocursor" != this.cm.options.readOnly && this.div.focus();
            },
            blur: function() {
                this.div.blur();
            },
            getField: function() {
                return this.div;
            },
            supportsTouch: function() {
                return !0;
            },
            receivedFocus: function() {
                var t = this;
                this.selectionInEditor() ? this.pollSelection() : _t(this.cm, function() {
                    t.cm.curOp.selectionChanged = !0;
                }),
                this.polling.set(this.cm.options.pollInterval, function e() {
                    t.cm.state.focused && (t.pollSelection(),
                    t.polling.set(t.cm.options.pollInterval, e));
                });
            },
            selectionChanged: function() {
                var e = window.getSelection();
                return e.anchorNode != this.lastAnchorNode || e.anchorOffset != this.lastAnchorOffset || e.focusNode != this.lastFocusNode || e.focusOffset != this.lastFocusOffset;
            },
            pollSelection: function() {
                if (!this.composing && !this.gracePeriod && this.selectionChanged()) {
                    var e = window.getSelection()
                      , t = this.cm;
                    this.rememberSelection();
                    var n = Oe(t, e.anchorNode, e.anchorOffset)
                      , r = Oe(t, e.focusNode, e.focusOffset);
                    n && r && _t(t, function() {
                        je(t.doc, De(n, r), io),
                        (n.bad || r.bad) && (t.curOp.selectionChanged = !0);
                    });
                }
            },
            pollContent: function() {
                var e, t = this.cm, n = t.display, r = t.doc.sel.primary(), i = r.from(), o = r.to();
                if (i.line < n.viewFrom || o.line > n.viewTo - 1)
                    return !1;
                if (i.line == n.viewFrom || 0 == (e = tn(t, i.line)))
                    var l = Si(n.view[0].line)
                      , s = n.view[0].node;
                else
                    l = Si(n.view[e].line),
                    s = n.view[e - 1].node.nextSibling;
                var a = tn(t, o.line);
                if (a == n.view.length - 1)
                    var c = n.viewTo - 1
                      , u = n.lineDiv.lastChild;
                else
                    c = Si(n.view[a + 1].line) - 1,
                    u = n.view[a + 1].node.previousSibling;
                for (var f = t.doc.splitLines(function(a, e, t, c, u) {
                    var f = ""
                      , h = !1
                      , d = a.doc.lineSeparator();
                    function p(e) {
                        if (1 == e.nodeType) {
                            var t = e.getAttribute("cm-text");
                            if (null != t)
                                return "" == t && (t = e.textContent.replace(/\u200b/g, "")),
                                void (f += t);
                            var n, r = e.getAttribute("cm-marker");
                            if (r) {
                                var i = a.findMarks(he(c, 0), he(u + 1, 0), (s = +r,
                                function(e) {
                                    return e.id == s;
                                }
                                ));
                                return void (i.length && (n = i[0].find()) && (f += wi(a.doc, n.from, n.to).join(d)));
                            }
                            if ("false" == e.getAttribute("contenteditable"))
                                return;
                            for (var o = 0; o < e.childNodes.length; o++)
                                p(e.childNodes[o]);
                            /^(pre|div|p)$/i.test(e.nodeName) && (h = !0);
                        } else if (3 == e.nodeType) {
                            var l = e.nodeValue;
                            if (!l)
                                return;
                            h && (f += d,
                            h = !1),
                            f += l;
                        }
                        var s;
                    }
                    for (; p(e),
                    e != t; )
                        e = e.nextSibling;
                    return f;
                }(t, s, u, l, c)), h = wi(t.doc, he(l, 0), he(c, bi(t.doc, c).text.length)); 1 < f.length && 1 < h.length; )
                    if (ho(f) == ho(h))
                        f.pop(),
                        h.pop(),
                        c--;
                    else {
                        if (f[0] != h[0])
                            break;
                        f.shift(),
                        h.shift(),
                        l++;
                    }
                for (var d = 0, p = 0, g = f[0], m = h[0], v = Math.min(g.length, m.length); d < v && g.charCodeAt(d) == m.charCodeAt(d); )
                    ++d;
                for (var y = ho(f), b = ho(h), w = Math.min(y.length - (1 == f.length ? d : 0), b.length - (1 == h.length ? d : 0)); p < w && y.charCodeAt(y.length - p - 1) == b.charCodeAt(b.length - p - 1); )
                    ++p;
                f[f.length - 1] = y.slice(0, y.length - p),
                f[0] = f[0].slice(d);
                var x = he(l, d)
                  , C = he(c, h.length ? ho(h).length - p : 0);
                return 1 < f.length || f[0] || de(x, C) ? (Un(t.doc, f, x, C, "+input"),
                !0) : void 0;
            },
            ensurePolled: function() {
                this.forceCompositionEnd();
            },
            reset: function() {
                this.forceCompositionEnd();
            },
            forceCompositionEnd: function() {
                this.composing && !this.composing.handled && (this.applyComposition(this.composing),
                this.composing.handled = !0,
                this.div.blur(),
                this.div.focus());
            },
            applyComposition: function(e) {
                this.cm.isReadOnly() ? qt(this.cm, Qt)(this.cm) : e.data && e.data != e.startData && qt(this.cm, be)(this.cm, e.data, 0, e.sel);
            },
            setUneditable: function(e) {
                e.contentEditable = "false";
            },
            onKeyPress: function(e) {
                e.preventDefault(),
                this.cm.isReadOnly() || qt(this.cm, be)(this.cm, String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode), 0);
            },
            readOnlyChanged: function(e) {
                this.div.contentEditable = String("nocursor" != e);
            },
            onContextMenu: vo,
            resetPosition: vo,
            needsContentAttribute: !0
        }, Me.prototype),
        S.inputStyles = {
            textarea: ke,
            contenteditable: Me
        },
        We.prototype = {
            primary: function() {
                return this.ranges[this.primIndex];
            },
            equals: function(e) {
                if (e == this)
                    return !0;
                if (e.primIndex != this.primIndex || e.ranges.length != this.ranges.length)
                    return !1;
                for (var t = 0; t < this.ranges.length; t++) {
                    var n = this.ranges[t]
                      , r = e.ranges[t];
                    if (0 != de(n.anchor, r.anchor) || 0 != de(n.head, r.head))
                        return !1;
                }
                return !0;
            },
            deepCopy: function() {
                for (var e = [], t = 0; t < this.ranges.length; t++)
                    e[t] = new Fe(pe(this.ranges[t].anchor),pe(this.ranges[t].head));
                return new We(e,this.primIndex);
            },
            somethingSelected: function() {
                for (var e = 0; e < this.ranges.length; e++)
                    if (!this.ranges[e].empty())
                        return !0;
                return !1;
            },
            contains: function(e, t) {
                t || (t = e);
                for (var n = 0; n < this.ranges.length; n++) {
                    var r = this.ranges[n];
                    if (0 <= de(t, r.from()) && de(e, r.to()) <= 0)
                        return n;
                }
                return -1;
            }
        },
        Fe.prototype = {
            from: function() {
                return me(this.anchor, this.head);
            },
            to: function() {
                return ge(this.anchor, this.head);
            },
            empty: function() {
                return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;
            }
        };
        var yt, bt = {
            left: 0,
            right: 0,
            top: 0,
            bottom: 0
        };
        function wt(e, t, n) {
            for (var r, i, o, l, s = 0; s < e.length; s += 3) {
                var a = e[s]
                  , c = e[s + 1];
                if (t < a ? (i = 0,
                o = 1,
                l = "left") : t < c ? o = (i = t - a) + 1 : (s == e.length - 3 || t == c && e[s + 3] > t) && (i = (o = c - a) - 1,
                c <= t && (l = "right")),
                null != i) {
                    if (r = e[s + 2],
                    a == c && n == (r.insertLeft ? "left" : "right") && (l = n),
                    "left" == n && 0 == i)
                        for (; s && e[s - 2] == e[s - 3] && e[s - 1].insertLeft; )
                            r = e[2 + (s -= 3)],
                            l = "left";
                    if ("right" == n && i == c - a)
                        for (; s < e.length - 3 && e[s + 3] == e[s + 4] && !e[s + 5].insertLeft; )
                            r = e[(s += 3) + 2],
                            l = "right";
                    break;
                }
            }
            return {
                node: r,
                start: i,
                end: o,
                collapse: l,
                coverStart: a,
                coverEnd: c
            };
        }
        function xt(e) {
            if (e.measure && (e.measure.cache = {},
            e.measure.heights = null,
            e.rest))
                for (var t = 0; t < e.rest.length; t++)
                    e.measure.caches[t] = {};
        }
        function Ct(e) {
            e.display.externalMeasure = null,
            Oo(e.display.lineMeasure);
            for (var t = 0; t < e.display.view.length; t++)
                xt(e.display.view[t]);
        }
        function St(e) {
            Ct(e),
            e.display.cachedCharWidth = e.display.cachedTextHeight = e.display.cachedPaddingH = null,
            e.options.lineWrapping || (e.display.maxLineChanged = !0),
            e.display.lineNumChars = null;
        }
        function kt() {
            return window.pageXOffset || (document.documentElement || document.body).scrollLeft;
        }
        function Lt() {
            return window.pageYOffset || (document.documentElement || document.body).scrollTop;
        }
        function Mt(e, t, n, r) {
            if (t.widgets)
                for (var i = 0; i < t.widgets.length; ++i)
                    if (t.widgets[i].above) {
                        var o = Vr(t.widgets[i]);
                        n.top += o,
                        n.bottom += o;
                    }
            if ("line" == r)
                return n;
            r || (r = "local");
            var l = Li(t);
            if ("local" == r ? l += st(e.display) : l -= e.display.viewOffset,
            "page" == r || "window" == r) {
                var s = e.display.lineSpace.getBoundingClientRect();
                l += s.top + ("window" == r ? 0 : Lt());
                var a = s.left + ("window" == r ? 0 : kt());
                n.left += a,
                n.right += a;
            }
            return n.top += l,
            n.bottom += l,
            n;
        }
        function Tt(e, t, n) {
            if ("div" == n)
                return t;
            var r = t.left
              , i = t.top;
            if ("page" == n)
                r -= kt(),
                i -= Lt();
            else if ("local" == n || !n) {
                var o = e.display.sizer.getBoundingClientRect();
                r += o.left,
                i += o.top;
            }
            var l = e.display.lineSpace.getBoundingClientRect();
            return {
                left: r - l.left,
                top: i - l.top
            };
        }
        function Nt(e, t, n, r, i) {
            return r || (r = bi(e.doc, t.line)),
            Mt(e, r, pt(e, r, t.ch, i), n);
        }
        function Ot(r, e, i, o, l, s) {
            function a(e, t) {
                var n = vt(r, l, e, t ? "right" : "left", s);
                return t ? n.left = n.right : n.right = n.left,
                Mt(r, o, n, i);
            }
            function t(e, t) {
                var n = c[t]
                  , r = n.level % 2;
                return e == Zo(n) && t && n.level < c[t - 1].level ? (e = Qo(n = c[--t]) - (n.level % 2 ? 0 : 1),
                r = !0) : e == Qo(n) && t < c.length - 1 && n.level < c[t + 1].level && (e = Zo(n = c[++t]) - n.level % 2,
                r = !1),
                r && e == n.to && e > n.from ? a(e - 1) : a(e, r);
            }
            o = o || bi(r.doc, e.line),
            l || (l = mt(r, o));
            var c = Mi(o)
              , n = e.ch;
            if (!c)
                return a(n);
            var u = t(n, rl(c, n));
            return null != Yo && (u.other = t(n, Yo)),
            u;
        }
        function At(e, t) {
            var n = 0;
            t = Ie(e.doc, t);
            e.options.lineWrapping || (n = Pt(e.display) * t.ch);
            var r = bi(e.doc, t.line)
              , i = Li(r) + st(e.display);
            return {
                left: n,
                right: n,
                top: i,
                bottom: i + r.height
            };
        }
        function Wt(e, t, n, r) {
            var i = he(e, t);
            return i.xRel = r,
            n && (i.outside = !0),
            i;
        }
        function Ft(e, t, n) {
            var r = e.doc;
            if ((n += e.display.viewOffset) < 0)
                return Wt(r.first, 0, !0, -1);
            var i = ki(r, n)
              , o = r.first + r.size - 1;
            if (o < i)
                return Wt(r.first + r.size - 1, bi(r, o).text.length, !0, 1);
            t < 0 && (t = 0);
            for (var l = bi(r, i); ; ) {
                var s = Ht(e, l, i, t, n)
                  , a = Pr(l)
                  , c = a && a.find(0, !0);
                if (!a || !(s.ch > c.from.ch || s.ch == c.from.ch && 0 < s.xRel))
                    return s;
                i = Si(l = c.to.line);
            }
        }
        function Ht(n, r, i, e, t) {
            var o = t - Li(r)
              , l = !1
              , s = 2 * n.display.wrapper.clientWidth
              , a = mt(n, r);
            function c(e) {
                var t = Ot(n, he(i, e), "line", r, a);
                return l = !0,
                o > t.bottom ? t.left - s : o < t.top ? t.left + s : (l = !1,
                t.left);
            }
            var u = Mi(r)
              , f = r.text.length
              , h = Jo(r)
              , d = el(r)
              , p = c(h)
              , g = l
              , m = c(d)
              , v = l;
            if (m < e)
                return Wt(i, d, v, 1);
            for (; ; ) {
                if (u ? d == h || d == ol(r, h, 1) : d - h <= 1) {
                    for (var y = e < p || e - p <= m - e ? h : d, b = e - (y == h ? p : m); To(r.text.charAt(y)); )
                        ++y;
                    return Wt(i, y, y == h ? g : v, b < -1 ? -1 : 1 < b ? 1 : 0);
                }
                var w = Math.ceil(f / 2)
                  , x = h + w;
                if (u) {
                    x = h;
                    for (var C = 0; C < w; ++C)
                        x = ol(r, x, 1);
                }
                var S = c(x);
                e < S ? (d = x,
                m = S,
                (v = l) && (m += 1e3),
                f = w) : (h = x,
                p = S,
                g = l,
                f -= w);
            }
        }
        function Dt(e) {
            if (null != e.cachedTextHeight)
                return e.cachedTextHeight;
            if (null == yt) {
                yt = No("pre");
                for (var t = 0; t < 49; ++t)
                    yt.appendChild(document.createTextNode("x")),
                    yt.appendChild(No("br"));
                yt.appendChild(document.createTextNode("x"));
            }
            Ao(e.measure, yt);
            var n = yt.offsetHeight / 50;
            return 3 < n && (e.cachedTextHeight = n),
            Oo(e.measure),
            n || 1;
        }
        function Pt(e) {
            if (null != e.cachedCharWidth)
                return e.cachedCharWidth;
            var t = No("span", "xxxxxxxxxx")
              , n = No("pre", [t]);
            Ao(e.measure, n);
            var r = t.getBoundingClientRect()
              , i = (r.right - r.left) / 10;
            return 2 < i && (e.cachedCharWidth = i),
            i || 10;
        }
        var It, Et, zt = null, Rt = 0;
        function Bt(e) {
            e.curOp = {
                cm: e,
                viewChanged: !1,
                startHeight: e.doc.height,
                forceUpdate: !1,
                updateInput: null,
                typing: !1,
                changeObjs: null,
                cursorActivityHandlers: null,
                cursorActivityCalled: 0,
                selectionChanged: !1,
                updateMaxLine: !1,
                scrollLeft: null,
                scrollTop: null,
                scrollToPos: null,
                focus: !1,
                id: ++Rt
            },
            zt ? zt.ops.push(e.curOp) : e.curOp.ownsGroup = zt = {
                ops: [e.curOp],
                delayedCallbacks: []
            };
        }
        function Ut(e) {
            var t = e.curOp.ownsGroup;
            if (t)
                try {
                    !function(e) {
                        var t = e.delayedCallbacks
                          , n = 0;
                        do {
                            for (; n < t.length; n++)
                                t[n].call(null);
                            for (var r = 0; r < e.ops.length; r++) {
                                var i = e.ops[r];
                                if (i.cursorActivityHandlers)
                                    for (; i.cursorActivityCalled < i.cursorActivityHandlers.length; )
                                        i.cursorActivityHandlers[i.cursorActivityCalled++].call(null, i.cm);
                            }
                        } while (n < t.length);
                    }(t);
                } finally {
                    zt = null;
                    for (var n = 0; n < t.ops.length; n++)
                        t.ops[n].cm.curOp = null;
                    !function(e) {
                        for (var t = e.ops, n = 0; n < t.length; n++)
                            Gt(t[n]);
                        for (var n = 0; n < t.length; n++)
                            r = t[n],
                            r.updatedDisplay = r.mustUpdate && X(r.cm, r.update);
                        var r;
                        for (var n = 0; n < t.length; n++)
                            Kt(t[n]);
                        for (var n = 0; n < t.length; n++)
                            Vt(t[n]);
                        for (var n = 0; n < t.length; n++)
                            jt(t[n]);
                    }(t);
                }
        }
        function Gt(e) {
            var t, n, r = e.cm, i = r.display;
            !(n = (t = r).display).scrollbarsClipped && n.scroller.offsetWidth && (n.nativeBarWidth = n.scroller.offsetWidth - n.scroller.clientWidth,
            n.heightForcer.style.height = ut(t) + "px",
            n.sizer.style.marginBottom = -n.nativeBarWidth + "px",
            n.sizer.style.borderRightWidth = ut(t) + "px",
            n.scrollbarsClipped = !0),
            e.updateMaxLine && D(r),
            e.mustUpdate = e.viewChanged || e.forceUpdate || null != e.scrollTop || e.scrollToPos && (e.scrollToPos.from.line < i.viewFrom || e.scrollToPos.to.line >= i.viewTo) || i.maxLineChanged && r.options.lineWrapping,
            e.update = e.mustUpdate && new q(r,e.mustUpdate && {
                top: e.scrollTop,
                ensure: e.scrollToPos
            },e.forceUpdate);
        }
        function Kt(e) {
            var t = e.cm
              , n = t.display;
            e.updatedDisplay && Q(t),
            e.barMeasure = I(t),
            n.maxLineChanged && !t.options.lineWrapping && (e.adjustWidthTo = pt(t, n.maxLine, n.maxLine.text.length).left + 3,
            t.display.sizerWidth = e.adjustWidthTo,
            e.barMeasure.scrollWidth = Math.max(n.scroller.clientWidth, n.sizer.offsetLeft + e.adjustWidthTo + ut(t) + t.display.barWidth),
            e.maxScrollLeft = Math.max(0, n.sizer.offsetLeft + e.adjustWidthTo - ft(t))),
            (e.updatedDisplay || e.selectionChanged) && (e.preparedSelection = n.input.prepareSelection());
        }
        function Vt(e) {
            var t = e.cm;
            null != e.adjustWidthTo && (t.display.sizer.style.minWidth = e.adjustWidthTo + "px",
            e.maxScrollLeft < t.doc.scrollLeft && gn(t, Math.min(t.display.scroller.scrollLeft, e.maxScrollLeft), !0),
            t.display.maxLineChanged = !1),
            e.preparedSelection && t.display.input.showSelection(e.preparedSelection),
            (e.updatedDisplay || e.startHeight != t.doc.height) && B(t, e.barMeasure),
            e.updatedDisplay && Z(t, e.barMeasure),
            e.selectionChanged && rt(t),
            t.state.focused && e.updateInput && t.display.input.reset(e.typing),
            !e.focus || e.focus != Fo() || document.hasFocus && !document.hasFocus() || ve(e.cm);
        }
        function jt(e) {
            var t = e.cm
              , n = t.display
              , r = t.doc;
            if (e.updatedDisplay && Y(t, e.update),
            null == n.wheelStartX || null == e.scrollTop && null == e.scrollLeft && !e.scrollToPos || (n.wheelStartX = n.wheelStartY = null),
            null == e.scrollTop || n.scroller.scrollTop == e.scrollTop && !e.forceScroll || (r.scrollTop = Math.max(0, Math.min(n.scroller.scrollHeight - n.scroller.clientHeight, e.scrollTop)),
            n.scrollbars.setScrollTop(r.scrollTop),
            n.scroller.scrollTop = r.scrollTop),
            null == e.scrollLeft || n.scroller.scrollLeft == e.scrollLeft && !e.forceScroll || (r.scrollLeft = Math.max(0, Math.min(n.scroller.scrollWidth - n.scroller.clientWidth, e.scrollLeft)),
            n.scrollbars.setScrollLeft(r.scrollLeft),
            n.scroller.scrollLeft = r.scrollLeft,
            K(t)),
            e.scrollToPos) {
                var i = function(e, t, n, r) {
                    null == r && (r = 0);
                    for (var i = 0; i < 5; i++) {
                        var o = !1
                          , l = Ot(e, t)
                          , s = n && n != t ? Ot(e, n) : l
                          , a = Gn(e, Math.min(l.left, s.left), Math.min(l.top, s.top) - r, Math.max(l.left, s.left), Math.max(l.bottom, s.bottom) + r)
                          , c = e.doc.scrollTop
                          , u = e.doc.scrollLeft;
                        if (null != a.scrollTop && (pn(e, a.scrollTop),
                        1 < Math.abs(e.doc.scrollTop - c) && (o = !0)),
                        null != a.scrollLeft && (gn(e, a.scrollLeft),
                        1 < Math.abs(e.doc.scrollLeft - u) && (o = !0)),
                        !o)
                            break;
                    }
                    return l;
                }(t, Ie(r, e.scrollToPos.from), Ie(r, e.scrollToPos.to), e.scrollToPos.margin);
                e.scrollToPos.isCursor && t.state.focused && function(e, t) {
                    if (Qi(e, "scrollCursorIntoView"))
                        return;
                    var n = e.display
                      , r = n.sizer.getBoundingClientRect()
                      , i = null;
                    t.top + r.top < 0 ? i = !0 : t.bottom + r.top > (window.innerHeight || document.documentElement.clientHeight) && (i = !1);
                    if (null != i && !c) {
                        var o = No("div", "\u200b", null, "position: absolute; top: " + (t.top - n.viewOffset - st(e.display)) + "px; height: " + (t.bottom - t.top + ut(e) + n.barHeight) + "px; left: " + t.left + "px; width: 2px;");
                        e.display.lineSpace.appendChild(o),
                        o.scrollIntoView(i),
                        e.display.lineSpace.removeChild(o);
                    }
                }(t, i);
            }
            var o = e.maybeHiddenMarkers
              , l = e.maybeUnhiddenMarkers;
            if (o)
                for (var s = 0; s < o.length; ++s)
                    o[s].lines.length || Xi(o[s], "hide");
            if (l)
                for (s = 0; s < l.length; ++s)
                    l[s].lines.length && Xi(l[s], "unhide");
            n.wrapper.offsetHeight && (r.scrollTop = t.display.scroller.scrollTop),
            e.changeObjs && Xi(t, "changes", t, e.changeObjs),
            e.update && e.update.finish();
        }
        function _t(e, t) {
            if (e.curOp)
                return t();
            Bt(e);
            try {
                return t();
            } finally {
                Ut(e);
            }
        }
        function qt(e, t) {
            return function() {
                if (e.curOp)
                    return t.apply(e, arguments);
                Bt(e);
                try {
                    return t.apply(e, arguments);
                } finally {
                    Ut(e);
                }
            }
            ;
        }
        function Xt(e) {
            return function() {
                if (this.curOp)
                    return e.apply(this, arguments);
                Bt(this);
                try {
                    return e.apply(this, arguments);
                } finally {
                    Ut(this);
                }
            }
            ;
        }
        function Yt(t) {
            return function() {
                var e = this.cm;
                if (!e || e.curOp)
                    return t.apply(this, arguments);
                Bt(e);
                try {
                    return t.apply(this, arguments);
                } finally {
                    Ut(e);
                }
            }
            ;
        }
        function $t(e, t, n) {
            this.line = t,
            this.rest = function(e) {
                var t, n;
                for (; t = Pr(e); )
                    e = t.find(1, !0).line,
                    (n || (n = [])).push(e);
                return n;
            }(t),
            this.size = this.rest ? Si(ho(this.rest)) - n + 1 : 1,
            this.node = this.text = null,
            this.hidden = Br(e, t);
        }
        function Zt(e, t, n) {
            for (var r, i = [], o = t; o < n; o = r) {
                var l = new $t(e.doc,bi(e.doc, o),o);
                r = o + l.size,
                i.push(l);
            }
            return i;
        }
        function Qt(e, t, n, r) {
            null == t && (t = e.doc.first),
            null == n && (n = e.doc.first + e.doc.size),
            r || (r = 0);
            var i = e.display;
            if (r && n < i.viewTo && (null == i.updateLineNumbers || i.updateLineNumbers > t) && (i.updateLineNumbers = t),
            e.curOp.viewChanged = !0,
            t >= i.viewTo)
                C && zr(e.doc, t) < i.viewTo && en(e);
            else if (n <= i.viewFrom)
                C && Rr(e.doc, n + r) > i.viewFrom ? en(e) : (i.viewFrom += r,
                i.viewTo += r);
            else if (t <= i.viewFrom && n >= i.viewTo)
                en(e);
            else if (t <= i.viewFrom) {
                (o = nn(e, n, n + r, 1)) ? (i.view = i.view.slice(o.index),
                i.viewFrom = o.lineN,
                i.viewTo += r) : en(e);
            } else if (n >= i.viewTo) {
                var o;
                (o = nn(e, t, t, -1)) ? (i.view = i.view.slice(0, o.index),
                i.viewTo = o.lineN) : en(e);
            } else {
                var l = nn(e, t, t, -1)
                  , s = nn(e, n, n + r, 1);
                l && s ? (i.view = i.view.slice(0, l.index).concat(Zt(e, l.lineN, s.lineN)).concat(i.view.slice(s.index)),
                i.viewTo += r) : en(e);
            }
            var a = i.externalMeasured;
            a && (n < a.lineN ? a.lineN += r : t < a.lineN + a.size && (i.externalMeasured = null));
        }
        function Jt(e, t, n) {
            e.curOp.viewChanged = !0;
            var r = e.display
              , i = e.display.externalMeasured;
            if (i && t >= i.lineN && t < i.lineN + i.size && (r.externalMeasured = null),
            !(t < r.viewFrom || t >= r.viewTo)) {
                var o = r.view[tn(e, t)];
                if (null != o.node) {
                    var l = o.changes || (o.changes = []);
                    -1 == go(l, n) && l.push(n);
                }
            }
        }
        function en(e) {
            e.display.viewFrom = e.display.viewTo = e.doc.first,
            e.display.view = [],
            e.display.viewOffset = 0;
        }
        function tn(e, t) {
            if (t >= e.display.viewTo)
                return null;
            if ((t -= e.display.viewFrom) < 0)
                return null;
            for (var n = e.display.view, r = 0; r < n.length; r++)
                if ((t -= n[r].size) < 0)
                    return r;
        }
        function nn(e, t, n, r) {
            var i, o = tn(e, t), l = e.display.view;
            if (!C || n == e.doc.first + e.doc.size)
                return {
                    index: o,
                    lineN: n
                };
            for (var s = 0, a = e.display.viewFrom; s < o; s++)
                a += l[s].size;
            if (a != t) {
                if (0 < r) {
                    if (o == l.length - 1)
                        return null;
                    i = a + l[o].size - t,
                    o++;
                } else
                    i = a - t;
                t += i,
                n += i;
            }
            for (; zr(e.doc, n) != n; ) {
                if (o == (r < 0 ? 0 : l.length - 1))
                    return null;
                n += r * l[o - (r < 0 ? 1 : 0)].size,
                o += r;
            }
            return {
                index: o,
                lineN: n
            };
        }
        function rn(e) {
            for (var t = e.display.view, n = 0, r = 0; r < t.length; r++) {
                var i = t[r];
                i.hidden || i.node && !i.changes || ++n;
            }
            return n;
        }
        function on(e) {
            var t = e.display;
            t.lastWrapHeight == t.wrapper.clientHeight && t.lastWrapWidth == t.wrapper.clientWidth || (t.cachedCharWidth = t.cachedTextHeight = t.cachedPaddingH = null,
            t.scrollbarsClipped = !1,
            e.setSize());
        }
        function ln(e, t) {
            for (var n = Gi(t); n != e.wrapper; n = n.parentNode)
                if (!n || 1 == n.nodeType && "true" == n.getAttribute("cm-ignore-events") || n.parentNode == e.sizer && n != e.mover)
                    return !0;
        }
        function sn(e, t, n, r) {
            var i = e.display;
            if (!n && "true" == Gi(t).getAttribute("cm-not-content"))
                return null;
            var o, l, s = i.lineSpace.getBoundingClientRect();
            try {
                o = t.clientX - s.left,
                l = t.clientY - s.top;
            } catch (t) {
                return null;
            }
            var a, c = Ft(e, o, l);
            if (r && 1 == c.xRel && (a = bi(e.doc, c.line).text).length == c.ch) {
                var u = ao(a, a.length, e.options.tabSize) - a.length;
                c = he(c.line, Math.max(0, Math.round((o - ct(e.display).left) / Pt(e.display)) - u));
            }
            return c;
        }
        function an(e) {
            var t = this
              , n = t.display;
            if (!(Qi(t, e) || n.activeTouch && n.input.supportsTouch()))
                if (n.shift = e.shiftKey,
                ln(n, e))
                    m || (n.scroller.draggable = !1,
                    setTimeout(function() {
                        n.scroller.draggable = !0;
                    }, 100));
                else if (!un(t, e)) {
                    var r, i = sn(t, e);
                    switch (window.focus(),
                    Ki(e)) {
                    case 1:
                        t.state.selectingText ? t.state.selectingText(e) : i ? function(e, t, n) {
                            w ? setTimeout(wo(ve, e), 0) : e.curOp.focus = Fo();
                            var r, i = +new Date();
                            Et && Et.time > i - 400 && 0 == de(Et.pos, n) ? r = "triple" : It && It.time > i - 400 && 0 == de(It.pos, n) ? (r = "double",
                            Et = {
                                time: i,
                                pos: n
                            }) : (r = "single",
                            It = {
                                time: i,
                                pos: n
                            });
                            var o, l = e.doc.sel, s = y ? t.metaKey : t.ctrlKey;
                            e.options.dragDrop && Uo && !e.isReadOnly() && "single" == r && -1 < (o = l.contains(n)) && (de((o = l.ranges[o]).from(), n) < 0 || 0 < n.xRel) && (0 < de(o.to(), n) || n.xRel < 0) ? function(t, n, r, i) {
                                var o = t.display
                                  , l = +new Date()
                                  , s = qt(t, function(e) {
                                    m && (o.scroller.draggable = !1),
                                    t.state.draggingText = !1,
                                    qi(document, "mouseup", s),
                                    qi(o.scroller, "drop", s),
                                    Math.abs(n.clientX - e.clientX) + Math.abs(n.clientY - e.clientY) < 10 && (zi(e),
                                    !i && +new Date() - 200 < l && Be(t.doc, r),
                                    m || w && 9 == x ? setTimeout(function() {
                                        document.body.focus(),
                                        o.input.focus();
                                    }, 20) : o.input.focus());
                                });
                                m && (o.scroller.draggable = !0);
                                t.state.draggingText = s,
                                o.scroller.dragDrop && o.scroller.dragDrop();
                                Vi(document, "mouseup", s),
                                Vi(o.scroller, "drop", s);
                            }(e, t, n, s) : function(g, e, m, v, t) {
                                var o = g.display
                                  , y = g.doc;
                                zi(e);
                                var b, w, x = y.sel, n = x.ranges;
                                t && !e.shiftKey ? (w = y.sel.contains(m),
                                b = -1 < w ? n[w] : new Fe(m,m)) : (b = y.sel.primary(),
                                w = y.sel.primIndex);
                                if (e.altKey)
                                    v = "rect",
                                    t || (b = new Fe(m,m)),
                                    m = sn(g, e, !0, !0),
                                    w = -1;
                                else if ("double" == v) {
                                    var r = g.findWordAt(m);
                                    b = g.display.shift || y.extend ? Re(y, b, r.anchor, r.head) : r;
                                } else if ("triple" == v) {
                                    var i = new Fe(he(m.line, 0),Ie(y, he(m.line + 1, 0)));
                                    b = g.display.shift || y.extend ? Re(y, b, i.anchor, i.head) : i;
                                } else
                                    b = Re(y, b, m);
                                t ? -1 == w ? (w = n.length,
                                je(y, He(n.concat([b]), w), {
                                    scroll: !1,
                                    origin: "*mouse"
                                })) : 1 < n.length && n[w].empty() && "single" == v && !e.shiftKey ? (je(y, He(n.slice(0, w).concat(n.slice(w + 1)), 0), {
                                    scroll: !1,
                                    origin: "*mouse"
                                }),
                                x = y.sel) : Ge(y, w, b, oo) : (je(y, new We([b],w = 0), oo),
                                x = y.sel);
                                var C = m;
                                var l = o.wrapper.getBoundingClientRect()
                                  , s = 0;
                                function a(e) {
                                    var t = ++s
                                      , n = sn(g, e, !0, "rect" == v);
                                    if (n)
                                        if (0 != de(n, C)) {
                                            g.curOp.focus = Fo(),
                                            function(e) {
                                                if (0 == de(C, e))
                                                    return;
                                                if (C = e,
                                                "rect" == v) {
                                                    for (var t = [], n = g.options.tabSize, r = ao(bi(y, m.line).text, m.ch, n), i = ao(bi(y, e.line).text, e.ch, n), o = Math.min(r, i), l = Math.max(r, i), s = Math.min(m.line, e.line), a = Math.min(g.lastLine(), Math.max(m.line, e.line)); s <= a; s++) {
                                                        var c = bi(y, s).text
                                                          , u = co(c, o, n);
                                                        o == l ? t.push(new Fe(he(s, u),he(s, u))) : c.length > u && t.push(new Fe(he(s, u),he(s, co(c, l, n))));
                                                    }
                                                    t.length || t.push(new Fe(m,m)),
                                                    je(y, He(x.ranges.slice(0, w).concat(t), w), {
                                                        origin: "*mouse",
                                                        scroll: !1
                                                    }),
                                                    g.scrollIntoView(e);
                                                } else {
                                                    var f = b
                                                      , h = f.anchor
                                                      , d = e;
                                                    if ("single" != v) {
                                                        if ("double" == v)
                                                            var p = g.findWordAt(e);
                                                        else
                                                            var p = new Fe(he(e.line, 0),Ie(y, he(e.line + 1, 0)));
                                                        0 < de(p.anchor, h) ? (d = p.head,
                                                        h = me(f.from(), p.anchor)) : (d = p.anchor,
                                                        h = ge(f.to(), p.head));
                                                    }
                                                    var t = x.ranges.slice(0);
                                                    t[w] = new Fe(Ie(y, h),d),
                                                    je(y, He(t, w), oo);
                                                }
                                            }(n);
                                            var r = G(o, y);
                                            (n.line >= r.to || n.line < r.from) && setTimeout(qt(g, function() {
                                                s == t && a(e);
                                            }), 150);
                                        } else {
                                            var i = e.clientY < l.top ? -20 : e.clientY > l.bottom ? 20 : 0;
                                            i && setTimeout(qt(g, function() {
                                                s == t && (o.scroller.scrollTop += i,
                                                a(e));
                                            }), 50);
                                        }
                                }
                                function c(e) {
                                    g.state.selectingText = !1,
                                    s = 1 / 0,
                                    zi(e),
                                    o.input.focus(),
                                    qi(document, "mousemove", u),
                                    qi(document, "mouseup", f),
                                    y.history.lastSelOrigin = null;
                                }
                                var u = qt(g, function(e) {
                                    Ki(e) ? a(e) : c(e);
                                })
                                  , f = qt(g, c);
                                g.state.selectingText = f,
                                Vi(document, "mousemove", u),
                                Vi(document, "mouseup", f);
                            }(e, t, n, r, s);
                        }(t, e, i) : Gi(e) == n.scroller && zi(e);
                        break;

                    case 2:
                        m && (t.state.lastMiddleDown = +new Date()),
                        i && Be(t.doc, i),
                        setTimeout(function() {
                            n.input.focus();
                        }, 20),
                        zi(e);
                        break;

                    case 3:
                        p ? An(t, e) : ((r = t).state.delayingBlurEvent = !0,
                        setTimeout(function() {
                            r.state.delayingBlurEvent && (r.state.delayingBlurEvent = !1,
                            On(r));
                        }, 100));
                    }
                }
        }
        function cn(e, t, n, r) {
            try {
                var i = t.clientX
                  , o = t.clientY;
            } catch (t) {
                return !1;
            }
            if (i >= Math.floor(e.display.gutters.getBoundingClientRect().right))
                return !1;
            r && zi(t);
            var l = e.display
              , s = l.lineDiv.getBoundingClientRect();
            if (o > s.bottom || !eo(e, n))
                return Bi(t);
            o -= s.top - l.viewOffset;
            for (var a = 0; a < e.options.gutters.length; ++a) {
                var c = l.gutters.childNodes[a];
                if (c && c.getBoundingClientRect().right >= i) {
                    var u = ki(e.doc, o)
                      , f = e.options.gutters[a];
                    return Xi(e, n, e, u, f, t),
                    Bi(t);
                }
            }
        }
        function un(e, t) {
            return cn(e, t, "gutterClick", !0);
        }
        var fn = 0;
        function hn(e) {
            var i = this;
            if (dn(i),
            !Qi(i, e) && !ln(i.display, e)) {
                zi(e),
                w && (fn = +new Date());
                var o = sn(i, e, !0)
                  , t = e.dataTransfer.files;
                if (o && !i.isReadOnly())
                    if (t && t.length && window.FileReader && window.File)
                        for (var l = t.length, s = Array(l), a = 0, n = function(e, n) {
                            if (!i.options.allowDropFileTypes || -1 != go(i.options.allowDropFileTypes, e.type)) {
                                var r = new FileReader();
                                r.onload = qt(i, function() {
                                    var e = r.result;
                                    if (/[\x00-\x08\x0e-\x1f]{2}/.test(e) && (e = ""),
                                    s[n] = e,
                                    ++a == l) {
                                        var t = {
                                            from: o = Ie(i.doc, o),
                                            to: o,
                                            text: i.doc.splitLines(s.join(i.doc.lineSeparator())),
                                            origin: "paste"
                                        };
                                        In(i.doc, t),
                                        Ve(i.doc, De(o, Wn(t)));
                                    }
                                }),
                                r.readAsText(e);
                            }
                        }, r = 0; r < l; ++r)
                            n(t[r], r);
                    else {
                        if (i.state.draggingText && -1 < i.doc.sel.contains(o))
                            return i.state.draggingText(e),
                            void setTimeout(function() {
                                i.display.input.focus();
                            }, 20);
                        try {
                            if (s = e.dataTransfer.getData("Text")) {
                                if (i.state.draggingText && !(y ? e.altKey : e.ctrlKey))
                                    var c = i.listSelections();
                                if (_e(i.doc, De(o, o)),
                                c)
                                    for (r = 0; r < c.length; ++r)
                                        Un(i.doc, "", c[r].anchor, c[r].head, "drag");
                                i.replaceSelection(s, "around", "paste"),
                                i.display.input.focus();
                            }
                        } catch (e) {}
                    }
            }
        }
        function dn(e) {
            e.display.dragCursor && (e.display.lineSpace.removeChild(e.display.dragCursor),
            e.display.dragCursor = null);
        }
        function pn(e, t) {
            Math.abs(e.doc.scrollTop - t) < 2 || (e.doc.scrollTop = t,
            g || $(e, {
                top: t
            }),
            e.display.scroller.scrollTop != t && (e.display.scroller.scrollTop = t),
            e.display.scrollbars.setScrollTop(t),
            g && $(e),
            it(e, 100));
        }
        function gn(e, t, n) {
            (n ? t == e.doc.scrollLeft : Math.abs(e.doc.scrollLeft - t) < 2) || (t = Math.min(t, e.display.scroller.scrollWidth - e.display.scroller.clientWidth),
            e.doc.scrollLeft = t,
            K(e),
            e.display.scroller.scrollLeft != t && (e.display.scroller.scrollLeft = t),
            e.display.scrollbars.setScrollLeft(t));
        }
        var mn = 0
          , vn = null;
        w ? vn = -.53 : g ? vn = 15 : o ? vn = -.7 : a && (vn = -1 / 3);
        var yn = function(e) {
            var t = e.wheelDeltaX
              , n = e.wheelDeltaY;
            return null == t && e.detail && e.axis == e.HORIZONTAL_AXIS && (t = e.detail),
            null == n && e.detail && e.axis == e.VERTICAL_AXIS ? n = e.detail : null == n && (n = e.wheelDelta),
            {
                x: t,
                y: n
            };
        };
        function bn(e, t) {
            var n = yn(t)
              , r = n.x
              , i = n.y
              , o = e.display
              , l = o.scroller
              , s = l.scrollWidth > l.clientWidth
              , a = l.scrollHeight > l.clientHeight;
            if (r && s || i && a) {
                if (i && y && m)
                    e: for (var c = t.target, u = o.view; c != l; c = c.parentNode)
                        for (var f = 0; f < u.length; f++)
                            if (u[f].node == c) {
                                e.display.currentWheelTarget = c;
                                break e;
                            }
                if (r && !g && !v && null != vn)
                    return i && a && pn(e, Math.max(0, Math.min(l.scrollTop + i * vn, l.scrollHeight - l.clientHeight))),
                    gn(e, Math.max(0, Math.min(l.scrollLeft + r * vn, l.scrollWidth - l.clientWidth))),
                    (!i || i && a) && zi(t),
                    void (o.wheelStartX = null);
                if (i && null != vn) {
                    var h = i * vn
                      , d = e.doc.scrollTop
                      , p = d + o.wrapper.clientHeight;
                    h < 0 ? d = Math.max(0, d + h - 50) : p = Math.min(e.doc.height, p + h + 50),
                    $(e, {
                        top: d,
                        bottom: p
                    });
                }
                mn < 20 && (null == o.wheelStartX ? (o.wheelStartX = l.scrollLeft,
                o.wheelStartY = l.scrollTop,
                o.wheelDX = r,
                o.wheelDY = i,
                setTimeout(function() {
                    if (null != o.wheelStartX) {
                        var e = l.scrollLeft - o.wheelStartX
                          , t = l.scrollTop - o.wheelStartY
                          , n = t && o.wheelDY && t / o.wheelDY || e && o.wheelDX && e / o.wheelDX;
                        o.wheelStartX = o.wheelStartY = null,
                        n && (vn = (vn * mn + n) / (mn + 1),
                        ++mn);
                    }
                }, 200)) : (o.wheelDX += r,
                o.wheelDY += i));
            }
        }
        function wn(e, t, n) {
            if ("string" == typeof t && !(t = ar[t]))
                return !1;
            e.display.input.ensurePolled();
            var r = e.display.shift
              , i = !1;
            try {
                e.isReadOnly() && (e.state.suppressEdits = !0),
                n && (e.display.shift = !1),
                i = t(e) != ro;
            } finally {
                e.display.shift = r,
                e.state.suppressEdits = !1;
            }
            return i;
        }
        S.wheelEventPixels = function(e) {
            var t = yn(e);
            return t.x *= vn,
            t.y *= vn,
            t;
        }
        ;
        var xn = new so();
        function Cn(e, t, n, r) {
            var i = e.state.keySeq;
            if (i) {
                if (hr(t))
                    return "handled";
                xn.set(50, function() {
                    e.state.keySeq == i && (e.state.keySeq = null,
                    e.display.input.reset());
                }),
                t = i + " " + t;
            }
            var o = function(e, t, n) {
                for (var r = 0; r < e.state.keyMaps.length; r++) {
                    var i = fr(t, e.state.keyMaps[r], n, e);
                    if (i)
                        return i;
                }
                return e.options.extraKeys && fr(t, e.options.extraKeys, n, e) || fr(t, e.options.keyMap, n, e);
            }(e, t, r);
            return "multi" == o && (e.state.keySeq = t),
            "handled" == o && $i(e, "keyHandled", e, t, n),
            "handled" != o && "multi" != o || (zi(n),
            rt(e)),
            i && !o && /\'$/.test(t) ? (zi(n),
            !0) : !!o;
        }
        function Sn(t, e) {
            var n = dr(e, !0);
            return !!n && (e.shiftKey && !t.state.keySeq ? Cn(t, "Shift-" + n, e, function(e) {
                return wn(t, e, !0);
            }) || Cn(t, n, e, function(e) {
                if ("string" == typeof e ? /^go[A-Z]/.test(e) : e.motion)
                    return wn(t, e);
            }) : Cn(t, n, e, function(e) {
                return wn(t, e);
            }));
        }
        var kn = null;
        function Ln(e) {
            var t = this;
            if (t.curOp.focus = Fo(),
            !Qi(t, e)) {
                w && x < 11 && 27 == e.keyCode && (e.returnValue = !1);
                var n = e.keyCode;
                t.display.shift = 16 == n || e.shiftKey;
                var r = Sn(t, e);
                v && (kn = r ? n : null,
                !r && 88 == n && !qo && (y ? e.metaKey : e.ctrlKey) && t.replaceSelection("", null, "cut")),
                18 != n || /\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className) || function(e) {
                    var t = e.display.lineDiv;
                    function n(e) {
                        18 != e.keyCode && e.altKey || (Do(t, "CodeMirror-crosshair"),
                        qi(document, "keyup", n),
                        qi(document, "mouseover", n));
                    }
                    Po(t, "CodeMirror-crosshair"),
                    Vi(document, "keyup", n),
                    Vi(document, "mouseover", n);
                }(t);
            }
        }
        function Mn(e) {
            16 == e.keyCode && (this.doc.sel.shift = !1),
            Qi(this, e);
        }
        function Tn(e) {
            var t = this;
            if (!(ln(t.display, e) || Qi(t, e) || e.ctrlKey && !e.altKey || y && e.metaKey)) {
                var n = e.keyCode
                  , r = e.charCode;
                if (v && n == kn)
                    return kn = null,
                    void zi(e);
                if (!v || e.which && !(e.which < 10) || !Sn(t, e)) {
                    var i, o = String.fromCharCode(null == r ? n : r);
                    if (!Cn(i = t, "'" + o + "'", e, function(e) {
                        return wn(i, e, !0);
                    }))
                        t.display.input.onKeyPress(e);
                }
            }
        }
        function Nn(e) {
            e.state.delayingBlurEvent && (e.state.delayingBlurEvent = !1),
            "nocursor" != e.options.readOnly && (e.state.focused || (Xi(e, "focus", e),
            e.state.focused = !0,
            Po(e.display.wrapper, "CodeMirror-focused"),
            e.curOp || e.display.selForContextMenu == e.doc.sel || (e.display.input.reset(),
            m && setTimeout(function() {
                e.display.input.reset(!0);
            }, 20)),
            e.display.input.receivedFocus()),
            rt(e));
        }
        function On(e) {
            e.state.delayingBlurEvent || (e.state.focused && (Xi(e, "blur", e),
            e.state.focused = !1,
            Do(e.display.wrapper, "CodeMirror-focused")),
            clearInterval(e.display.blinker),
            setTimeout(function() {
                e.state.focused || (e.display.shift = !1);
            }, 150));
        }
        function An(e, t) {
            var n, r;
            ln(e.display, t) || (r = t,
            eo(n = e, "gutterContextMenu") && cn(n, r, "gutterContextMenu", !1)) || (Qi(e, t, "contextmenu") || e.display.input.onContextMenu(t));
        }
        var Wn = S.changeEnd = function(e) {
            return e.text ? he(e.from.line + e.text.length - 1, ho(e.text).length + (1 == e.text.length ? e.from.ch : 0)) : e.to;
        }
        ;
        function Fn(e, t) {
            if (de(e, t.from) < 0)
                return e;
            if (de(e, t.to) <= 0)
                return Wn(t);
            var n = e.line + t.text.length - (t.to.line - t.from.line) - 1
              , r = e.ch;
            return e.line == t.to.line && (r += Wn(t).ch - t.to.ch),
            he(n, r);
        }
        function Hn(e, t) {
            for (var n = [], r = 0; r < e.sel.ranges.length; r++) {
                var i = e.sel.ranges[r];
                n.push(new Fe(Fn(i.anchor, t),Fn(i.head, t)));
            }
            return He(n, e.sel.primIndex);
        }
        function Dn(e, t, n) {
            return e.line == t.line ? he(n.line, e.ch - t.ch + n.ch) : he(n.line + (e.line - t.line), e.ch);
        }
        function Pn(i, e, t) {
            var n = {
                canceled: !1,
                from: e.from,
                to: e.to,
                text: e.text,
                origin: e.origin,
                cancel: function() {
                    this.canceled = !0;
                }
            };
            return t && (n.update = function(e, t, n, r) {
                e && (this.from = Ie(i, e)),
                t && (this.to = Ie(i, t)),
                n && (this.text = n),
                void 0 !== r && (this.origin = r);
            }
            ),
            Xi(i, "beforeChange", i, n),
            i.cm && Xi(i.cm, "beforeChange", i.cm, n),
            n.canceled ? null : {
                from: n.from,
                to: n.to,
                text: n.text,
                origin: n.origin
            };
        }
        function In(e, t, n) {
            if (e.cm) {
                if (!e.cm.curOp)
                    return qt(e.cm, In)(e, t, n);
                if (e.cm.state.suppressEdits)
                    return;
            }
            if (!(eo(e, "beforeChange") || e.cm && eo(e.cm, "beforeChange")) || (t = Pn(e, t, !0))) {
                var r = b && !n && function(e, t, n) {
                    var r = null;
                    if (e.iter(t.line, n.line + 1, function(e) {
                        if (e.markedSpans)
                            for (var t = 0; t < e.markedSpans.length; ++t) {
                                var n = e.markedSpans[t].marker;
                                !n.readOnly || r && -1 != go(r, n) || (r || (r = [])).push(n);
                            }
                    }),
                    !r)
                        return null;
                    for (var i = [{
                        from: t,
                        to: n
                    }], o = 0; o < r.length; ++o)
                        for (var l = r[o], s = l.find(0), a = 0; a < i.length; ++a) {
                            var c = i[a];
                            if (!(de(c.to, s.from) < 0 || 0 < de(c.from, s.to))) {
                                var u = [a, 1]
                                  , f = de(c.from, s.from)
                                  , h = de(c.to, s.to);
                                (f < 0 || !l.inclusiveLeft && !f) && u.push({
                                    from: c.from,
                                    to: s.from
                                }),
                                (0 < h || !l.inclusiveRight && !h) && u.push({
                                    from: s.to,
                                    to: c.to
                                }),
                                i.splice.apply(i, u),
                                a += u.length - 1;
                            }
                        }
                    return i;
                }(e, t.from, t.to);
                if (r)
                    for (var i = r.length - 1; 0 <= i; --i)
                        En(e, {
                            from: r[i].from,
                            to: r[i].to,
                            text: i ? [""] : t.text
                        });
                else
                    En(e, t);
            }
        }
        function En(e, n) {
            if (1 != n.text.length || "" != n.text[0] || 0 != de(n.from, n.to)) {
                var t = Hn(e, n);
                Ai(e, n, t, e.cm ? e.cm.curOp.id : NaN),
                Bn(e, n, t, Lr(e, n));
                var r = [];
                vi(e, function(e, t) {
                    t || -1 != go(r, e.history) || (Ei(e.history, n),
                    r.push(e.history)),
                    Bn(e, n, null, Lr(e, n));
                });
            }
        }
        function zn(e, t, n) {
            if (!e.cm || !e.cm.state.suppressEdits) {
                for (var r, i = e.history, o = e.sel, l = "undo" == t ? i.done : i.undone, s = "undo" == t ? i.undone : i.done, a = 0; a < l.length && (r = l[a],
                n ? !r.ranges || r.equals(e.sel) : r.ranges); a++)
                    ;
                if (a != l.length) {
                    for (i.lastOrigin = i.lastSelOrigin = null; (r = l.pop()).ranges; ) {
                        if (Wi(r, s),
                        n && !r.equals(e.sel))
                            return void je(e, r, {
                                clearRedo: !1
                            });
                        o = r;
                    }
                    var c = [];
                    Wi(o, s),
                    s.push({
                        changes: c,
                        generation: i.generation
                    }),
                    i.generation = r.generation || ++i.maxGeneration;
                    var u = eo(e, "beforeChange") || e.cm && eo(e.cm, "beforeChange");
                    for (a = r.changes.length - 1; 0 <= a; --a) {
                        var f = r.changes[a];
                        if (f.origin = t,
                        u && !Pn(e, f, !1))
                            return void (l.length = 0);
                        c.push(Ni(e, f));
                        var h = a ? Hn(e, f) : ho(l);
                        Bn(e, f, h, Tr(e, f)),
                        !a && e.cm && e.cm.scrollIntoView({
                            from: f.from,
                            to: Wn(f)
                        });
                        var d = [];
                        vi(e, function(e, t) {
                            t || -1 != go(d, e.history) || (Ei(e.history, f),
                            d.push(e.history)),
                            Bn(e, f, null, Tr(e, f));
                        });
                    }
                }
            }
        }
        function Rn(e, t) {
            if (0 != t && (e.first += t,
            e.sel = new We(mo(e.sel.ranges, function(e) {
                return new Fe(he(e.anchor.line + t, e.anchor.ch),he(e.head.line + t, e.head.ch));
            }),e.sel.primIndex),
            e.cm)) {
                Qt(e.cm, e.first, e.first - t, t);
                for (var n = e.cm.display, r = n.viewFrom; r < n.viewTo; r++)
                    Jt(e.cm, r, "gutter");
            }
        }
        function Bn(e, t, n, r) {
            if (e.cm && !e.cm.curOp)
                return qt(e.cm, Bn)(e, t, n, r);
            if (t.to.line < e.first)
                Rn(e, t.text.length - 1 - (t.to.line - t.from.line));
            else if (!(t.from.line > e.lastLine())) {
                if (t.from.line < e.first) {
                    var i = t.text.length - 1 - (e.first - t.from.line);
                    Rn(e, i),
                    t = {
                        from: he(e.first, 0),
                        to: he(t.to.line + i, t.to.ch),
                        text: [ho(t.text)],
                        origin: t.origin
                    };
                }
                var o = e.lastLine();
                t.to.line > o && (t = {
                    from: t.from,
                    to: he(o, bi(e, o).text.length),
                    text: [t.text[0]],
                    origin: t.origin
                }),
                t.removed = wi(e, t.from, t.to),
                n || (n = Hn(e, t)),
                e.cm ? function(e, t, n) {
                    var r = e.doc
                      , i = e.display
                      , o = t.from
                      , l = t.to
                      , s = !1
                      , a = o.line;
                    e.options.lineWrapping || (a = Si(Er(bi(r, o.line))),
                    r.iter(a, l.line + 1, function(e) {
                        if (e == i.maxLine)
                            return s = !0;
                    }));
                    -1 < r.sel.contains(t.from, t.to) && Ji(e);
                    ui(r, t, n, T(e)),
                    e.options.lineWrapping || (r.iter(a, o.line + t.text.length, function(e) {
                        var t = H(e);
                        t > i.maxLineLength && (i.maxLine = e,
                        i.maxLineLength = t,
                        i.maxLineChanged = !0,
                        s = !1);
                    }),
                    s && (e.curOp.updateMaxLine = !0));
                    r.frontier = Math.min(r.frontier, o.line),
                    it(e, 400);
                    var c = t.text.length - (l.line - o.line) - 1;
                    t.full ? Qt(e) : o.line != l.line || 1 != t.text.length || ci(e.doc, t) ? Qt(e, o.line, l.line + 1, c) : Jt(e, o.line, "text");
                    var u = eo(e, "changes")
                      , f = eo(e, "change");
                    if (f || u) {
                        var h = {
                            from: o,
                            to: l,
                            text: t.text,
                            removed: t.removed,
                            origin: t.origin
                        };
                        f && $i(e, "change", e, h),
                        u && (e.curOp.changeObjs || (e.curOp.changeObjs = [])).push(h);
                    }
                    e.display.selForContextMenu = null;
                }(e.cm, t, r) : ui(e, t, r),
                _e(e, n, io);
            }
        }
        function Un(e, t, n, r, i) {
            if (r || (r = n),
            de(r, n) < 0) {
                var o = r;
                r = n,
                n = o;
            }
            "string" == typeof t && (t = e.splitLines(t)),
            In(e, {
                from: n,
                to: r,
                text: t,
                origin: i
            });
        }
        function Gn(e, t, n, r, i) {
            var o = e.display
              , l = Dt(e.display);
            n < 0 && (n = 0);
            var s = e.curOp && null != e.curOp.scrollTop ? e.curOp.scrollTop : o.scroller.scrollTop
              , a = ht(e)
              , c = {};
            a < i - n && (i = n + a);
            var u = e.doc.height + at(o)
              , f = n < l
              , h = u - l < i;
            if (n < s)
                c.scrollTop = f ? 0 : n;
            else if (s + a < i) {
                var d = Math.min(n, (h ? u : i) - a);
                d != s && (c.scrollTop = d);
            }
            var p = e.curOp && null != e.curOp.scrollLeft ? e.curOp.scrollLeft : o.scroller.scrollLeft
              , g = ft(e) - (e.options.fixedGutter ? o.gutters.offsetWidth : 0)
              , m = g < r - t;
            return m && (r = t + g),
            t < 10 ? c.scrollLeft = 0 : t < p ? c.scrollLeft = Math.max(0, t - (m ? 0 : 10)) : g + p - 3 < r && (c.scrollLeft = r + (m ? 0 : 10) - g),
            c;
        }
        function Kn(e, t, n) {
            null == t && null == n || jn(e),
            null != t && (e.curOp.scrollLeft = (null == e.curOp.scrollLeft ? e.doc.scrollLeft : e.curOp.scrollLeft) + t),
            null != n && (e.curOp.scrollTop = (null == e.curOp.scrollTop ? e.doc.scrollTop : e.curOp.scrollTop) + n);
        }
        function Vn(e) {
            jn(e);
            var t = e.getCursor()
              , n = t
              , r = t;
            e.options.lineWrapping || (n = t.ch ? he(t.line, t.ch - 1) : t,
            r = he(t.line, t.ch + 1)),
            e.curOp.scrollToPos = {
                from: n,
                to: r,
                margin: e.options.cursorScrollMargin,
                isCursor: !0
            };
        }
        function jn(e) {
            var t = e.curOp.scrollToPos;
            if (t) {
                e.curOp.scrollToPos = null;
                var n = At(e, t.from)
                  , r = At(e, t.to)
                  , i = Gn(e, Math.min(n.left, r.left), Math.min(n.top, r.top) - t.margin, Math.max(n.right, r.right), Math.max(n.bottom, r.bottom) + t.margin);
                e.scrollTo(i.scrollLeft, i.scrollTop);
            }
        }
        function _n(e, t, n, r) {
            var i, o = e.doc;
            null == n && (n = "add"),
            "smart" == n && (o.mode.indent ? i = lt(e, t) : n = "prev");
            var l = e.options.tabSize
              , s = bi(o, t)
              , a = ao(s.text, null, l);
            s.stateAfter && (s.stateAfter = null);
            var c, u = s.text.match(/^\s*/)[0];
            if (r || /\S/.test(s.text)) {
                if ("smart" == n && ((c = o.mode.indent(i, s.text.slice(u.length), s.text)) == ro || 150 < c)) {
                    if (!r)
                        return;
                    n = "prev";
                }
            } else
                c = 0,
                n = "not";
            "prev" == n ? c = t > o.first ? ao(bi(o, t - 1).text, null, l) : 0 : "add" == n ? c = a + e.options.indentUnit : "subtract" == n ? c = a - e.options.indentUnit : "number" == typeof n && (c = a + n),
            c = Math.max(0, c);
            var f = ""
              , h = 0;
            if (e.options.indentWithTabs)
                for (var d = Math.floor(c / l); d; --d)
                    h += l,
                    f += "\t";
            if (h < c && (f += fo(c - h)),
            f != u)
                return Un(o, f, he(t, 0), he(t, u.length), "+input"),
                !(s.stateAfter = null);
            for (d = 0; d < o.sel.ranges.length; d++) {
                var p = o.sel.ranges[d];
                if (p.head.line == t && p.head.ch < u.length) {
                    Ge(o, d, new Fe(h = he(t, u.length),h));
                    break;
                }
            }
        }
        function qn(e, t, n, r) {
            var i = t
              , o = t;
            return "number" == typeof t ? o = bi(e, Pe(e, t)) : i = Si(t),
            null == i ? null : (r(o, i) && e.cm && Jt(e.cm, i, n),
            o);
        }
        function Xn(t, e) {
            for (var n = t.doc.sel.ranges, r = [], i = 0; i < n.length; i++) {
                for (var o = e(n[i]); r.length && de(o.from, ho(r).to) <= 0; ) {
                    var l = r.pop();
                    if (de(l.from, o.from) < 0) {
                        o.from = l.from;
                        break;
                    }
                }
                r.push(o);
            }
            _t(t, function() {
                for (var e = r.length - 1; 0 <= e; e--)
                    Un(t.doc, "", r[e].from, r[e].to, "+delete");
                Vn(t);
            });
        }
        function Yn(r, e, i, t, o) {
            var l = e.line
              , s = e.ch
              , n = i
              , a = bi(r, l);
            function c(e) {
                var t, n = (o ? ol : ll)(a, s, i, !0);
                if (null == n) {
                    if (e || (t = l + i) < r.first || t >= r.first + r.size || !(a = bi(r, l = t)))
                        return !1;
                    s = o ? (i < 0 ? el : Jo)(a) : i < 0 ? a.text.length : 0;
                } else
                    s = n;
                return !0;
            }
            if ("char" == t)
                c();
            else if ("column" == t)
                c(!0);
            else if ("word" == t || "group" == t)
                for (var u = null, f = "group" == t, h = r.cm && r.cm.getHelper(e, "wordChars"), d = !0; !(i < 0) || c(!d); d = !1) {
                    var p = a.text.charAt(s) || "\n"
                      , g = So(p, h) ? "w" : f && "\n" == p ? "n" : !f || /\s/.test(p) ? null : "p";
                    if (!f || d || g || (g = "s"),
                    u && u != g) {
                        i < 0 && (i = 1,
                        c());
                        break;
                    }
                    if (g && (u = g),
                    0 < i && !c(!d))
                        break;
                }
            var m = Ze(r, he(l, s), e, n, !0);
            return de(e, m) || (m.hitSide = !0),
            m;
        }
        function $n(e, t, n, r) {
            var i, o = e.doc, l = t.left;
            if ("page" == r) {
                var s = Math.min(e.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
                i = t.top + n * (s - (n < 0 ? 1.5 : .5) * Dt(e.display));
            } else
                "line" == r && (i = 0 < n ? t.bottom + 3 : t.top - 3);
            for (; ; ) {
                var a = Ft(e, l, i);
                if (!a.outside)
                    break;
                if (n < 0 ? i <= 0 : i >= o.height) {
                    a.hitSide = !0;
                    break;
                }
                i += 5 * n;
            }
            return a;
        }
        S.prototype = {
            constructor: S,
            focus: function() {
                window.focus(),
                this.display.input.focus();
            },
            setOption: function(e, t) {
                var n = this.options
                  , r = n[e];
                n[e] == t && "mode" != e || (n[e] = t,
                Qn.hasOwnProperty(e) && qt(this, Qn[e])(this, t, r));
            },
            getOption: function(e) {
                return this.options[e];
            },
            getDoc: function() {
                return this.doc;
            },
            addKeyMap: function(e, t) {
                this.state.keyMaps[t ? "push" : "unshift"](pr(e));
            },
            removeKeyMap: function(e) {
                for (var t = this.state.keyMaps, n = 0; n < t.length; ++n)
                    if (t[n] == e || t[n].name == e)
                        return t.splice(n, 1),
                        !0;
            },
            addOverlay: Xt(function(e, t) {
                var n = e.token ? e : S.getMode(this.options, e);
                if (n.startState)
                    throw new Error("Overlays may not be stateful.");
                this.state.overlays.push({
                    mode: n,
                    modeSpec: e,
                    opaque: t && t.opaque
                }),
                this.state.modeGen++,
                Qt(this);
            }),
            removeOverlay: Xt(function(e) {
                for (var t = this.state.overlays, n = 0; n < t.length; ++n) {
                    var r = t[n].modeSpec;
                    if (r == e || "string" == typeof e && r.name == e)
                        return t.splice(n, 1),
                        this.state.modeGen++,
                        void Qt(this);
                }
            }),
            indentLine: Xt(function(e, t, n) {
                "string" != typeof t && "number" != typeof t && (t = null == t ? this.options.smartIndent ? "smart" : "prev" : t ? "add" : "subtract"),
                Ee(this.doc, e) && _n(this, e, t, n);
            }),
            indentSelection: Xt(function(e) {
                for (var t = this.doc.sel.ranges, n = -1, r = 0; r < t.length; r++) {
                    var i = t[r];
                    if (i.empty())
                        i.head.line > n && (_n(this, i.head.line, e, !0),
                        n = i.head.line,
                        r == this.doc.sel.primIndex && Vn(this));
                    else {
                        var o = i.from()
                          , l = i.to()
                          , s = Math.max(n, o.line);
                        n = Math.min(this.lastLine(), l.line - (l.ch ? 0 : 1)) + 1;
                        for (var a = s; a < n; ++a)
                            _n(this, a, e);
                        var c = this.doc.sel.ranges;
                        0 == o.ch && t.length == c.length && 0 < c[r].from().ch && Ge(this.doc, r, new Fe(o,c[r].to()), io);
                    }
                }
            }),
            getTokenAt: function(e, t) {
                return Yr(this, e, t);
            },
            getLineTokens: function(e, t) {
                return Yr(this, he(e), t, !0);
            },
            getTokenTypeAt: function(e) {
                e = Ie(this.doc, e);
                var t, n = Qr(this, bi(this.doc, e.line)), r = 0, i = (n.length - 1) / 2, o = e.ch;
                if (0 == o)
                    t = n[2];
                else
                    for (; ; ) {
                        var l = r + i >> 1;
                        if ((l ? n[2 * l - 1] : 0) >= o)
                            i = l;
                        else {
                            if (!(n[2 * l + 1] < o)) {
                                t = n[2 * l + 2];
                                break;
                            }
                            r = l + 1;
                        }
                    }
                var s = t ? t.indexOf("cm-overlay ") : -1;
                return s < 0 ? t : 0 == s ? null : t.slice(0, s - 1);
            },
            getModeAt: function(e) {
                var t = this.doc.mode;
                return t.innerMode ? S.innerMode(t, this.getTokenAt(e).state).mode : t;
            },
            getHelper: function(e, t) {
                return this.getHelpers(e, t)[0];
            },
            getHelpers: function(e, t) {
                var n = [];
                if (!or.hasOwnProperty(t))
                    return n;
                var r = or[t]
                  , i = this.getModeAt(e);
                if ("string" == typeof i[t])
                    r[i[t]] && n.push(r[i[t]]);
                else if (i[t])
                    for (var o = 0; o < i[t].length; o++) {
                        var l = r[i[t][o]];
                        l && n.push(l);
                    }
                else
                    i.helperType && r[i.helperType] ? n.push(r[i.helperType]) : r[i.name] && n.push(r[i.name]);
                for (o = 0; o < r._global.length; o++) {
                    var s = r._global[o];
                    s.pred(i, this) && -1 == go(n, s.val) && n.push(s.val);
                }
                return n;
            },
            getStateAfter: function(e, t) {
                var n = this.doc;
                return lt(this, (e = Pe(n, null == e ? n.first + n.size - 1 : e)) + 1, t);
            },
            cursorCoords: function(e, t) {
                var n = this.doc.sel.primary();
                return Ot(this, null == e ? n.head : "object" == typeof e ? Ie(this.doc, e) : e ? n.from() : n.to(), t || "page");
            },
            charCoords: function(e, t) {
                return Nt(this, Ie(this.doc, e), t || "page");
            },
            coordsChar: function(e, t) {
                return Ft(this, (e = Tt(this, e, t || "page")).left, e.top);
            },
            lineAtHeight: function(e, t) {
                return e = Tt(this, {
                    top: e,
                    left: 0
                }, t || "page").top,
                ki(this.doc, e + this.display.viewOffset);
            },
            heightAtLine: function(e, t) {
                var n, r = !1;
                if ("number" == typeof e) {
                    var i = this.doc.first + this.doc.size - 1;
                    e < this.doc.first ? e = this.doc.first : i < e && (e = i,
                    r = !0),
                    n = bi(this.doc, e);
                } else
                    n = e;
                return Mt(this, n, {
                    top: 0,
                    left: 0
                }, t || "page").top + (r ? this.doc.height - Li(n) : 0);
            },
            defaultTextHeight: function() {
                return Dt(this.display);
            },
            defaultCharWidth: function() {
                return Pt(this.display);
            },
            setGutterMarker: Xt(function(e, n, r) {
                return qn(this.doc, e, "gutter", function(e) {
                    var t = e.gutterMarkers || (e.gutterMarkers = {});
                    return !(t[n] = r) && ko(t) && (e.gutterMarkers = null),
                    !0;
                });
            }),
            clearGutter: Xt(function(t) {
                var n = this
                  , e = n.doc
                  , r = e.first;
                e.iter(function(e) {
                    e.gutterMarkers && e.gutterMarkers[t] && (e.gutterMarkers[t] = null,
                    Jt(n, r, "gutter"),
                    ko(e.gutterMarkers) && (e.gutterMarkers = null)),
                    ++r;
                });
            }),
            lineInfo: function(e) {
                if ("number" == typeof e) {
                    if (!Ee(this.doc, e))
                        return null;
                    var t = e;
                    if (!(e = bi(this.doc, e)))
                        return null;
                } else {
                    if (null == (t = Si(e)))
                        return null;
                }
                return {
                    line: t,
                    handle: e,
                    text: e.text,
                    gutterMarkers: e.gutterMarkers,
                    textClass: e.textClass,
                    bgClass: e.bgClass,
                    wrapClass: e.wrapClass,
                    widgets: e.widgets
                };
            },
            getViewport: function() {
                return {
                    from: this.display.viewFrom,
                    to: this.display.viewTo
                };
            },
            addWidget: function(e, t, n, r, i) {
                var o, l, s, a, c, u, f = this.display, h = (e = Ot(this, Ie(this.doc, e))).bottom, d = e.left;
                if (t.style.position = "absolute",
                t.setAttribute("cm-ignore-events", "true"),
                this.display.input.setUneditable(t),
                f.sizer.appendChild(t),
                "over" == r)
                    h = e.top;
                else if ("above" == r || "near" == r) {
                    var p = Math.max(f.wrapper.clientHeight, this.doc.height)
                      , g = Math.max(f.sizer.clientWidth, f.lineSpace.clientWidth);
                    ("above" == r || e.bottom + t.offsetHeight > p) && e.top > t.offsetHeight ? h = e.top - t.offsetHeight : e.bottom + t.offsetHeight <= p && (h = e.bottom),
                    d + t.offsetWidth > g && (d = g - t.offsetWidth);
                }
                t.style.top = h + "px",
                t.style.left = t.style.right = "",
                "right" == i ? (d = f.sizer.clientWidth - t.offsetWidth,
                t.style.right = "0px") : ("left" == i ? d = 0 : "middle" == i && (d = (f.sizer.clientWidth - t.offsetWidth) / 2),
                t.style.left = d + "px"),
                n && (o = this,
                s = h,
                a = (l = d) + t.offsetWidth,
                c = h + t.offsetHeight,
                null != (u = Gn(o, l, s, a, c)).scrollTop && pn(o, u.scrollTop),
                null != u.scrollLeft && gn(o, u.scrollLeft));
            },
            triggerOnKeyDown: Xt(Ln),
            triggerOnKeyPress: Xt(Tn),
            triggerOnKeyUp: Mn,
            execCommand: function(e) {
                if (ar.hasOwnProperty(e))
                    return ar[e].call(null, this);
            },
            triggerElectric: Xt(function(e) {
                xe(this, e);
            }),
            findPosH: function(e, t, n, r) {
                var i = 1;
                t < 0 && (i = -1,
                t = -t);
                for (var o = 0, l = Ie(this.doc, e); o < t && !(l = Yn(this.doc, l, i, n, r)).hitSide; ++o)
                    ;
                return l;
            },
            moveH: Xt(function(t, n) {
                var r = this;
                r.extendSelectionsBy(function(e) {
                    return r.display.shift || r.doc.extend || e.empty() ? Yn(r.doc, e.head, t, n, r.options.rtlMoveVisually) : t < 0 ? e.from() : e.to();
                }, lo);
            }),
            deleteH: Xt(function(n, r) {
                var e = this.doc.sel
                  , i = this.doc;
                e.somethingSelected() ? i.replaceSelection("", null, "+delete") : Xn(this, function(e) {
                    var t = Yn(i, e.head, n, r, !1);
                    return n < 0 ? {
                        from: t,
                        to: e.head
                    } : {
                        from: e.head,
                        to: t
                    };
                });
            }),
            findPosV: function(e, t, n, r) {
                var i = 1
                  , o = r;
                t < 0 && (i = -1,
                t = -t);
                for (var l = 0, s = Ie(this.doc, e); l < t; ++l) {
                    var a = Ot(this, s, "div");
                    if (null == o ? o = a.left : a.left = o,
                    (s = $n(this, a, i, n)).hitSide)
                        break;
                }
                return s;
            },
            moveV: Xt(function(r, i) {
                var o = this
                  , l = this.doc
                  , s = []
                  , a = !o.display.shift && !l.extend && l.sel.somethingSelected();
                if (l.extendSelectionsBy(function(e) {
                    if (a)
                        return r < 0 ? e.from() : e.to();
                    var t = Ot(o, e.head, "div");
                    null != e.goalColumn && (t.left = e.goalColumn),
                    s.push(t.left);
                    var n = $n(o, t, r, i);
                    return "page" == i && e == l.sel.primary() && Kn(o, null, Nt(o, n, "div").top - t.top),
                    n;
                }, lo),
                s.length)
                    for (var e = 0; e < l.sel.ranges.length; e++)
                        l.sel.ranges[e].goalColumn = s[e];
            }),
            findWordAt: function(e) {
                var t = bi(this.doc, e.line).text
                  , n = e.ch
                  , r = e.ch;
                if (t) {
                    var i = this.getHelper(e, "wordChars");
                    (e.xRel < 0 || r == t.length) && n ? --n : ++r;
                    for (var o = t.charAt(n), l = So(o, i) ? function(e) {
                        return So(e, i);
                    }
                    : /\s/.test(o) ? function(e) {
                        return /\s/.test(e);
                    }
                    : function(e) {
                        return !/\s/.test(e) && !So(e);
                    }
                    ; 0 < n && l(t.charAt(n - 1)); )
                        --n;
                    for (; r < t.length && l(t.charAt(r)); )
                        ++r;
                }
                return new Fe(he(e.line, n),he(e.line, r));
            },
            toggleOverwrite: function(e) {
                null != e && e == this.state.overwrite || ((this.state.overwrite = !this.state.overwrite) ? Po(this.display.cursorDiv, "CodeMirror-overwrite") : Do(this.display.cursorDiv, "CodeMirror-overwrite"),
                Xi(this, "overwriteToggle", this, this.state.overwrite));
            },
            hasFocus: function() {
                return this.display.input.getField() == Fo();
            },
            isReadOnly: function() {
                return !(!this.options.readOnly && !this.doc.cantEdit);
            },
            scrollTo: Xt(function(e, t) {
                null == e && null == t || jn(this),
                null != e && (this.curOp.scrollLeft = e),
                null != t && (this.curOp.scrollTop = t);
            }),
            getScrollInfo: function() {
                var e = this.display.scroller;
                return {
                    left: e.scrollLeft,
                    top: e.scrollTop,
                    height: e.scrollHeight - ut(this) - this.display.barHeight,
                    width: e.scrollWidth - ut(this) - this.display.barWidth,
                    clientHeight: ht(this),
                    clientWidth: ft(this)
                };
            },
            scrollIntoView: Xt(function(e, t) {
                if (null == e ? (e = {
                    from: this.doc.sel.primary().head,
                    to: null
                },
                null == t && (t = this.options.cursorScrollMargin)) : "number" == typeof e ? e = {
                    from: he(e, 0),
                    to: null
                } : null == e.from && (e = {
                    from: e,
                    to: null
                }),
                e.to || (e.to = e.from),
                e.margin = t || 0,
                null != e.from.line)
                    jn(this),
                    this.curOp.scrollToPos = e;
                else {
                    var n = Gn(this, Math.min(e.from.left, e.to.left), Math.min(e.from.top, e.to.top) - e.margin, Math.max(e.from.right, e.to.right), Math.max(e.from.bottom, e.to.bottom) + e.margin);
                    this.scrollTo(n.scrollLeft, n.scrollTop);
                }
            }),
            setSize: Xt(function(e, t) {
                var n = this;
                function r(e) {
                    return "number" == typeof e || /^\d+$/.test(String(e)) ? e + "px" : e;
                }
                null != e && (n.display.wrapper.style.width = r(e)),
                null != t && (n.display.wrapper.style.height = r(t)),
                n.options.lineWrapping && Ct(this);
                var i = n.display.viewFrom;
                n.doc.iter(i, n.display.viewTo, function(e) {
                    if (e.widgets)
                        for (var t = 0; t < e.widgets.length; t++)
                            if (e.widgets[t].noHScroll) {
                                Jt(n, i, "widget");
                                break;
                            }
                    ++i;
                }),
                n.curOp.forceUpdate = !0,
                Xi(n, "refresh", this);
            }),
            operation: function(e) {
                return _t(this, e);
            },
            refresh: Xt(function() {
                var e = this.display.cachedTextHeight;
                Qt(this),
                this.curOp.forceUpdate = !0,
                St(this),
                this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop),
                F(this),
                (null == e || .5 < Math.abs(e - Dt(this.display))) && N(this),
                Xi(this, "refresh", this);
            }),
            swapDoc: Xt(function(e) {
                var t = this.doc;
                return t.cm = null,
                yi(this, e),
                St(this),
                this.display.input.reset(),
                this.scrollTo(e.scrollLeft, e.scrollTop),
                this.curOp.forceScroll = !0,
                $i(this, "swapDoc", this, t),
                t;
            }),
            getInputField: function() {
                return this.display.input.getField();
            },
            getWrapperElement: function() {
                return this.display.wrapper;
            },
            getScrollerElement: function() {
                return this.display.scroller;
            },
            getGutterElement: function() {
                return this.display.gutters;
            }
        },
        to(S);
        var Zn = S.defaults = {}
          , Qn = S.optionHandlers = {};
        function Jn(e, t, r, n) {
            S.defaults[e] = t,
            r && (Qn[e] = n ? function(e, t, n) {
                n != er && r(e, t, n);
            }
            : r);
        }
        var er = S.Init = {
            toString: function() {
                return "CodeMirror.Init";
            }
        };
        Jn("value", "", function(e, t) {
            e.setValue(t);
        }, !0),
        Jn("mode", null, function(e, t) {
            e.doc.modeOption = t,
            L(e);
        }, !0),
        Jn("indentUnit", 2, L, !0),
        Jn("indentWithTabs", !1),
        Jn("smartIndent", !0),
        Jn("tabSize", 4, function(e) {
            M(e),
            St(e),
            Qt(e);
        }, !0),
        Jn("lineSeparator", null, function(e, r) {
            if (e.doc.lineSep = r) {
                var i = []
                  , o = e.doc.first;
                e.doc.iter(function(e) {
                    for (var t = 0; ; ) {
                        var n = e.text.indexOf(r, t);
                        if (-1 == n)
                            break;
                        t = n + r.length,
                        i.push(he(o, n));
                    }
                    o++;
                });
                for (var t = i.length - 1; 0 <= t; t--)
                    Un(e.doc, r, i[t], he(i[t].line, i[t].ch + r.length));
            }
        }),
        Jn("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function(e, t, n) {
            e.state.specialChars = new RegExp(t.source + (t.test("\t") ? "" : "|\t"),"g"),
            n != S.Init && e.refresh();
        }),
        Jn("specialCharPlaceholder", function(e) {
            var t = No("span", "\u2022", "cm-invalidchar");
            return t.title = "\\u" + e.charCodeAt(0).toString(16),
            t.setAttribute("aria-label", t.title),
            t;
        }, function(e) {
            e.refresh();
        }, !0),
        Jn("electricChars", !0),
        Jn("inputStyle", u ? "contenteditable" : "textarea", function() {
            throw new Error("inputStyle can not (yet) be changed in a running editor");
        }, !0),
        Jn("rtlMoveVisually", !f),
        Jn("wholeLineUpdateBefore", !0),
        Jn("theme", "default", function(e) {
            O(e),
            A(e);
        }, !0),
        Jn("keyMap", "default", function(e, t, n) {
            var r = pr(t)
              , i = n != S.Init && pr(n);
            i && i.detach && i.detach(e, r),
            r.attach && r.attach(e, i || null);
        }),
        Jn("extraKeys", null),
        Jn("lineWrapping", !1, function(e) {
            e.options.lineWrapping ? (Po(e.display.wrapper, "CodeMirror-wrap"),
            e.display.sizer.style.minWidth = "",
            e.display.sizerWidth = null) : (Do(e.display.wrapper, "CodeMirror-wrap"),
            D(e)),
            N(e),
            Qt(e),
            St(e),
            setTimeout(function() {
                B(e);
            }, 100);
        }, !0),
        Jn("gutters", [], function(e) {
            P(e.options),
            A(e);
        }, !0),
        Jn("fixedGutter", !0, function(e, t) {
            e.display.gutters.style.left = t ? _(e.display) + "px" : "0",
            e.refresh();
        }, !0),
        Jn("coverGutterNextToScrollbar", !1, function(e) {
            B(e);
        }, !0),
        Jn("scrollbarStyle", "native", function(e) {
            R(e),
            B(e),
            e.display.scrollbars.setScrollTop(e.doc.scrollTop),
            e.display.scrollbars.setScrollLeft(e.doc.scrollLeft);
        }, !0),
        Jn("lineNumbers", !1, function(e) {
            P(e.options),
            A(e);
        }, !0),
        Jn("firstLineNumber", 1, A, !0),
        Jn("lineNumberFormatter", function(e) {
            return e;
        }, A, !0),
        Jn("showCursorWhenSelecting", !1, Je, !0),
        Jn("resetSelectionOnContextMenu", !0),
        Jn("lineWiseCopyCut", !0),
        Jn("readOnly", !1, function(e, t) {
            "nocursor" == t ? (On(e),
            e.display.input.blur(),
            e.display.disabled = !0) : e.display.disabled = !1,
            e.display.input.readOnlyChanged(t);
        }),
        Jn("disableInput", !1, function(e, t) {
            t || e.display.input.reset();
        }, !0),
        Jn("dragDrop", !0, function(e, t, n) {
            if (!t != !(n && n != S.Init)) {
                var r = e.display.dragFunctions
                  , i = t ? Vi : qi;
                i(e.display.scroller, "dragstart", r.start),
                i(e.display.scroller, "dragenter", r.enter),
                i(e.display.scroller, "dragover", r.over),
                i(e.display.scroller, "dragleave", r.leave),
                i(e.display.scroller, "drop", r.drop);
            }
        }),
        Jn("allowDropFileTypes", null),
        Jn("cursorBlinkRate", 530),
        Jn("cursorScrollMargin", 0),
        Jn("cursorHeight", 1, Je, !0),
        Jn("singleCursorHeightPerLine", !0, Je, !0),
        Jn("workTime", 100),
        Jn("workDelay", 100),
        Jn("flattenSpans", !0, M, !0),
        Jn("addModeClass", !1, M, !0),
        Jn("pollInterval", 100),
        Jn("undoDepth", 200, function(e, t) {
            e.doc.history.undoDepth = t;
        }),
        Jn("historyEventDelay", 1250),
        Jn("viewportMargin", 10, function(e) {
            e.refresh();
        }, !0),
        Jn("maxHighlightLength", 1e4, M, !0),
        Jn("moveInputWithCursor", !0, function(e, t) {
            t || e.display.input.resetPosition();
        }),
        Jn("tabindex", null, function(e, t) {
            e.display.input.getField().tabIndex = t || "";
        }),
        Jn("autofocus", null);
        var tr = S.modes = {}
          , nr = S.mimeModes = {};
        S.defineMode = function(e, t) {
            S.defaults.mode || "null" == e || (S.defaults.mode = e),
            2 < arguments.length && (t.dependencies = Array.prototype.slice.call(arguments, 2)),
            tr[e] = t;
        }
        ,
        S.defineMIME = function(e, t) {
            nr[e] = t;
        }
        ,
        S.resolveMode = function(e) {
            if ("string" == typeof e && nr.hasOwnProperty(e))
                e = nr[e];
            else if (e && "string" == typeof e.name && nr.hasOwnProperty(e.name)) {
                var t = nr[e.name];
                "string" == typeof t && (t = {
                    name: t
                }),
                (e = yo(t, e)).name = t.name;
            } else if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+xml$/.test(e))
                return S.resolveMode("application/xml");
            return "string" == typeof e ? {
                name: e
            } : e || {
                name: "null"
            };
        }
        ,
        S.getMode = function(e, t) {
            t = S.resolveMode(t);
            var n = tr[t.name];
            if (!n)
                return S.getMode(e, "text/plain");
            var r = n(e, t);
            if (rr.hasOwnProperty(t.name)) {
                var i = rr[t.name];
                for (var o in i)
                    i.hasOwnProperty(o) && (r.hasOwnProperty(o) && (r["_" + o] = r[o]),
                    r[o] = i[o]);
            }
            if (r.name = t.name,
            t.helperType && (r.helperType = t.helperType),
            t.modeProps)
                for (var o in t.modeProps)
                    r[o] = t.modeProps[o];
            return r;
        }
        ,
        S.defineMode("null", function() {
            return {
                token: function(e) {
                    e.skipToEnd();
                }
            };
        }),
        S.defineMIME("text/plain", "null");
        var rr = S.modeExtensions = {};
        S.extendMode = function(e, t) {
            bo(t, rr.hasOwnProperty(e) ? rr[e] : rr[e] = {});
        }
        ,
        S.defineExtension = function(e, t) {
            S.prototype[e] = t;
        }
        ,
        S.defineDocExtension = function(e, t) {
            pi.prototype[e] = t;
        }
        ,
        S.defineOption = Jn;
        var ir = [];
        S.defineInitHook = function(e) {
            ir.push(e);
        }
        ;
        var or = S.helpers = {};
        S.registerHelper = function(e, t, n) {
            or.hasOwnProperty(e) || (or[e] = S[e] = {
                _global: []
            }),
            or[e][t] = n;
        }
        ,
        S.registerGlobalHelper = function(e, t, n, r) {
            S.registerHelper(e, t, r),
            or[e]._global.push({
                pred: n,
                val: r
            });
        }
        ;
        var lr = S.copyState = function(e, t) {
            if (!0 === t)
                return t;
            if (e.copyState)
                return e.copyState(t);
            var n = {};
            for (var r in t) {
                var i = t[r];
                i instanceof Array && (i = i.concat([])),
                n[r] = i;
            }
            return n;
        }
          , sr = S.startState = function(e, t, n) {
            return !e.startState || e.startState(t, n);
        }
        ;
        S.innerMode = function(e, t) {
            for (; e.innerMode; ) {
                var n = e.innerMode(t);
                if (!n || n.mode == e)
                    break;
                t = n.state,
                e = n.mode;
            }
            return n || {
                mode: e,
                state: t
            };
        }
        ;
        var ar = S.commands = {
            selectAll: function(e) {
                e.setSelection(he(e.firstLine(), 0), he(e.lastLine()), io);
            },
            singleSelection: function(e) {
                e.setSelection(e.getCursor("anchor"), e.getCursor("head"), io);
            },
            killLine: function(n) {
                Xn(n, function(e) {
                    if (e.empty()) {
                        var t = bi(n.doc, e.head.line).text.length;
                        return e.head.ch == t && e.head.line < n.lastLine() ? {
                            from: e.head,
                            to: he(e.head.line + 1, 0)
                        } : {
                            from: e.head,
                            to: he(e.head.line, t)
                        };
                    }
                    return {
                        from: e.from(),
                        to: e.to()
                    };
                });
            },
            deleteLine: function(t) {
                Xn(t, function(e) {
                    return {
                        from: he(e.from().line, 0),
                        to: Ie(t.doc, he(e.to().line + 1, 0))
                    };
                });
            },
            delLineLeft: function(e) {
                Xn(e, function(e) {
                    return {
                        from: he(e.from().line, 0),
                        to: e.from()
                    };
                });
            },
            delWrappedLineLeft: function(n) {
                Xn(n, function(e) {
                    var t = n.charCoords(e.head, "div").top + 5;
                    return {
                        from: n.coordsChar({
                            left: 0,
                            top: t
                        }, "div"),
                        to: e.from()
                    };
                });
            },
            delWrappedLineRight: function(r) {
                Xn(r, function(e) {
                    var t = r.charCoords(e.head, "div").top + 5
                      , n = r.coordsChar({
                        left: r.display.lineDiv.offsetWidth + 100,
                        top: t
                    }, "div");
                    return {
                        from: e.from(),
                        to: n
                    };
                });
            },
            undo: function(e) {
                e.undo();
            },
            redo: function(e) {
                e.redo();
            },
            undoSelection: function(e) {
                e.undoSelection();
            },
            redoSelection: function(e) {
                e.redoSelection();
            },
            goDocStart: function(e) {
                e.extendSelection(he(e.firstLine(), 0));
            },
            goDocEnd: function(e) {
                e.extendSelection(he(e.lastLine()));
            },
            goLineStart: function(t) {
                t.extendSelectionsBy(function(e) {
                    return tl(t, e.head.line);
                }, {
                    origin: "+move",
                    bias: 1
                });
            },
            goLineStartSmart: function(t) {
                t.extendSelectionsBy(function(e) {
                    return nl(t, e.head);
                }, {
                    origin: "+move",
                    bias: 1
                });
            },
            goLineEnd: function(t) {
                t.extendSelectionsBy(function(e) {
                    return function(e, t) {
                        var n, r = bi(e.doc, t);
                        for (; n = Pr(r); )
                            r = n.find(1, !0).line,
                            t = null;
                        var i = Mi(r)
                          , o = i ? i[0].level % 2 ? Jo(r) : el(r) : r.text.length;
                        return he(null == t ? Si(r) : t, o);
                    }(t, e.head.line);
                }, {
                    origin: "+move",
                    bias: -1
                });
            },
            goLineRight: function(n) {
                n.extendSelectionsBy(function(e) {
                    var t = n.charCoords(e.head, "div").top + 5;
                    return n.coordsChar({
                        left: n.display.lineDiv.offsetWidth + 100,
                        top: t
                    }, "div");
                }, lo);
            },
            goLineLeft: function(n) {
                n.extendSelectionsBy(function(e) {
                    var t = n.charCoords(e.head, "div").top + 5;
                    return n.coordsChar({
                        left: 0,
                        top: t
                    }, "div");
                }, lo);
            },
            goLineLeftSmart: function(r) {
                r.extendSelectionsBy(function(e) {
                    var t = r.charCoords(e.head, "div").top + 5
                      , n = r.coordsChar({
                        left: 0,
                        top: t
                    }, "div");
                    return n.ch < r.getLine(n.line).search(/\S/) ? nl(r, e.head) : n;
                }, lo);
            },
            goLineUp: function(e) {
                e.moveV(-1, "line");
            },
            goLineDown: function(e) {
                e.moveV(1, "line");
            },
            goPageUp: function(e) {
                e.moveV(-1, "page");
            },
            goPageDown: function(e) {
                e.moveV(1, "page");
            },
            goCharLeft: function(e) {
                e.moveH(-1, "char");
            },
            goCharRight: function(e) {
                e.moveH(1, "char");
            },
            goColumnLeft: function(e) {
                e.moveH(-1, "column");
            },
            goColumnRight: function(e) {
                e.moveH(1, "column");
            },
            goWordLeft: function(e) {
                e.moveH(-1, "word");
            },
            goGroupRight: function(e) {
                e.moveH(1, "group");
            },
            goGroupLeft: function(e) {
                e.moveH(-1, "group");
            },
            goWordRight: function(e) {
                e.moveH(1, "word");
            },
            delCharBefore: function(e) {
                e.deleteH(-1, "char");
            },
            delCharAfter: function(e) {
                e.deleteH(1, "char");
            },
            delWordBefore: function(e) {
                e.deleteH(-1, "word");
            },
            delWordAfter: function(e) {
                e.deleteH(1, "word");
            },
            delGroupBefore: function(e) {
                e.deleteH(-1, "group");
            },
            delGroupAfter: function(e) {
                e.deleteH(1, "group");
            },
            indentAuto: function(e) {
                e.indentSelection("smart");
            },
            indentMore: function(e) {
                e.indentSelection("add");
            },
            indentLess: function(e) {
                e.indentSelection("subtract");
            },
            insertTab: function(e) {
                e.replaceSelection("\t");
            },
            insertSoftTab: function(e) {
                for (var t = [], n = e.listSelections(), r = e.options.tabSize, i = 0; i < n.length; i++) {
                    var o = n[i].from()
                      , l = ao(e.getLine(o.line), o.ch, r);
                    t.push(new Array(r - l % r + 1).join(" "));
                }
                e.replaceSelections(t);
            },
            defaultTab: function(e) {
                e.somethingSelected() ? e.indentSelection("add") : e.execCommand("insertTab");
            },
            transposeChars: function(l) {
                _t(l, function() {
                    for (var e = l.listSelections(), t = [], n = 0; n < e.length; n++) {
                        var r = e[n].head
                          , i = bi(l.doc, r.line).text;
                        if (i)
                            if (r.ch == i.length && (r = new he(r.line,r.ch - 1)),
                            0 < r.ch)
                                r = new he(r.line,r.ch + 1),
                                l.replaceRange(i.charAt(r.ch - 1) + i.charAt(r.ch - 2), he(r.line, r.ch - 2), r, "+transpose");
                            else if (r.line > l.doc.first) {
                                var o = bi(l.doc, r.line - 1).text;
                                o && l.replaceRange(i.charAt(0) + l.doc.lineSeparator() + o.charAt(o.length - 1), he(r.line - 1, o.length - 1), he(r.line, 1), "+transpose");
                            }
                        t.push(new Fe(r,r));
                    }
                    l.setSelections(t);
                });
            },
            newlineAndIndent: function(r) {
                _t(r, function() {
                    for (var e = r.listSelections().length, t = 0; t < e; t++) {
                        var n = r.listSelections()[t];
                        r.replaceRange(r.doc.lineSeparator(), n.anchor, n.head, "+input"),
                        r.indentLine(n.from().line + 1, null, !0);
                    }
                    Vn(r);
                });
            },
            toggleOverwrite: function(e) {
                e.toggleOverwrite();
            }
        }
          , cr = S.keyMap = {};
        function ur(e) {
            for (var t, n, r, i, o = e.split(/-(?!$)/), l = (e = o[o.length - 1],
            0); l < o.length - 1; l++) {
                var s = o[l];
                if (/^(cmd|meta|m)$/i.test(s))
                    i = !0;
                else if (/^a(lt)?$/i.test(s))
                    t = !0;
                else if (/^(c|ctrl|control)$/i.test(s))
                    n = !0;
                else {
                    if (!/^s(hift)$/i.test(s))
                        throw new Error("Unrecognized modifier name: " + s);
                    r = !0;
                }
            }
            return t && (e = "Alt-" + e),
            n && (e = "Ctrl-" + e),
            i && (e = "Cmd-" + e),
            r && (e = "Shift-" + e),
            e;
        }
        cr.basic = {
            Left: "goCharLeft",
            Right: "goCharRight",
            Up: "goLineUp",
            Down: "goLineDown",
            End: "goLineEnd",
            Home: "goLineStartSmart",
            PageUp: "goPageUp",
            PageDown: "goPageDown",
            Delete: "delCharAfter",
            Backspace: "delCharBefore",
            "Shift-Backspace": "delCharBefore",
            Tab: "defaultTab",
            "Shift-Tab": "indentAuto",
            Enter: "newlineAndIndent",
            Insert: "toggleOverwrite",
            Esc: "singleSelection"
        },
        cr.pcDefault = {
            "Ctrl-A": "selectAll",
            "Ctrl-D": "deleteLine",
            "Ctrl-Z": "undo",
            "Shift-Ctrl-Z": "redo",
            "Ctrl-Y": "redo",
            "Ctrl-Home": "goDocStart",
            "Ctrl-End": "goDocEnd",
            "Ctrl-Up": "goLineUp",
            "Ctrl-Down": "goLineDown",
            "Ctrl-Left": "goGroupLeft",
            "Ctrl-Right": "goGroupRight",
            "Alt-Left": "goLineStart",
            "Alt-Right": "goLineEnd",
            "Ctrl-Backspace": "delGroupBefore",
            "Ctrl-Delete": "delGroupAfter",
            "Ctrl-S": "save",
            "Ctrl-F": "find",
            "Ctrl-G": "findNext",
            "Shift-Ctrl-G": "findPrev",
            "Shift-Ctrl-F": "replace",
            "Shift-Ctrl-R": "replaceAll",
            "Ctrl-[": "indentLess",
            "Ctrl-]": "indentMore",
            "Ctrl-U": "undoSelection",
            "Shift-Ctrl-U": "redoSelection",
            "Alt-U": "redoSelection",
            fallthrough: "basic"
        },
        cr.emacsy = {
            "Ctrl-F": "goCharRight",
            "Ctrl-B": "goCharLeft",
            "Ctrl-P": "goLineUp",
            "Ctrl-N": "goLineDown",
            "Alt-F": "goWordRight",
            "Alt-B": "goWordLeft",
            "Ctrl-A": "goLineStart",
            "Ctrl-E": "goLineEnd",
            "Ctrl-V": "goPageDown",
            "Shift-Ctrl-V": "goPageUp",
            "Ctrl-D": "delCharAfter",
            "Ctrl-H": "delCharBefore",
            "Alt-D": "delWordAfter",
            "Alt-Backspace": "delWordBefore",
            "Ctrl-K": "killLine",
            "Ctrl-T": "transposeChars"
        },
        cr.macDefault = {
            "Cmd-A": "selectAll",
            "Cmd-D": "deleteLine",
            "Cmd-Z": "undo",
            "Shift-Cmd-Z": "redo",
            "Cmd-Y": "redo",
            "Cmd-Home": "goDocStart",
            "Cmd-Up": "goDocStart",
            "Cmd-End": "goDocEnd",
            "Cmd-Down": "goDocEnd",
            "Alt-Left": "goGroupLeft",
            "Alt-Right": "goGroupRight",
            "Cmd-Left": "goLineLeft",
            "Cmd-Right": "goLineRight",
            "Alt-Backspace": "delGroupBefore",
            "Ctrl-Alt-Backspace": "delGroupAfter",
            "Alt-Delete": "delGroupAfter",
            "Cmd-S": "save",
            "Cmd-F": "find",
            "Cmd-G": "findNext",
            "Shift-Cmd-G": "findPrev",
            "Cmd-Alt-F": "replace",
            "Shift-Cmd-Alt-F": "replaceAll",
            "Cmd-[": "indentLess",
            "Cmd-]": "indentMore",
            "Cmd-Backspace": "delWrappedLineLeft",
            "Cmd-Delete": "delWrappedLineRight",
            "Cmd-U": "undoSelection",
            "Shift-Cmd-U": "redoSelection",
            "Ctrl-Up": "goDocStart",
            "Ctrl-Down": "goDocEnd",
            fallthrough: ["basic", "emacsy"]
        },
        cr.default = y ? cr.macDefault : cr.pcDefault,
        S.normalizeKeyMap = function(e) {
            var t = {};
            for (var n in e)
                if (e.hasOwnProperty(n)) {
                    var r = e[n];
                    if (/^(name|fallthrough|(de|at)tach)$/.test(n))
                        continue;
                    if ("..." == r) {
                        delete e[n];
                        continue;
                    }
                    for (var i = mo(n.split(" "), ur), o = 0; o < i.length; o++) {
                        var l, s;
                        o == i.length - 1 ? (s = i.join(" "),
                        l = r) : (s = i.slice(0, o + 1).join(" "),
                        l = "...");
                        var a = t[s];
                        if (a) {
                            if (a != l)
                                throw new Error("Inconsistent bindings for " + s);
                        } else
                            t[s] = l;
                    }
                    delete e[n];
                }
            for (var c in t)
                e[c] = t[c];
            return e;
        }
        ;
        var fr = S.lookupKey = function(e, t, n, r) {
            var i = (t = pr(t)).call ? t.call(e, r) : t[e];
            if (!1 === i)
                return "nothing";
            if ("..." === i)
                return "multi";
            if (null != i && n(i))
                return "handled";
            if (t.fallthrough) {
                if ("[object Array]" != Object.prototype.toString.call(t.fallthrough))
                    return fr(e, t.fallthrough, n, r);
                for (var o = 0; o < t.fallthrough.length; o++) {
                    var l = fr(e, t.fallthrough[o], n, r);
                    if (l)
                        return l;
                }
            }
        }
          , hr = S.isModifierKey = function(e) {
            var t = "string" == typeof e ? e : $o[e.keyCode];
            return "Ctrl" == t || "Alt" == t || "Shift" == t || "Mod" == t;
        }
          , dr = S.keyName = function(e, t) {
            if (v && 34 == e.keyCode && e.char)
                return !1;
            var n = $o[e.keyCode]
              , r = n;
            return null != r && !e.altGraphKey && (e.altKey && "Alt" != n && (r = "Alt-" + r),
            (d ? e.metaKey : e.ctrlKey) && "Ctrl" != n && (r = "Ctrl-" + r),
            (d ? e.ctrlKey : e.metaKey) && "Cmd" != n && (r = "Cmd-" + r),
            !t && e.shiftKey && "Shift" != n && (r = "Shift-" + r),
            r);
        }
        ;
        function pr(e) {
            return "string" == typeof e ? cr[e] : e;
        }
        S.fromTextArea = function(t, e) {
            if ((e = e ? bo(e) : {}).value = t.value,
            !e.tabindex && t.tabIndex && (e.tabindex = t.tabIndex),
            !e.placeholder && t.placeholder && (e.placeholder = t.placeholder),
            null == e.autofocus) {
                var n = Fo();
                e.autofocus = n == t || null != t.getAttribute("autofocus") && n == document.body;
            }
            function r() {
                t.value = s.getValue();
            }
            if (t.form && (Vi(t.form, "submit", r),
            !e.leaveSubmitMethodAlone)) {
                var i = t.form
                  , o = i.submit;
                try {
                    var l = i.submit = function() {
                        r(),
                        i.submit = o,
                        i.submit(),
                        i.submit = l;
                    }
                    ;
                } catch (e) {}
            }
            e.finishInit = function(e) {
                e.save = r,
                e.getTextArea = function() {
                    return t;
                }
                ,
                e.toTextArea = function() {
                    e.toTextArea = isNaN,
                    r(),
                    t.parentNode.removeChild(e.getWrapperElement()),
                    t.style.display = "",
                    t.form && (qi(t.form, "submit", r),
                    "function" == typeof t.form.submit && (t.form.submit = o));
                }
                ;
            }
            ,
            t.style.display = "none";
            var s = S(function(e) {
                t.parentNode.insertBefore(e, t.nextSibling);
            }, e);
            return s;
        }
        ;
        var gr = S.StringStream = function(e, t) {
            this.pos = this.start = 0,
            this.string = e,
            this.tabSize = t || 8,
            this.lastColumnPos = this.lastColumnValue = 0,
            this.lineStart = 0;
        }
        ;
        gr.prototype = {
            eol: function() {
                return this.pos >= this.string.length;
            },
            sol: function() {
                return this.pos == this.lineStart;
            },
            peek: function() {
                return this.string.charAt(this.pos) || void 0;
            },
            next: function() {
                if (this.pos < this.string.length)
                    return this.string.charAt(this.pos++);
            },
            eat: function(e) {
                var t = this.string.charAt(this.pos);
                if ("string" == typeof e)
                    var n = t == e;
                else
                    n = t && (e.test ? e.test(t) : e(t));
                if (n)
                    return ++this.pos,
                    t;
            },
            eatWhile: function(e) {
                for (var t = this.pos; this.eat(e); )
                    ;
                return this.pos > t;
            },
            eatSpace: function() {
                for (var e = this.pos; /[\s\u00a0]/.test(this.string.charAt(this.pos)); )
                    ++this.pos;
                return this.pos > e;
            },
            skipToEnd: function() {
                this.pos = this.string.length;
            },
            skipTo: function(e) {
                var t = this.string.indexOf(e, this.pos);
                if (-1 < t)
                    return this.pos = t,
                    !0;
            },
            backUp: function(e) {
                this.pos -= e;
            },
            column: function() {
                return this.lastColumnPos < this.start && (this.lastColumnValue = ao(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue),
                this.lastColumnPos = this.start),
                this.lastColumnValue - (this.lineStart ? ao(this.string, this.lineStart, this.tabSize) : 0);
            },
            indentation: function() {
                return ao(this.string, null, this.tabSize) - (this.lineStart ? ao(this.string, this.lineStart, this.tabSize) : 0);
            },
            match: function(e, t, n) {
                if ("string" != typeof e) {
                    var r = this.string.slice(this.pos).match(e);
                    return r && 0 < r.index ? null : (r && !1 !== t && (this.pos += r[0].length),
                    r);
                }
                var i = function(e) {
                    return n ? e.toLowerCase() : e;
                };
                if (i(this.string.substr(this.pos, e.length)) == i(e))
                    return !1 !== t && (this.pos += e.length),
                    !0;
            },
            current: function() {
                return this.string.slice(this.start, this.pos);
            },
            hideFirstChars: function(e, t) {
                this.lineStart += e;
                try {
                    return t();
                } finally {
                    this.lineStart -= e;
                }
            }
        };
        var mr = 0
          , vr = S.TextMarker = function(e, t) {
            this.lines = [],
            this.type = t,
            this.doc = e,
            this.id = ++mr;
        }
        ;
        to(vr),
        vr.prototype.clear = function() {
            if (!this.explicitlyCleared) {
                var e = this.doc.cm
                  , t = e && !e.curOp;
                if (t && Bt(e),
                eo(this, "clear")) {
                    var n = this.find();
                    n && $i(this, "clear", n.from, n.to);
                }
                for (var r = null, i = null, o = 0; o < this.lines.length; ++o) {
                    var l = this.lines[o]
                      , s = Sr(l.markedSpans, this);
                    e && !this.collapsed ? Jt(e, Si(l), "text") : e && (null != s.to && (i = Si(l)),
                    null != s.from && (r = Si(l))),
                    l.markedSpans = kr(l.markedSpans, s),
                    null == s.from && this.collapsed && !Br(this.doc, l) && e && Ci(l, Dt(e.display));
                }
                if (e && this.collapsed && !e.options.lineWrapping)
                    for (o = 0; o < this.lines.length; ++o) {
                        var a = Er(this.lines[o])
                          , c = H(a);
                        c > e.display.maxLineLength && (e.display.maxLine = a,
                        e.display.maxLineLength = c,
                        e.display.maxLineChanged = !0);
                    }
                null != r && e && this.collapsed && Qt(e, r, i + 1),
                this.lines.length = 0,
                this.explicitlyCleared = !0,
                this.atomic && this.doc.cantEdit && (this.doc.cantEdit = !1,
                e && Xe(e.doc)),
                e && $i(e, "markerCleared", e, this),
                t && Ut(e),
                this.parent && this.parent.clear();
            }
        }
        ,
        vr.prototype.find = function(e, t) {
            var n, r;
            null == e && "bookmark" == this.type && (e = 1);
            for (var i = 0; i < this.lines.length; ++i) {
                var o = this.lines[i]
                  , l = Sr(o.markedSpans, this);
                if (null != l.from && (n = he(t ? o : Si(o), l.from),
                -1 == e))
                    return n;
                if (null != l.to && (r = he(t ? o : Si(o), l.to),
                1 == e))
                    return r;
            }
            return n && {
                from: n,
                to: r
            };
        }
        ,
        vr.prototype.changed = function() {
            var o = this.find(-1, !0)
              , l = this
              , s = this.doc.cm;
            o && s && _t(s, function() {
                var e = o.line
                  , t = Si(o.line)
                  , n = gt(s, t);
                if (n && (xt(n),
                s.curOp.selectionChanged = s.curOp.forceUpdate = !0),
                s.curOp.updateMaxLine = !0,
                !Br(l.doc, e) && null != l.height) {
                    var r = l.height;
                    l.height = null;
                    var i = Vr(l) - r;
                    i && Ci(e, e.height + i);
                }
            });
        }
        ,
        vr.prototype.attachLine = function(e) {
            if (!this.lines.length && this.doc.cm) {
                var t = this.doc.cm.curOp;
                t.maybeHiddenMarkers && -1 != go(t.maybeHiddenMarkers, this) || (t.maybeUnhiddenMarkers || (t.maybeUnhiddenMarkers = [])).push(this);
            }
            this.lines.push(e);
        }
        ,
        vr.prototype.detachLine = function(e) {
            if (this.lines.splice(go(this.lines, e), 1),
            !this.lines.length && this.doc.cm) {
                var t = this.doc.cm.curOp;
                (t.maybeHiddenMarkers || (t.maybeHiddenMarkers = [])).push(this);
            }
        }
        ;
        mr = 0;
        function yr(t, r, i, e, n) {
            if (e && e.shared)
                return function(e, n, r, i, o) {
                    (i = bo(i)).shared = !1;
                    var l = [yr(e, n, r, i, o)]
                      , s = l[0]
                      , a = i.widgetNode;
                    return vi(e, function(e) {
                        a && (i.widgetNode = a.cloneNode(!0)),
                        l.push(yr(e, Ie(e, n), Ie(e, r), i, o));
                        for (var t = 0; t < e.linked.length; ++t)
                            if (e.linked[t].isParent)
                                return;
                        s = ho(l);
                    }),
                    new br(l,s);
                }(t, r, i, e, n);
            if (t.cm && !t.cm.curOp)
                return qt(t.cm, yr)(t, r, i, e, n);
            var o = new vr(t,n)
              , l = de(r, i);
            if (e && bo(e, o, !1),
            0 < l || 0 == l && !1 !== o.clearWhenEmpty)
                return o;
            if (o.replacedWith && (o.collapsed = !0,
            o.widgetNode = No("span", [o.replacedWith], "CodeMirror-widget"),
            e.handleMouseEvents || o.widgetNode.setAttribute("cm-ignore-events", "true"),
            e.insertLeft && (o.widgetNode.insertLeft = !0)),
            o.collapsed) {
                if (Ir(t, r.line, r, i, o) || r.line != i.line && Ir(t, i.line, r, i, o))
                    throw new Error("Inserting collapsed marker partially overlapping an existing one");
                C = !0;
            }
            o.addToHistory && Ai(t, {
                from: r,
                to: i,
                origin: "markText"
            }, t.sel, NaN);
            var s, a = r.line, c = t.cm;
            if (t.iter(a, i.line + 1, function(e) {
                var t, n;
                c && o.collapsed && !c.options.lineWrapping && Er(e) == c.display.maxLine && (s = !0),
                o.collapsed && a != r.line && Ci(e, 0),
                t = e,
                n = new Cr(o,a == r.line ? r.ch : null,a == i.line ? i.ch : null),
                t.markedSpans = t.markedSpans ? t.markedSpans.concat([n]) : [n],
                n.marker.attachLine(t),
                ++a;
            }),
            o.collapsed && t.iter(r.line, i.line + 1, function(e) {
                Br(t, e) && Ci(e, 0);
            }),
            o.clearOnEnter && Vi(o, "beforeCursorEnter", function() {
                o.clear();
            }),
            o.readOnly && (b = !0,
            (t.history.done.length || t.history.undone.length) && t.clearHistory()),
            o.collapsed && (o.id = ++mr,
            o.atomic = !0),
            c) {
                if (s && (c.curOp.updateMaxLine = !0),
                o.collapsed)
                    Qt(c, r.line, i.line + 1);
                else if (o.className || o.title || o.startStyle || o.endStyle || o.css)
                    for (var u = r.line; u <= i.line; u++)
                        Jt(c, u, "text");
                o.atomic && Xe(c.doc),
                $i(c, "markerAdded", c, o);
            }
            return o;
        }
        var br = S.SharedTextMarker = function(e, t) {
            this.markers = e,
            this.primary = t;
            for (var n = 0; n < e.length; ++n)
                e[n].parent = this;
        }
        ;
        function wr(e) {
            return e.findMarks(he(e.first, 0), e.clipPos(he(e.lastLine())), function(e) {
                return e.parent;
            });
        }
        function xr(e) {
            for (var t = 0; t < e.length; t++) {
                var n = e[t]
                  , r = [n.primary.doc];
                vi(n.primary.doc, function(e) {
                    r.push(e);
                });
                for (var i = 0; i < n.markers.length; i++) {
                    var o = n.markers[i];
                    -1 == go(r, o.doc) && (o.parent = null,
                    n.markers.splice(i--, 1));
                }
            }
        }
        function Cr(e, t, n) {
            this.marker = e,
            this.from = t,
            this.to = n;
        }
        function Sr(e, t) {
            if (e)
                for (var n = 0; n < e.length; ++n) {
                    var r = e[n];
                    if (r.marker == t)
                        return r;
                }
        }
        function kr(e, t) {
            for (var n, r = 0; r < e.length; ++r)
                e[r] != t && (n || (n = [])).push(e[r]);
            return n;
        }
        function Lr(e, t) {
            if (t.full)
                return null;
            var n = Ee(e, t.from.line) && bi(e, t.from.line).markedSpans
              , r = Ee(e, t.to.line) && bi(e, t.to.line).markedSpans;
            if (!n && !r)
                return null;
            var i = t.from.ch
              , o = t.to.ch
              , l = 0 == de(t.from, t.to)
              , s = function(e, t, n) {
                if (e)
                    for (var r, i = 0; i < e.length; ++i) {
                        var o = e[i]
                          , l = o.marker;
                        if (null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t) || o.from == t && "bookmark" == l.type && (!n || !o.marker.insertLeft)) {
                            var s = null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t);
                            (r || (r = [])).push(new Cr(l,o.from,s ? null : o.to));
                        }
                    }
                return r;
            }(n, i, l)
              , a = function(e, t, n) {
                if (e)
                    for (var r, i = 0; i < e.length; ++i) {
                        var o = e[i]
                          , l = o.marker;
                        if (null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t) || o.from == t && "bookmark" == l.type && (!n || o.marker.insertLeft)) {
                            var s = null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t);
                            (r || (r = [])).push(new Cr(l,s ? null : o.from - t,null == o.to ? null : o.to - t));
                        }
                    }
                return r;
            }(r, o, l)
              , c = 1 == t.text.length
              , u = ho(t.text).length + (c ? i : 0);
            if (s)
                for (var f = 0; f < s.length; ++f) {
                    if (null == (h = s[f]).to)
                        (d = Sr(a, h.marker)) ? c && (h.to = null == d.to ? null : d.to + u) : h.to = i;
                }
            if (a)
                for (f = 0; f < a.length; ++f) {
                    var h, d;
                    if (null != (h = a[f]).to && (h.to += u),
                    null == h.from)
                        (d = Sr(s, h.marker)) || (h.from = u,
                        c && (s || (s = [])).push(h));
                    else
                        h.from += u,
                        c && (s || (s = [])).push(h);
                }
            s && (s = Mr(s)),
            a && a != s && (a = Mr(a));
            var p = [s];
            if (!c) {
                var g, m = t.text.length - 2;
                if (0 < m && s)
                    for (f = 0; f < s.length; ++f)
                        null == s[f].to && (g || (g = [])).push(new Cr(s[f].marker,null,null));
                for (f = 0; f < m; ++f)
                    p.push(g);
                p.push(a);
            }
            return p;
        }
        function Mr(e) {
            for (var t = 0; t < e.length; ++t) {
                var n = e[t];
                null != n.from && n.from == n.to && !1 !== n.marker.clearWhenEmpty && e.splice(t--, 1);
            }
            return e.length ? e : null;
        }
        function Tr(e, t) {
            var n = function(e, t) {
                var n = t["spans_" + e.id];
                if (!n)
                    return null;
                for (var r = 0, i = []; r < t.text.length; ++r)
                    i.push(Hi(n[r]));
                return i;
            }(e, t)
              , r = Lr(e, t);
            if (!n)
                return r;
            if (!r)
                return n;
            for (var i = 0; i < n.length; ++i) {
                var o = n[i]
                  , l = r[i];
                if (o && l)
                    e: for (var s = 0; s < l.length; ++s) {
                        for (var a = l[s], c = 0; c < o.length; ++c)
                            if (o[c].marker == a.marker)
                                continue e;
                        o.push(a);
                    }
                else
                    l && (n[i] = l);
            }
            return n;
        }
        function Nr(e) {
            var t = e.markedSpans;
            if (t) {
                for (var n = 0; n < t.length; ++n)
                    t[n].marker.detachLine(e);
                e.markedSpans = null;
            }
        }
        function Or(e, t) {
            if (t) {
                for (var n = 0; n < t.length; ++n)
                    t[n].marker.attachLine(e);
                e.markedSpans = t;
            }
        }
        function Ar(e) {
            return e.inclusiveLeft ? -1 : 0;
        }
        function Wr(e) {
            return e.inclusiveRight ? 1 : 0;
        }
        function Fr(e, t) {
            var n = e.lines.length - t.lines.length;
            if (0 != n)
                return n;
            var r = e.find()
              , i = t.find()
              , o = de(r.from, i.from) || Ar(e) - Ar(t);
            if (o)
                return -o;
            var l = de(r.to, i.to) || Wr(e) - Wr(t);
            return l || t.id - e.id;
        }
        function Hr(e, t) {
            var n, r = C && e.markedSpans;
            if (r)
                for (var i, o = 0; o < r.length; ++o)
                    (i = r[o]).marker.collapsed && null == (t ? i.from : i.to) && (!n || Fr(n, i.marker) < 0) && (n = i.marker);
            return n;
        }
        function Dr(e) {
            return Hr(e, !0);
        }
        function Pr(e) {
            return Hr(e, !1);
        }
        function Ir(e, t, n, r, i) {
            var o = bi(e, t)
              , l = C && o.markedSpans;
            if (l)
                for (var s = 0; s < l.length; ++s) {
                    var a = l[s];
                    if (a.marker.collapsed) {
                        var c = a.marker.find(0)
                          , u = de(c.from, n) || Ar(a.marker) - Ar(i)
                          , f = de(c.to, r) || Wr(a.marker) - Wr(i);
                        if (!(0 <= u && f <= 0 || u <= 0 && 0 <= f) && (u <= 0 && (0 < de(c.to, n) || a.marker.inclusiveRight && i.inclusiveLeft) || 0 <= u && (de(c.from, r) < 0 || a.marker.inclusiveLeft && i.inclusiveRight)))
                            return !0;
                    }
                }
        }
        function Er(e) {
            for (var t; t = Dr(e); )
                e = t.find(-1, !0).line;
            return e;
        }
        function zr(e, t) {
            var n = bi(e, t)
              , r = Er(n);
            return n == r ? t : Si(r);
        }
        function Rr(e, t) {
            if (t > e.lastLine())
                return t;
            var n, r = bi(e, t);
            if (!Br(e, r))
                return t;
            for (; n = Pr(r); )
                r = n.find(1, !0).line;
            return Si(r) + 1;
        }
        function Br(e, t) {
            var n = C && t.markedSpans;
            if (n)
                for (var r, i = 0; i < n.length; ++i)
                    if ((r = n[i]).marker.collapsed) {
                        if (null == r.from)
                            return !0;
                        if (!r.marker.widgetNode && 0 == r.from && r.marker.inclusiveLeft && Ur(e, t, r))
                            return !0;
                    }
        }
        function Ur(e, t, n) {
            if (null == n.to) {
                var r = n.marker.find(1, !0);
                return Ur(e, r.line, Sr(r.line.markedSpans, n.marker));
            }
            if (n.marker.inclusiveRight && n.to == t.text.length)
                return !0;
            for (var i, o = 0; o < t.markedSpans.length; ++o)
                if ((i = t.markedSpans[o]).marker.collapsed && !i.marker.widgetNode && i.from == n.to && (null == i.to || i.to != n.from) && (i.marker.inclusiveLeft || n.marker.inclusiveRight) && Ur(e, t, i))
                    return !0;
        }
        to(br),
        br.prototype.clear = function() {
            if (!this.explicitlyCleared) {
                this.explicitlyCleared = !0;
                for (var e = 0; e < this.markers.length; ++e)
                    this.markers[e].clear();
                $i(this, "clear");
            }
        }
        ,
        br.prototype.find = function(e, t) {
            return this.primary.find(e, t);
        }
        ;
        var Gr = S.LineWidget = function(e, t, n) {
            if (n)
                for (var r in n)
                    n.hasOwnProperty(r) && (this[r] = n[r]);
            this.doc = e,
            this.node = t;
        }
        ;
        function Kr(e, t, n) {
            Li(t) < (e.curOp && e.curOp.scrollTop || e.doc.scrollTop) && Kn(e, null, n);
        }
        function Vr(e) {
            if (null != e.height)
                return e.height;
            var t = e.doc.cm;
            if (!t)
                return 0;
            if (!Wo(document.body, e.node)) {
                var n = "position: relative;";
                e.coverGutter && (n += "margin-left: -" + t.display.gutters.offsetWidth + "px;"),
                e.noHScroll && (n += "width: " + t.display.wrapper.clientWidth + "px;"),
                Ao(t.display.measure, No("div", [e.node], null, n));
            }
            return e.height = e.node.parentNode.offsetHeight;
        }
        to(Gr),
        Gr.prototype.clear = function() {
            var e = this.doc.cm
              , t = this.line.widgets
              , n = this.line
              , r = Si(n);
            if (null != r && t) {
                for (var i = 0; i < t.length; ++i)
                    t[i] == this && t.splice(i--, 1);
                t.length || (n.widgets = null);
                var o = Vr(this);
                Ci(n, Math.max(0, n.height - o)),
                e && _t(e, function() {
                    Kr(e, n, -o),
                    Jt(e, r, "widget");
                });
            }
        }
        ,
        Gr.prototype.changed = function() {
            var e = this.height
              , t = this.doc.cm
              , n = this.line;
            this.height = null;
            var r = Vr(this) - e;
            r && (Ci(n, n.height + r),
            t && _t(t, function() {
                t.curOp.forceUpdate = !0,
                Kr(t, n, r);
            }));
        }
        ;
        var jr = S.Line = function(e, t, n) {
            this.text = e,
            Or(this, t),
            this.height = n ? n(this) : 1;
        }
        ;
        function _r(e, t) {
            if (e)
                for (; ; ) {
                    var n = e.match(/(?:^|\s+)line-(background-)?(\S+)/);
                    if (!n)
                        break;
                    e = e.slice(0, n.index) + e.slice(n.index + n[0].length);
                    var r = n[1] ? "bgClass" : "textClass";
                    null == t[r] ? t[r] = n[2] : new RegExp("(?:^|s)" + n[2] + "(?:$|s)").test(t[r]) || (t[r] += " " + n[2]);
                }
            return e;
        }
        function qr(e, t) {
            if (e.blankLine)
                return e.blankLine(t);
            if (e.innerMode) {
                var n = S.innerMode(e, t);
                return n.mode.blankLine ? n.mode.blankLine(n.state) : void 0;
            }
        }
        function Xr(e, t, n, r) {
            for (var i = 0; i < 10; i++) {
                r && (r[0] = S.innerMode(e, n).mode);
                var o = e.token(t, n);
                if (t.pos > t.start)
                    return o;
            }
            throw new Error("Mode " + e.name + " failed to advance stream.");
        }
        function Yr(e, t, n, r) {
            function i(e) {
                return {
                    start: f.start,
                    end: f.pos,
                    string: f.current(),
                    type: o || null,
                    state: e ? lr(l.mode, u) : u
                };
            }
            var o, l = e.doc, s = l.mode;
            t = Ie(l, t);
            var a, c = bi(l, t.line), u = lt(e, t.line, n), f = new gr(c.text,e.options.tabSize);
            for (r && (a = []); (r || f.pos < t.ch) && !f.eol(); )
                f.start = f.pos,
                o = Xr(s, f, u),
                r && a.push(i(!0));
            return r ? a : i();
        }
        function $r(e, t, n, r, i, o, l) {
            var s = n.flattenSpans;
            null == s && (s = e.options.flattenSpans);
            var a, c = 0, u = null, f = new gr(t,e.options.tabSize), h = e.options.addModeClass && [null];
            for ("" == t && _r(qr(n, r), o); !f.eol(); ) {
                if (f.pos > e.options.maxHighlightLength ? (s = !1,
                l && Jr(e, t, r, f.pos),
                f.pos = t.length,
                a = null) : a = _r(Xr(n, f, r, h), o),
                h) {
                    var d = h[0].name;
                    d && (a = "m-" + (a ? d + " " + a : d));
                }
                if (!s || u != a) {
                    for (; c < f.start; )
                        i(c = Math.min(f.start, c + 5e4), u);
                    u = a;
                }
                f.start = f.pos;
            }
            for (; c < f.pos; ) {
                var p = Math.min(f.pos, c + 5e4);
                i(p, u),
                c = p;
            }
        }
        function Zr(e, t, n, r) {
            var o = [e.state.modeGen]
              , i = {};
            $r(e, t.text, e.doc.mode, n, function(e, t) {
                o.push(e, t);
            }, i, r);
            for (var l = 0; l < e.state.overlays.length; ++l) {
                var s = e.state.overlays[l]
                  , a = 1
                  , c = 0;
                $r(e, t.text, s.mode, !0, function(e, t) {
                    for (var n = a; c < e; ) {
                        var r = o[a];
                        e < r && o.splice(a, 1, e, o[a + 1], r),
                        a += 2,
                        c = Math.min(e, r);
                    }
                    if (t)
                        if (s.opaque)
                            o.splice(n, a - n, e, "cm-overlay " + t),
                            a = n + 2;
                        else
                            for (; n < a; n += 2) {
                                var i = o[n + 1];
                                o[n + 1] = (i ? i + " " : "") + "cm-overlay " + t;
                            }
                }, i);
            }
            return {
                styles: o,
                classes: i.bgClass || i.textClass ? i : null
            };
        }
        function Qr(e, t, n) {
            if (!t.styles || t.styles[0] != e.state.modeGen) {
                var r = lt(e, Si(t))
                  , i = Zr(e, t, t.text.length > e.options.maxHighlightLength ? lr(e.doc.mode, r) : r);
                t.stateAfter = r,
                t.styles = i.styles,
                i.classes ? t.styleClasses = i.classes : t.styleClasses && (t.styleClasses = null),
                n === e.doc.frontier && e.doc.frontier++;
            }
            return t.styles;
        }
        function Jr(e, t, n, r) {
            var i = e.doc.mode
              , o = new gr(t,e.options.tabSize);
            for (o.start = o.pos = r || 0,
            "" == t && qr(i, n); !o.eol(); )
                Xr(i, o, n),
                o.start = o.pos;
        }
        to(jr),
        jr.prototype.lineNo = function() {
            return Si(this);
        }
        ;
        var ei = {}
          , ti = {};
        function ni(e, t) {
            if (!e || /^\s*$/.test(e))
                return null;
            var n = t.addModeClass ? ti : ei;
            return n[e] || (n[e] = e.replace(/\S+/g, "cm-$&"));
        }
        function ri(e, t) {
            var n = No("span", null, null, m ? "padding-right: .1px" : null)
              , r = {
                pre: No("pre", [n], "CodeMirror-line"),
                content: n,
                col: 0,
                pos: 0,
                cm: e,
                splitSpaces: (w || m) && e.getOption("lineWrapping")
            };
            t.measure = {};
            for (var i = 0; i <= (t.rest ? t.rest.length : 0); i++) {
                var o, l = i ? t.rest[i - 1] : t.line;
                r.pos = 0,
                r.addToken = ii,
                Ko(e.display.measure) && (o = Mi(l)) && (r.addToken = li(r.addToken, o)),
                r.map = [],
                ai(l, r, Qr(e, l, t != e.display.externalMeasured && Si(l))),
                l.styleClasses && (l.styleClasses.bgClass && (r.bgClass = Io(l.styleClasses.bgClass, r.bgClass || "")),
                l.styleClasses.textClass && (r.textClass = Io(l.styleClasses.textClass, r.textClass || ""))),
                0 == r.map.length && r.map.push(0, 0, r.content.appendChild(Go(e.display.measure))),
                0 == i ? (t.measure.map = r.map,
                t.measure.cache = {}) : ((t.measure.maps || (t.measure.maps = [])).push(r.map),
                (t.measure.caches || (t.measure.caches = [])).push({}));
            }
            return m && /\bcm-tab\b/.test(r.content.lastChild.className) && (r.content.className = "cm-tab-wrap-hack"),
            Xi(e, "renderLine", e, t.line, r.pre),
            r.pre.className && (r.textClass = Io(r.pre.className, r.textClass || "")),
            r;
        }
        function ii(e, t, n, r, i, o, l) {
            if (t) {
                var s = e.splitSpaces ? t.replace(/ {3,}/g, oi) : t
                  , a = e.cm.state.specialChars
                  , c = !1;
                if (a.test(t)) {
                    m = document.createDocumentFragment();
                    for (var u = 0; ; ) {
                        a.lastIndex = u;
                        var f = a.exec(t)
                          , h = f ? f.index - u : t.length - u;
                        if (h) {
                            var d = document.createTextNode(s.slice(u, u + h));
                            w && x < 9 ? m.appendChild(No("span", [d])) : m.appendChild(d),
                            e.map.push(e.pos, e.pos + h, d),
                            e.col += h,
                            e.pos += h;
                        }
                        if (!f)
                            break;
                        if (u += h + 1,
                        "\t" == f[0]) {
                            var p = e.cm.options.tabSize
                              , g = p - e.col % p;
                            (d = m.appendChild(No("span", fo(g), "cm-tab"))).setAttribute("role", "presentation"),
                            d.setAttribute("cm-text", "\t"),
                            e.col += g;
                        } else if ("\r" == f[0] || "\n" == f[0]) {
                            (d = m.appendChild(No("span", "\r" == f[0] ? "\u240d" : "\u2424", "cm-invalidchar"))).setAttribute("cm-text", f[0]),
                            e.col += 1;
                        } else {
                            (d = e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text", f[0]),
                            w && x < 9 ? m.appendChild(No("span", [d])) : m.appendChild(d),
                            e.col += 1;
                        }
                        e.map.push(e.pos, e.pos + 1, d),
                        e.pos++;
                    }
                } else {
                    e.col += t.length;
                    var m = document.createTextNode(s);
                    e.map.push(e.pos, e.pos + t.length, m),
                    w && x < 9 && (c = !0),
                    e.pos += t.length;
                }
                if (n || r || i || c || l) {
                    var v = n || "";
                    r && (v += r),
                    i && (v += i);
                    var y = No("span", [m], v, l);
                    return o && (y.title = o),
                    e.content.appendChild(y);
                }
                e.content.appendChild(m);
            }
        }
        function oi(e) {
            for (var t = " ", n = 0; n < e.length - 2; ++n)
                t += n % 2 ? " " : "\xa0";
            return t += " ";
        }
        function li(f, h) {
            return function(e, t, n, r, i, o, l) {
                n = n ? n + " cm-force-border" : "cm-force-border";
                for (var s = e.pos, a = s + t.length; ; ) {
                    for (var c = 0; c < h.length; c++) {
                        var u = h[c];
                        if (u.to > s && u.from <= s)
                            break;
                    }
                    if (u.to >= a)
                        return f(e, t, n, r, i, o, l);
                    f(e, t.slice(0, u.to - s), n, r, null, o, l),
                    r = null,
                    t = t.slice(u.to - s),
                    s = u.to;
                }
            }
            ;
        }
        function si(e, t, n, r) {
            var i = !r && n.widgetNode;
            i && e.map.push(e.pos, e.pos + t, i),
            !r && e.cm.display.input.needsContentAttribute && (i || (i = e.content.appendChild(document.createElement("span"))),
            i.setAttribute("cm-marker", n.id)),
            i && (e.cm.display.input.setUneditable(i),
            e.content.appendChild(i)),
            e.pos += t;
        }
        function ai(e, t, n) {
            var r = e.markedSpans
              , i = e.text
              , o = 0;
            if (r)
                for (var l, s, a, c, u, f, h, d = i.length, p = 0, g = (L = 1,
                ""), m = 0; ; ) {
                    if (m == p) {
                        a = c = u = f = s = "",
                        h = null,
                        m = 1 / 0;
                        for (var v, y = [], b = 0; b < r.length; ++b) {
                            var w = r[b]
                              , x = w.marker;
                            "bookmark" == x.type && w.from == p && x.widgetNode ? y.push(x) : w.from <= p && (null == w.to || w.to > p || x.collapsed && w.to == p && w.from == p) ? (null != w.to && w.to != p && m > w.to && (m = w.to,
                            c = ""),
                            x.className && (a += " " + x.className),
                            x.css && (s = (s ? s + ";" : "") + x.css),
                            x.startStyle && w.from == p && (u += " " + x.startStyle),
                            x.endStyle && w.to == m && (v || (v = [])).push(x.endStyle, w.to),
                            x.title && !f && (f = x.title),
                            x.collapsed && (!h || Fr(h.marker, x) < 0) && (h = w)) : w.from > p && m > w.from && (m = w.from);
                        }
                        if (v)
                            for (b = 0; b < v.length; b += 2)
                                v[b + 1] == m && (c += " " + v[b]);
                        if (!h || h.from == p)
                            for (b = 0; b < y.length; ++b)
                                si(t, 0, y[b]);
                        if (h && (h.from || 0) == p) {
                            if (si(t, (null == h.to ? d + 1 : h.to) - p, h.marker, null == h.from),
                            null == h.to)
                                return;
                            h.to == p && (h = !1);
                        }
                    }
                    if (d <= p)
                        break;
                    for (var C = Math.min(d, m); ; ) {
                        if (g) {
                            var S = p + g.length;
                            if (!h) {
                                var k = C < S ? g.slice(0, C - p) : g;
                                t.addToken(t, k, l ? l + a : a, u, p + k.length == m ? c : "", f, s);
                            }
                            if (C <= S) {
                                g = g.slice(C - p),
                                p = C;
                                break;
                            }
                            p = S,
                            u = "";
                        }
                        g = i.slice(o, o = n[L++]),
                        l = ni(n[L++], t.cm.options);
                    }
                }
            else
                for (var L = 1; L < n.length; L += 2)
                    t.addToken(t, i.slice(o, o = n[L]), ni(n[L + 1], t.cm.options));
        }
        function ci(e, t) {
            return 0 == t.from.ch && 0 == t.to.ch && "" == ho(t.text) && (!e.cm || e.cm.options.wholeLineUpdateBefore);
        }
        function ui(e, r, t, i) {
            function o(e) {
                return t ? t[e] : null;
            }
            function n(e, t, n) {
                !function(e, t, n, r) {
                    e.text = t,
                    e.stateAfter && (e.stateAfter = null),
                    e.styles && (e.styles = null),
                    null != e.order && (e.order = null),
                    Nr(e),
                    Or(e, n);
                    var i = r ? r(e) : 1;
                    i != e.height && Ci(e, i);
                }(e, t, n, i),
                $i(e, "change", e, r);
            }
            function l(e, t) {
                for (var n = e, r = []; n < t; ++n)
                    r.push(new jr(c[n],o(n),i));
                return r;
            }
            var s = r.from
              , a = r.to
              , c = r.text
              , u = bi(e, s.line)
              , f = bi(e, a.line)
              , h = ho(c)
              , d = o(c.length - 1)
              , p = a.line - s.line;
            if (r.full)
                e.insert(0, l(0, c.length)),
                e.remove(c.length, e.size - c.length);
            else if (ci(e, r)) {
                var g = l(0, c.length - 1);
                n(f, f.text, d),
                p && e.remove(s.line, p),
                g.length && e.insert(s.line, g);
            } else if (u == f) {
                if (1 == c.length)
                    n(u, u.text.slice(0, s.ch) + h + u.text.slice(a.ch), d);
                else
                    (g = l(1, c.length - 1)).push(new jr(h + u.text.slice(a.ch),d,i)),
                    n(u, u.text.slice(0, s.ch) + c[0], o(0)),
                    e.insert(s.line + 1, g);
            } else if (1 == c.length)
                n(u, u.text.slice(0, s.ch) + c[0] + f.text.slice(a.ch), o(0)),
                e.remove(s.line + 1, p);
            else {
                n(u, u.text.slice(0, s.ch) + c[0], o(0)),
                n(f, h + f.text.slice(a.ch), d);
                g = l(1, c.length - 1);
                1 < p && e.remove(s.line + 1, p - 1),
                e.insert(s.line + 1, g);
            }
            $i(e, "change", e, r);
        }
        function fi(e) {
            this.lines = e,
            this.parent = null;
            for (var t = 0, n = 0; t < e.length; ++t)
                e[t].parent = this,
                n += e[t].height;
            this.height = n;
        }
        function hi(e) {
            this.children = e;
            for (var t = 0, n = 0, r = 0; r < e.length; ++r) {
                var i = e[r];
                t += i.chunkSize(),
                n += i.height,
                i.parent = this;
            }
            this.size = t,
            this.height = n,
            this.parent = null;
        }
        fi.prototype = {
            chunkSize: function() {
                return this.lines.length;
            },
            removeInner: function(e, t) {
                for (var n = e, r = e + t; n < r; ++n) {
                    var i = this.lines[n];
                    this.height -= i.height,
                    (o = i).parent = null,
                    Nr(o),
                    $i(i, "delete");
                }
                var o;
                this.lines.splice(e, t);
            },
            collapse: function(e) {
                e.push.apply(e, this.lines);
            },
            insertInner: function(e, t, n) {
                this.height += n,
                this.lines = this.lines.slice(0, e).concat(t).concat(this.lines.slice(e));
                for (var r = 0; r < t.length; ++r)
                    t[r].parent = this;
            },
            iterN: function(e, t, n) {
                for (var r = e + t; e < r; ++e)
                    if (n(this.lines[e]))
                        return !0;
            }
        },
        hi.prototype = {
            chunkSize: function() {
                return this.size;
            },
            removeInner: function(e, t) {
                this.size -= t;
                for (var n = 0; n < this.children.length; ++n) {
                    var r = this.children[n]
                      , i = r.chunkSize();
                    if (e < i) {
                        var o = Math.min(t, i - e)
                          , l = r.height;
                        if (r.removeInner(e, o),
                        this.height -= l - r.height,
                        i == o && (this.children.splice(n--, 1),
                        r.parent = null),
                        0 == (t -= o))
                            break;
                        e = 0;
                    } else
                        e -= i;
                }
                if (this.size - t < 25 && (1 < this.children.length || !(this.children[0]instanceof fi))) {
                    var s = [];
                    this.collapse(s),
                    this.children = [new fi(s)],
                    this.children[0].parent = this;
                }
            },
            collapse: function(e) {
                for (var t = 0; t < this.children.length; ++t)
                    this.children[t].collapse(e);
            },
            insertInner: function(e, t, n) {
                this.size += t.length,
                this.height += n;
                for (var r = 0; r < this.children.length; ++r) {
                    var i = this.children[r]
                      , o = i.chunkSize();
                    if (e <= o) {
                        if (i.insertInner(e, t, n),
                        i.lines && 50 < i.lines.length) {
                            for (; 50 < i.lines.length; ) {
                                var l = new fi(i.lines.splice(i.lines.length - 25, 25));
                                i.height -= l.height,
                                this.children.splice(r + 1, 0, l),
                                l.parent = this;
                            }
                            this.maybeSpill();
                        }
                        break;
                    }
                    e -= o;
                }
            },
            maybeSpill: function() {
                if (!(this.children.length <= 10)) {
                    var e = this;
                    do {
                        var t = new hi(e.children.splice(e.children.length - 5, 5));
                        if (e.parent) {
                            e.size -= t.size,
                            e.height -= t.height;
                            var n = go(e.parent.children, e);
                            e.parent.children.splice(n + 1, 0, t);
                        } else {
                            var r = new hi(e.children);
                            (r.parent = e).children = [r, t],
                            e = r;
                        }
                        t.parent = e.parent;
                    } while (10 < e.children.length);e.parent.maybeSpill();
                }
            },
            iterN: function(e, t, n) {
                for (var r = 0; r < this.children.length; ++r) {
                    var i = this.children[r]
                      , o = i.chunkSize();
                    if (e < o) {
                        var l = Math.min(t, o - e);
                        if (i.iterN(e, l, n))
                            return !0;
                        if (0 == (t -= l))
                            break;
                        e = 0;
                    } else
                        e -= o;
                }
            }
        };
        var di = 0
          , pi = S.Doc = function(e, t, n, r) {
            if (!(this instanceof pi))
                return new pi(e,t,n,r);
            null == n && (n = 0),
            hi.call(this, [new fi([new jr("",null)])]),
            this.first = n,
            this.scrollTop = this.scrollLeft = 0,
            this.cantEdit = !1,
            this.cleanGeneration = 1,
            this.frontier = n;
            var i = he(n, 0);
            this.sel = De(i),
            this.history = new Ti(null),
            this.id = ++di,
            this.modeOption = t,
            this.lineSep = r,
            this.extend = !1,
            "string" == typeof e && (e = this.splitLines(e)),
            ui(this, {
                from: i,
                to: i,
                text: e
            }),
            je(this, De(i), io);
        }
        ;
        pi.prototype = yo(hi.prototype, {
            constructor: pi,
            iter: function(e, t, n) {
                n ? this.iterN(e - this.first, t - e, n) : this.iterN(this.first, this.first + this.size, e);
            },
            insert: function(e, t) {
                for (var n = 0, r = 0; r < t.length; ++r)
                    n += t[r].height;
                this.insertInner(e - this.first, t, n);
            },
            remove: function(e, t) {
                this.removeInner(e - this.first, t);
            },
            getValue: function(e) {
                var t = xi(this, this.first, this.first + this.size);
                return !1 === e ? t : t.join(e || this.lineSeparator());
            },
            setValue: Yt(function(e) {
                var t = he(this.first, 0)
                  , n = this.first + this.size - 1;
                In(this, {
                    from: t,
                    to: he(n, bi(this, n).text.length),
                    text: this.splitLines(e),
                    origin: "setValue",
                    full: !0
                }, !0),
                je(this, De(t));
            }),
            replaceRange: function(e, t, n, r) {
                Un(this, e, t = Ie(this, t), n = n ? Ie(this, n) : t, r);
            },
            getRange: function(e, t, n) {
                var r = wi(this, Ie(this, e), Ie(this, t));
                return !1 === n ? r : r.join(n || this.lineSeparator());
            },
            getLine: function(e) {
                var t = this.getLineHandle(e);
                return t && t.text;
            },
            getLineHandle: function(e) {
                if (Ee(this, e))
                    return bi(this, e);
            },
            getLineNumber: function(e) {
                return Si(e);
            },
            getLineHandleVisualStart: function(e) {
                return "number" == typeof e && (e = bi(this, e)),
                Er(e);
            },
            lineCount: function() {
                return this.size;
            },
            firstLine: function() {
                return this.first;
            },
            lastLine: function() {
                return this.first + this.size - 1;
            },
            clipPos: function(e) {
                return Ie(this, e);
            },
            getCursor: function(e) {
                var t = this.sel.primary();
                return null == e || "head" == e ? t.head : "anchor" == e ? t.anchor : "end" == e || "to" == e || !1 === e ? t.to() : t.from();
            },
            listSelections: function() {
                return this.sel.ranges;
            },
            somethingSelected: function() {
                return this.sel.somethingSelected();
            },
            setCursor: Yt(function(e, t, n) {
                Ke(this, Ie(this, "number" == typeof e ? he(e, t || 0) : e), null, n);
            }),
            setSelection: Yt(function(e, t, n) {
                Ke(this, Ie(this, e), Ie(this, t || e), n);
            }),
            extendSelection: Yt(function(e, t, n) {
                Be(this, Ie(this, e), t && Ie(this, t), n);
            }),
            extendSelections: Yt(function(e, t) {
                Ue(this, ze(this, e), t);
            }),
            extendSelectionsBy: Yt(function(e, t) {
                Ue(this, ze(this, mo(this.sel.ranges, e)), t);
            }),
            setSelections: Yt(function(e, t, n) {
                if (e.length) {
                    for (var r = 0, i = []; r < e.length; r++)
                        i[r] = new Fe(Ie(this, e[r].anchor),Ie(this, e[r].head));
                    null == t && (t = Math.min(e.length - 1, this.sel.primIndex)),
                    je(this, He(i, t), n);
                }
            }),
            addSelection: Yt(function(e, t, n) {
                var r = this.sel.ranges.slice(0);
                r.push(new Fe(Ie(this, e),Ie(this, t || e))),
                je(this, He(r, r.length - 1), n);
            }),
            getSelection: function(e) {
                for (var t, n = this.sel.ranges, r = 0; r < n.length; r++) {
                    var i = wi(this, n[r].from(), n[r].to());
                    t = t ? t.concat(i) : i;
                }
                return !1 === e ? t : t.join(e || this.lineSeparator());
            },
            getSelections: function(e) {
                for (var t = [], n = this.sel.ranges, r = 0; r < n.length; r++) {
                    var i = wi(this, n[r].from(), n[r].to());
                    !1 !== e && (i = i.join(e || this.lineSeparator())),
                    t[r] = i;
                }
                return t;
            },
            replaceSelection: function(e, t, n) {
                for (var r = [], i = 0; i < this.sel.ranges.length; i++)
                    r[i] = e;
                this.replaceSelections(r, t, n || "+input");
            },
            replaceSelections: Yt(function(e, t, n) {
                for (var r = [], i = this.sel, o = 0; o < i.ranges.length; o++) {
                    var l = i.ranges[o];
                    r[o] = {
                        from: l.from(),
                        to: l.to(),
                        text: this.splitLines(e[o]),
                        origin: n
                    };
                }
                var s = t && "end" != t && function(e, t, n) {
                    for (var r = [], i = he(e.first, 0), o = i, l = 0; l < t.length; l++) {
                        var s = t[l]
                          , a = Dn(s.from, i, o)
                          , c = Dn(Wn(s), i, o);
                        if (i = s.to,
                        o = c,
                        "around" == n) {
                            var u = e.sel.ranges[l]
                              , f = de(u.head, u.anchor) < 0;
                            r[l] = new Fe(f ? c : a,f ? a : c);
                        } else
                            r[l] = new Fe(a,a);
                    }
                    return new We(r,e.sel.primIndex);
                }(this, r, t);
                for (o = r.length - 1; 0 <= o; o--)
                    In(this, r[o]);
                s ? Ve(this, s) : this.cm && Vn(this.cm);
            }),
            undo: Yt(function() {
                zn(this, "undo");
            }),
            redo: Yt(function() {
                zn(this, "redo");
            }),
            undoSelection: Yt(function() {
                zn(this, "undo", !0);
            }),
            redoSelection: Yt(function() {
                zn(this, "redo", !0);
            }),
            setExtending: function(e) {
                this.extend = e;
            },
            getExtending: function() {
                return this.extend;
            },
            historySize: function() {
                for (var e = this.history, t = 0, n = 0, r = 0; r < e.done.length; r++)
                    e.done[r].ranges || ++t;
                for (r = 0; r < e.undone.length; r++)
                    e.undone[r].ranges || ++n;
                return {
                    undo: t,
                    redo: n
                };
            },
            clearHistory: function() {
                this.history = new Ti(this.history.maxGeneration);
            },
            markClean: function() {
                this.cleanGeneration = this.changeGeneration(!0);
            },
            changeGeneration: function(e) {
                return e && (this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null),
                this.history.generation;
            },
            isClean: function(e) {
                return this.history.generation == (e || this.cleanGeneration);
            },
            getHistory: function() {
                return {
                    done: Di(this.history.done),
                    undone: Di(this.history.undone)
                };
            },
            setHistory: function(e) {
                var t = this.history = new Ti(this.history.maxGeneration);
                t.done = Di(e.done.slice(0), null, !0),
                t.undone = Di(e.undone.slice(0), null, !0);
            },
            addLineClass: Yt(function(e, n, r) {
                return qn(this, e, "gutter" == n ? "gutter" : "class", function(e) {
                    var t = "text" == n ? "textClass" : "background" == n ? "bgClass" : "gutter" == n ? "gutterClass" : "wrapClass";
                    if (e[t]) {
                        if (Ho(r).test(e[t]))
                            return !1;
                        e[t] += " " + r;
                    } else
                        e[t] = r;
                    return !0;
                });
            }),
            removeLineClass: Yt(function(e, o, l) {
                return qn(this, e, "gutter" == o ? "gutter" : "class", function(e) {
                    var t = "text" == o ? "textClass" : "background" == o ? "bgClass" : "gutter" == o ? "gutterClass" : "wrapClass"
                      , n = e[t];
                    if (!n)
                        return !1;
                    if (null == l)
                        e[t] = null;
                    else {
                        var r = n.match(Ho(l));
                        if (!r)
                            return !1;
                        var i = r.index + r[0].length;
                        e[t] = n.slice(0, r.index) + (r.index && i != n.length ? " " : "") + n.slice(i) || null;
                    }
                    return !0;
                });
            }),
            addLineWidget: Yt(function(e, t, n) {
                return i = e,
                o = new Gr(r = this,t,n),
                (l = r.cm) && o.noHScroll && (l.display.alignWidgets = !0),
                qn(r, i, "widget", function(e) {
                    var t = e.widgets || (e.widgets = []);
                    if (null == o.insertAt ? t.push(o) : t.splice(Math.min(t.length - 1, Math.max(0, o.insertAt)), 0, o),
                    o.line = e,
                    l && !Br(r, e)) {
                        var n = Li(e) < r.scrollTop;
                        Ci(e, e.height + Vr(o)),
                        n && Kn(l, null, o.height),
                        l.curOp.forceUpdate = !0;
                    }
                    return !0;
                }),
                o;
                var r, i, o, l;
            }),
            removeLineWidget: function(e) {
                e.clear();
            },
            markText: function(e, t, n) {
                return yr(this, Ie(this, e), Ie(this, t), n, n && n.type || "range");
            },
            setBookmark: function(e, t) {
                var n = {
                    replacedWith: t && (null == t.nodeType ? t.widget : t),
                    insertLeft: t && t.insertLeft,
                    clearWhenEmpty: !1,
                    shared: t && t.shared,
                    handleMouseEvents: t && t.handleMouseEvents
                };
                return yr(this, e = Ie(this, e), e, n, "bookmark");
            },
            findMarksAt: function(e) {
                var t = []
                  , n = bi(this, (e = Ie(this, e)).line).markedSpans;
                if (n)
                    for (var r = 0; r < n.length; ++r) {
                        var i = n[r];
                        (null == i.from || i.from <= e.ch) && (null == i.to || i.to >= e.ch) && t.push(i.marker.parent || i.marker);
                    }
                return t;
            },
            findMarks: function(i, o, l) {
                i = Ie(this, i),
                o = Ie(this, o);
                var s = []
                  , a = i.line;
                return this.iter(i.line, o.line + 1, function(e) {
                    var t = e.markedSpans;
                    if (t)
                        for (var n = 0; n < t.length; n++) {
                            var r = t[n];
                            null != r.to && a == i.line && i.ch > r.to || null == r.from && a != i.line || null != r.from && a == o.line && r.from > o.ch || l && !l(r.marker) || s.push(r.marker.parent || r.marker);
                        }
                    ++a;
                }),
                s;
            },
            getAllMarks: function() {
                var r = [];
                return this.iter(function(e) {
                    var t = e.markedSpans;
                    if (t)
                        for (var n = 0; n < t.length; ++n)
                            null != t[n].from && r.push(t[n].marker);
                }),
                r;
            },
            posFromIndex: function(n) {
                var r, i = this.first;
                return this.iter(function(e) {
                    var t = e.text.length + 1;
                    if (n < t)
                        return r = n,
                        !0;
                    n -= t,
                    ++i;
                }),
                Ie(this, he(i, r));
            },
            indexFromPos: function(e) {
                var t = (e = Ie(this, e)).ch;
                return e.line < this.first || e.ch < 0 ? 0 : (this.iter(this.first, e.line, function(e) {
                    t += e.text.length + 1;
                }),
                t);
            },
            copy: function(e) {
                var t = new pi(xi(this, this.first, this.first + this.size),this.modeOption,this.first,this.lineSep);
                return t.scrollTop = this.scrollTop,
                t.scrollLeft = this.scrollLeft,
                t.sel = this.sel,
                t.extend = !1,
                e && (t.history.undoDepth = this.history.undoDepth,
                t.setHistory(this.getHistory())),
                t;
            },
            linkedDoc: function(e) {
                e || (e = {});
                var t = this.first
                  , n = this.first + this.size;
                null != e.from && e.from > t && (t = e.from),
                null != e.to && e.to < n && (n = e.to);
                var r = new pi(xi(this, t, n),e.mode || this.modeOption,t,this.lineSep);
                return e.sharedHist && (r.history = this.history),
                (this.linked || (this.linked = [])).push({
                    doc: r,
                    sharedHist: e.sharedHist
                }),
                r.linked = [{
                    doc: this,
                    isParent: !0,
                    sharedHist: e.sharedHist
                }],
                function(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var r = t[n]
                          , i = r.find()
                          , o = e.clipPos(i.from)
                          , l = e.clipPos(i.to);
                        if (de(o, l)) {
                            var s = yr(e, o, l, r.primary, r.primary.type);
                            r.markers.push(s),
                            s.parent = r;
                        }
                    }
                }(r, wr(this)),
                r;
            },
            unlinkDoc: function(e) {
                if (e instanceof S && (e = e.doc),
                this.linked)
                    for (var t = 0; t < this.linked.length; ++t) {
                        if (this.linked[t].doc == e) {
                            this.linked.splice(t, 1),
                            e.unlinkDoc(this),
                            xr(wr(this));
                            break;
                        }
                    }
                if (e.history == this.history) {
                    var n = [e.id];
                    vi(e, function(e) {
                        n.push(e.id);
                    }, !0),
                    e.history = new Ti(null),
                    e.history.done = Di(this.history.done, n),
                    e.history.undone = Di(this.history.undone, n);
                }
            },
            iterLinkedDocs: function(e) {
                vi(this, e);
            },
            getMode: function() {
                return this.mode;
            },
            getEditor: function() {
                return this.cm;
            },
            splitLines: function(e) {
                return this.lineSep ? e.split(this.lineSep) : jo(e);
            },
            lineSeparator: function() {
                return this.lineSep || "\n";
            }
        }),
        pi.prototype.eachLine = pi.prototype.iter;
        var gi = "iter insert remove copy getEditor constructor".split(" ");
        for (var mi in pi.prototype)
            pi.prototype.hasOwnProperty(mi) && go(gi, mi) < 0 && (S.prototype[mi] = function(e) {
                return function() {
                    return e.apply(this.doc, arguments);
                }
                ;
            }(pi.prototype[mi]));
        function vi(e, s, a) {
            !function e(t, n, r) {
                if (t.linked)
                    for (var i = 0; i < t.linked.length; ++i) {
                        var o = t.linked[i];
                        if (o.doc != n) {
                            var l = r && o.sharedHist;
                            a && !l || (s(o.doc, l),
                            e(o.doc, t, l));
                        }
                    }
            }(e, null, !0);
        }
        function yi(e, t) {
            if (t.cm)
                throw new Error("This document is already in use.");
            N((e.doc = t).cm = e),
            L(e),
            e.options.lineWrapping || D(e),
            e.options.mode = t.modeOption,
            Qt(e);
        }
        function bi(e, t) {
            if ((t -= e.first) < 0 || t >= e.size)
                throw new Error("There is no line " + (t + e.first) + " in the document.");
            for (var n = e; !n.lines; )
                for (var r = 0; ; ++r) {
                    var i = n.children[r]
                      , o = i.chunkSize();
                    if (t < o) {
                        n = i;
                        break;
                    }
                    t -= o;
                }
            return n.lines[t];
        }
        function wi(e, n, r) {
            var i = []
              , o = n.line;
            return e.iter(n.line, r.line + 1, function(e) {
                var t = e.text;
                o == r.line && (t = t.slice(0, r.ch)),
                o == n.line && (t = t.slice(n.ch)),
                i.push(t),
                ++o;
            }),
            i;
        }
        function xi(e, t, n) {
            var r = [];
            return e.iter(t, n, function(e) {
                r.push(e.text);
            }),
            r;
        }
        function Ci(e, t) {
            var n = t - e.height;
            if (n)
                for (var r = e; r; r = r.parent)
                    r.height += n;
        }
        function Si(e) {
            if (null == e.parent)
                return null;
            for (var t = e.parent, n = go(t.lines, e), r = t.parent; r; r = (t = r).parent)
                for (var i = 0; r.children[i] != t; ++i)
                    n += r.children[i].chunkSize();
            return n + t.first;
        }
        function ki(e, t) {
            var n = e.first;
            e: do {
                for (var r = 0; r < e.children.length; ++r) {
                    var i = e.children[r]
                      , o = i.height;
                    if (t < o) {
                        e = i;
                        continue e;
                    }
                    t -= o,
                    n += i.chunkSize();
                }
                return n;
            } while (!e.lines);for (r = 0; r < e.lines.length; ++r) {
                var l = e.lines[r].height;
                if (t < l)
                    break;
                t -= l;
            }
            return n + r;
        }
        function Li(e) {
            for (var t = 0, n = (e = Er(e)).parent, r = 0; r < n.lines.length; ++r) {
                var i = n.lines[r];
                if (i == e)
                    break;
                t += i.height;
            }
            for (var o = n.parent; o; o = (n = o).parent)
                for (r = 0; r < o.children.length; ++r) {
                    var l = o.children[r];
                    if (l == n)
                        break;
                    t += l.height;
                }
            return t;
        }
        function Mi(e) {
            var t = e.order;
            return null == t && (t = e.order = sl(e.text)),
            t;
        }
        function Ti(e) {
            this.done = [],
            this.undone = [],
            this.undoDepth = 1 / 0,
            this.lastModTime = this.lastSelTime = 0,
            this.lastOp = this.lastSelOp = null,
            this.lastOrigin = this.lastSelOrigin = null,
            this.generation = this.maxGeneration = e || 1;
        }
        function Ni(e, t) {
            var n = {
                from: pe(t.from),
                to: Wn(t),
                text: wi(e, t.from, t.to)
            };
            return Fi(e, n, t.from.line, t.to.line + 1),
            vi(e, function(e) {
                Fi(e, n, t.from.line, t.to.line + 1);
            }, !0),
            n;
        }
        function Oi(e) {
            for (; e.length; ) {
                if (!ho(e).ranges)
                    break;
                e.pop();
            }
        }
        function Ai(e, t, n, r) {
            var i = e.history;
            i.undone.length = 0;
            var o, l, s = +new Date();
            if ((i.lastOp == r || i.lastOrigin == t.origin && t.origin && ("+" == t.origin.charAt(0) && e.cm && i.lastModTime > s - e.cm.options.historyEventDelay || "*" == t.origin.charAt(0))) && (o = (l = i).lastOp == r ? (Oi(l.done),
            ho(l.done)) : l.done.length && !ho(l.done).ranges ? ho(l.done) : 1 < l.done.length && !l.done[l.done.length - 2].ranges ? (l.done.pop(),
            ho(l.done)) : void 0)) {
                var a = ho(o.changes);
                0 == de(t.from, t.to) && 0 == de(t.from, a.to) ? a.to = Wn(t) : o.changes.push(Ni(e, t));
            } else {
                var c = ho(i.done);
                for (c && c.ranges || Wi(e.sel, i.done),
                o = {
                    changes: [Ni(e, t)],
                    generation: i.generation
                },
                i.done.push(o); i.done.length > i.undoDepth; )
                    i.done.shift(),
                    i.done[0].ranges || i.done.shift();
            }
            i.done.push(n),
            i.generation = ++i.maxGeneration,
            i.lastModTime = i.lastSelTime = s,
            i.lastOp = i.lastSelOp = r,
            i.lastOrigin = i.lastSelOrigin = t.origin,
            a || Xi(e, "historyAdded");
        }
        function Wi(e, t) {
            var n = ho(t);
            n && n.ranges && n.equals(e) || t.push(e);
        }
        function Fi(t, n, e, r) {
            var i = n["spans_" + t.id]
              , o = 0;
            t.iter(Math.max(t.first, e), Math.min(t.first + t.size, r), function(e) {
                e.markedSpans && ((i || (i = n["spans_" + t.id] = {}))[o] = e.markedSpans),
                ++o;
            });
        }
        function Hi(e) {
            if (!e)
                return null;
            for (var t, n = 0; n < e.length; ++n)
                e[n].marker.explicitlyCleared ? t || (t = e.slice(0, n)) : t && t.push(e[n]);
            return t ? t.length ? t : null : e;
        }
        function Di(e, t, n) {
            for (var r = 0, i = []; r < e.length; ++r) {
                var o = e[r];
                if (o.ranges)
                    i.push(n ? We.prototype.deepCopy.call(o) : o);
                else {
                    var l = o.changes
                      , s = [];
                    i.push({
                        changes: s
                    });
                    for (var a = 0; a < l.length; ++a) {
                        var c, u = l[a];
                        if (s.push({
                            from: u.from,
                            to: u.to,
                            text: u.text
                        }),
                        t)
                            for (var f in u)
                                (c = f.match(/^spans_(\d+)$/)) && -1 < go(t, Number(c[1])) && (ho(s)[f] = u[f],
                                delete u[f]);
                    }
                }
            }
            return i;
        }
        function Pi(e, t, n, r) {
            n < e.line ? e.line += r : t < e.line && (e.line = t,
            e.ch = 0);
        }
        function Ii(e, t, n, r) {
            for (var i = 0; i < e.length; ++i) {
                var o = e[i]
                  , l = !0;
                if (o.ranges) {
                    o.copied || ((o = e[i] = o.deepCopy()).copied = !0);
                    for (var s = 0; s < o.ranges.length; s++)
                        Pi(o.ranges[s].anchor, t, n, r),
                        Pi(o.ranges[s].head, t, n, r);
                } else {
                    for (s = 0; s < o.changes.length; ++s) {
                        var a = o.changes[s];
                        if (n < a.from.line)
                            a.from = he(a.from.line + r, a.from.ch),
                            a.to = he(a.to.line + r, a.to.ch);
                        else if (t <= a.to.line) {
                            l = !1;
                            break;
                        }
                    }
                    l || (e.splice(0, i + 1),
                    i = 0);
                }
            }
        }
        function Ei(e, t) {
            var n = t.from.line
              , r = t.to.line
              , i = t.text.length - (r - n) - 1;
            Ii(e.done, n, r, i),
            Ii(e.undone, n, r, i);
        }
        to(pi);
        var zi = S.e_preventDefault = function(e) {
            e.preventDefault ? e.preventDefault() : e.returnValue = !1;
        }
          , Ri = S.e_stopPropagation = function(e) {
            e.stopPropagation ? e.stopPropagation() : e.cancelBubble = !0;
        }
        ;
        function Bi(e) {
            return null != e.defaultPrevented ? e.defaultPrevented : 0 == e.returnValue;
        }
        var Ui = S.e_stop = function(e) {
            zi(e),
            Ri(e);
        }
        ;
        function Gi(e) {
            return e.target || e.srcElement;
        }
        function Ki(e) {
            var t = e.which;
            return null == t && (1 & e.button ? t = 1 : 2 & e.button ? t = 3 : 4 & e.button && (t = 2)),
            y && e.ctrlKey && 1 == t && (t = 3),
            t;
        }
        var Vi = S.on = function(e, t, n) {
            if (e.addEventListener)
                e.addEventListener(t, n, !1);
            else if (e.attachEvent)
                e.attachEvent("on" + t, n);
            else {
                var r = e._handlers || (e._handlers = {});
                (r[t] || (r[t] = [])).push(n);
            }
        }
          , ji = [];
        function _i(e, t, n) {
            var r = e._handlers && e._handlers[t];
            return n ? r && 0 < r.length ? r.slice() : ji : r || ji;
        }
        var qi = S.off = function(e, t, n) {
            if (e.removeEventListener)
                e.removeEventListener(t, n, !1);
            else if (e.detachEvent)
                e.detachEvent("on" + t, n);
            else
                for (var r = _i(e, t, !1), i = 0; i < r.length; ++i)
                    if (r[i] == n) {
                        r.splice(i, 1);
                        break;
                    }
        }
          , Xi = S.signal = function(e, t) {
            var n = _i(e, t, !0);
            if (n.length)
                for (var r = Array.prototype.slice.call(arguments, 2), i = 0; i < n.length; ++i)
                    n[i].apply(null, r);
        }
          , Yi = null;
        function $i(e, t) {
            var n = _i(e, t, !1);
            if (n.length) {
                var r, i = Array.prototype.slice.call(arguments, 2);
                zt ? r = zt.delayedCallbacks : Yi ? r = Yi : (r = Yi = [],
                setTimeout(Zi, 0));
                for (var o = 0; o < n.length; ++o)
                    r.push(l(n[o]));
            }
            function l(e) {
                return function() {
                    e.apply(null, i);
                }
                ;
            }
        }
        function Zi() {
            var e = Yi;
            Yi = null;
            for (var t = 0; t < e.length; ++t)
                e[t]();
        }
        function Qi(e, t, n) {
            return "string" == typeof t && (t = {
                type: t,
                preventDefault: function() {
                    this.defaultPrevented = !0;
                }
            }),
            Xi(e, n || t.type, e, t),
            Bi(t) || t.codemirrorIgnore;
        }
        function Ji(e) {
            var t = e._handlers && e._handlers.cursorActivity;
            if (t)
                for (var n = e.curOp.cursorActivityHandlers || (e.curOp.cursorActivityHandlers = []), r = 0; r < t.length; ++r)
                    -1 == go(n, t[r]) && n.push(t[r]);
        }
        function eo(e, t) {
            return 0 < _i(e, t).length;
        }
        function to(e) {
            e.prototype.on = function(e, t) {
                Vi(this, e, t);
            }
            ,
            e.prototype.off = function(e, t) {
                qi(this, e, t);
            }
            ;
        }
        var no = 30
          , ro = S.Pass = {
            toString: function() {
                return "CodeMirror.Pass";
            }
        }
          , io = {
            scroll: !1
        }
          , oo = {
            origin: "*mouse"
        }
          , lo = {
            origin: "+move"
        };
        function so() {
            this.id = null;
        }
        so.prototype.set = function(e, t) {
            clearTimeout(this.id),
            this.id = setTimeout(t, e);
        }
        ;
        var ao = S.countColumn = function(e, t, n, r, i) {
            null == t && -1 == (t = e.search(/[^\s\u00a0]/)) && (t = e.length);
            for (var o = r || 0, l = i || 0; ; ) {
                var s = e.indexOf("\t", o);
                if (s < 0 || t <= s)
                    return l + (t - o);
                l += s - o,
                l += n - l % n,
                o = s + 1;
            }
        }
          , co = S.findColumn = function(e, t, n) {
            for (var r = 0, i = 0; ; ) {
                var o = e.indexOf("\t", r);
                -1 == o && (o = e.length);
                var l = o - r;
                if (o == e.length || t <= i + l)
                    return r + Math.min(l, t - i);
                if (i += o - r,
                r = o + 1,
                t <= (i += n - i % n))
                    return r;
            }
        }
          , uo = [""];
        function fo(e) {
            for (; uo.length <= e; )
                uo.push(ho(uo) + " ");
            return uo[e];
        }
        function ho(e) {
            return e[e.length - 1];
        }
        var po = function(e) {
            e.select();
        };
        function go(e, t) {
            for (var n = 0; n < e.length; ++n)
                if (e[n] == t)
                    return n;
            return -1;
        }
        function mo(e, t) {
            for (var n = [], r = 0; r < e.length; r++)
                n[r] = t(e[r], r);
            return n;
        }
        function vo() {}
        function yo(e, t) {
            var n;
            return Object.create ? n = Object.create(e) : (vo.prototype = e,
            n = new vo()),
            t && bo(t, n),
            n;
        }
        function bo(e, t, n) {
            for (var r in t || (t = {}),
            e)
                !e.hasOwnProperty(r) || !1 === n && t.hasOwnProperty(r) || (t[r] = e[r]);
            return t;
        }
        function wo(e) {
            var t = Array.prototype.slice.call(arguments, 1);
            return function() {
                return e.apply(null, t);
            }
            ;
        }
        s ? po = function(e) {
            e.selectionStart = 0,
            e.selectionEnd = e.value.length;
        }
        : w && (po = function(e) {
            try {
                e.select();
            } catch (e) {}
        }
        );
        var xo = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/
          , Co = S.isWordChar = function(e) {
            return /\w/.test(e) || "\x80" < e && (e.toUpperCase() != e.toLowerCase() || xo.test(e));
        }
        ;
        function So(e, t) {
            return t ? !!(-1 < t.source.indexOf("\\w") && Co(e)) || t.test(e) : Co(e);
        }
        function ko(e) {
            for (var t in e)
                if (e.hasOwnProperty(t) && e[t])
                    return !1;
            return !0;
        }
        var Lo, Mo = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
        function To(e) {
            return 768 <= e.charCodeAt(0) && Mo.test(e);
        }
        function No(e, t, n, r) {
            var i = document.createElement(e);
            if (n && (i.className = n),
            r && (i.style.cssText = r),
            "string" == typeof t)
                i.appendChild(document.createTextNode(t));
            else if (t)
                for (var o = 0; o < t.length; ++o)
                    i.appendChild(t[o]);
            return i;
        }
        function Oo(e) {
            for (var t = e.childNodes.length; 0 < t; --t)
                e.removeChild(e.firstChild);
            return e;
        }
        function Ao(e, t) {
            return Oo(e).appendChild(t);
        }
        Lo = document.createRange ? function(e, t, n, r) {
            var i = document.createRange();
            return i.setEnd(r || e, n),
            i.setStart(e, t),
            i;
        }
        : function(e, t, n) {
            var r = document.body.createTextRange();
            try {
                r.moveToElementText(e.parentNode);
            } catch (e) {
                return r;
            }
            return r.collapse(!0),
            r.moveEnd("character", n),
            r.moveStart("character", t),
            r;
        }
        ;
        var Wo = S.contains = function(e, t) {
            if (3 == t.nodeType && (t = t.parentNode),
            e.contains)
                return e.contains(t);
            do {
                if (11 == t.nodeType && (t = t.host),
                t == e)
                    return !0;
            } while (t = t.parentNode);
        }
        ;
        function Fo() {
            for (var e = document.activeElement; e && e.root && e.root.activeElement; )
                e = e.root.activeElement;
            return e;
        }
        function Ho(e) {
            return new RegExp("(^|\\s)" + e + "(?:$|\\s)\\s*");
        }
        w && x < 11 && (Fo = function() {
            try {
                return document.activeElement;
            } catch (e) {
                return document.body;
            }
        }
        );
        var Do = S.rmClass = function(e, t) {
            var n = e.className
              , r = Ho(t).exec(n);
            if (r) {
                var i = n.slice(r.index + r[0].length);
                e.className = n.slice(0, r.index) + (i ? r[1] + i : "");
            }
        }
          , Po = S.addClass = function(e, t) {
            var n = e.className;
            Ho(t).test(n) || (e.className += (n ? " " : "") + t);
        }
        ;
        function Io(e, t) {
            for (var n = e.split(" "), r = 0; r < n.length; r++)
                n[r] && !Ho(n[r]).test(t) && (t += " " + n[r]);
            return t;
        }
        function Eo(e) {
            if (document.body.getElementsByClassName)
                for (var t = document.body.getElementsByClassName("CodeMirror"), n = 0; n < t.length; n++) {
                    var r = t[n].CodeMirror;
                    r && e(r);
                }
        }
        var zo = !1;
        var Ro, Bo, Uo = function() {
            if (w && x < 9)
                return !1;
            var e = No("div");
            return "draggable"in e || "dragDrop"in e;
        }();
        function Go(e) {
            if (null == Ro) {
                var t = No("span", "\u200b");
                Ao(e, No("span", [t, document.createTextNode("x")])),
                0 != e.firstChild.offsetHeight && (Ro = t.offsetWidth <= 1 && 2 < t.offsetHeight && !(w && x < 8));
            }
            var n = Ro ? No("span", "\u200b") : No("span", "\xa0", null, "display: inline-block; width: 1px; margin-right: -1px");
            return n.setAttribute("cm-text", ""),
            n;
        }
        function Ko(e) {
            if (null != Bo)
                return Bo;
            var t = Ao(e, document.createTextNode("A\u062eA"))
              , n = Lo(t, 0, 1).getBoundingClientRect();
            if (!n || n.left == n.right)
                return !1;
            var r = Lo(t, 1, 2).getBoundingClientRect();
            return Bo = r.right - n.right < 3;
        }
        var Vo, jo = S.splitLines = 3 != "\n\nb".split(/\n/).length ? function(e) {
            for (var t = 0, n = [], r = e.length; t <= r; ) {
                var i = e.indexOf("\n", t);
                -1 == i && (i = e.length);
                var o = e.slice(t, "\r" == e.charAt(i - 1) ? i - 1 : i)
                  , l = o.indexOf("\r");
                -1 != l ? (n.push(o.slice(0, l)),
                t += l + 1) : (n.push(o),
                t = i + 1);
            }
            return n;
        }
        : function(e) {
            return e.split(/\r\n?|\n/);
        }
        , _o = window.getSelection ? function(e) {
            try {
                return e.selectionStart != e.selectionEnd;
            } catch (e) {
                return !1;
            }
        }
        : function(e) {
            try {
                var t = e.ownerDocument.selection.createRange();
            } catch (e) {}
            return !(!t || t.parentElement() != e) && 0 != t.compareEndPoints("StartToEnd", t);
        }
        , qo = "oncopy"in (Vo = No("div")) || (Vo.setAttribute("oncopy", "return;"),
        "function" == typeof Vo.oncopy), Xo = null;
        var Yo, $o = S.keyNames = {
            3: "Enter",
            8: "Backspace",
            9: "Tab",
            13: "Enter",
            16: "Shift",
            17: "Ctrl",
            18: "Alt",
            19: "Pause",
            20: "CapsLock",
            27: "Esc",
            32: "Space",
            33: "PageUp",
            34: "PageDown",
            35: "End",
            36: "Home",
            37: "Left",
            38: "Up",
            39: "Right",
            40: "Down",
            44: "PrintScrn",
            45: "Insert",
            46: "Delete",
            59: ";",
            61: "=",
            91: "Mod",
            92: "Mod",
            93: "Mod",
            106: "*",
            107: "=",
            109: "-",
            110: ".",
            111: "/",
            127: "Delete",
            173: "-",
            186: ";",
            187: "=",
            188: ",",
            189: "-",
            190: ".",
            191: "/",
            192: "`",
            219: "[",
            220: "\\",
            221: "]",
            222: "'",
            63232: "Up",
            63233: "Down",
            63234: "Left",
            63235: "Right",
            63272: "Delete",
            63273: "Home",
            63275: "End",
            63276: "PageUp",
            63277: "PageDown",
            63302: "Insert"
        };
        function Zo(e) {
            return e.level % 2 ? e.to : e.from;
        }
        function Qo(e) {
            return e.level % 2 ? e.from : e.to;
        }
        function Jo(e) {
            var t = Mi(e);
            return t ? Zo(t[0]) : 0;
        }
        function el(e) {
            var t = Mi(e);
            return t ? Qo(ho(t)) : e.text.length;
        }
        function tl(e, t) {
            var n = bi(e.doc, t)
              , r = Er(n);
            r != n && (t = Si(r));
            var i = Mi(r)
              , o = i ? i[0].level % 2 ? el(r) : Jo(r) : 0;
            return he(t, o);
        }
        function nl(e, t) {
            var n = tl(e, t.line)
              , r = bi(e.doc, n.line)
              , i = Mi(r);
            if (!i || 0 == i[0].level) {
                var o = Math.max(0, r.text.search(/\S/))
                  , l = t.line == n.line && t.ch <= o && t.ch;
                return he(n.line, l ? 0 : o);
            }
            return n;
        }
        function rl(e, t) {
            Yo = null;
            for (var n, r = 0; r < e.length; ++r) {
                var i = e[r];
                if (i.from < t && i.to > t)
                    return r;
                if (i.from == t || i.to == t) {
                    if (null != n)
                        return o = e,
                        l = i.level,
                        s = e[n].level,
                        void 0,
                        a = o[0].level,
                        l == a || s != a && l < s ? (i.from != i.to && (Yo = n),
                        r) : (i.from != i.to && (Yo = r),
                        n);
                    n = r;
                }
            }
            var o, l, s, a;
            return n;
        }
        function il(e, t, n, r) {
            if (!r)
                return t + n;
            for (; 0 < (t += n) && To(e.text.charAt(t)); )
                ;
            return t;
        }
        function ol(e, t, n, r) {
            var i = Mi(e);
            if (!i)
                return ll(e, t, n, r);
            for (var o = rl(i, t), l = i[o], s = il(e, t, l.level % 2 ? -n : n, r); ; ) {
                if (s > l.from && s < l.to)
                    return s;
                if (s == l.from || s == l.to)
                    return rl(i, s) == o ? s : 0 < n == (l = i[o += n]).level % 2 ? l.to : l.from;
                if (!(l = i[o += n]))
                    return null;
                s = 0 < n == l.level % 2 ? il(e, l.to, -1, r) : il(e, l.from, 1, r);
            }
        }
        function ll(e, t, n, r) {
            var i = t + n;
            if (r)
                for (; 0 < i && To(e.text.charAt(i)); )
                    i += n;
            return i < 0 || i > e.text.length ? null : i;
        }
        !function() {
            for (var e = 0; e < 10; e++)
                $o[e + 48] = $o[e + 96] = String(e);
            for (e = 65; e <= 90; e++)
                $o[e] = String.fromCharCode(e);
            for (e = 1; e <= 12; e++)
                $o[e + 111] = $o[e + 63235] = "F" + e;
        }();
        var sl = function() {
            var b = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN"
              , w = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
            var x = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/
              , C = /[stwN]/
              , S = /[LRr]/
              , k = /[Lb1n]/
              , L = /[1n]/;
            function M(e, t, n) {
                this.level = e,
                this.from = t,
                this.to = n;
            }
            return function(e) {
                if (!x.test(e))
                    return !1;
                for (var t, n = e.length, r = [], i = 0; i < n; ++i)
                    r.push(u = (t = e.charCodeAt(i)) <= 247 ? b.charAt(t) : 1424 <= t && t <= 1524 ? "R" : 1536 <= t && t <= 1773 ? w.charAt(t - 1536) : 1774 <= t && t <= 2220 ? "r" : 8192 <= t && t <= 8203 ? "w" : 8204 == t ? "b" : "L");
                i = 0;
                for (var o = "L"; i < n; ++i) {
                    "m" == (u = r[i]) ? r[i] = o : o = u;
                }
                i = 0;
                for (var l = "L"; i < n; ++i) {
                    "1" == (u = r[i]) && "r" == l ? r[i] = "n" : S.test(u) && "r" == (l = u) && (r[i] = "R");
                }
                for (i = 1,
                o = r[0]; i < n - 1; ++i) {
                    "+" == (u = r[i]) && "1" == o && "1" == r[i + 1] ? r[i] = "1" : "," != u || o != r[i + 1] || "1" != o && "n" != o || (r[i] = o),
                    o = u;
                }
                for (i = 0; i < n; ++i) {
                    if ("," == (u = r[i]))
                        r[i] = "N";
                    else if ("%" == u) {
                        for (var s = i + 1; s < n && "%" == r[s]; ++s)
                            ;
                        for (var a = i && "!" == r[i - 1] || s < n && "1" == r[s] ? "1" : "N", c = i; c < s; ++c)
                            r[c] = a;
                        i = s - 1;
                    }
                }
                for (i = 0,
                l = "L"; i < n; ++i) {
                    var u = r[i];
                    "L" == l && "1" == u ? r[i] = "L" : S.test(u) && (l = u);
                }
                for (i = 0; i < n; ++i)
                    if (C.test(r[i])) {
                        for (s = i + 1; s < n && C.test(r[s]); ++s)
                            ;
                        var f = "L" == (i ? r[i - 1] : "L")
                          , h = "L" == (s < n ? r[s] : "L");
                        for (a = f || h ? "L" : "R",
                        c = i; c < s; ++c)
                            r[c] = a;
                        i = s - 1;
                    }
                var d, p = [];
                for (i = 0; i < n; )
                    if (k.test(r[i])) {
                        var g = i;
                        for (++i; i < n && k.test(r[i]); ++i)
                            ;
                        p.push(new M(0,g,i));
                    } else {
                        var m = i
                          , v = p.length;
                        for (++i; i < n && "L" != r[i]; ++i)
                            ;
                        for (c = m; c < i; )
                            if (L.test(r[c])) {
                                m < c && p.splice(v, 0, new M(1,m,c));
                                var y = c;
                                for (++c; c < i && L.test(r[c]); ++c)
                                    ;
                                p.splice(v, 0, new M(2,y,c)),
                                m = c;
                            } else
                                ++c;
                        m < i && p.splice(v, 0, new M(1,m,i));
                    }
                return 1 == p[0].level && (d = e.match(/^\s+/)) && (p[0].from = d[0].length,
                p.unshift(new M(0,0,d[0].length))),
                1 == ho(p).level && (d = e.match(/\s+$/)) && (ho(p).to -= d[0].length,
                p.push(new M(0,n - d[0].length,n))),
                2 == p[0].level && p.unshift(new M(1,p[0].to,p[0].to)),
                p[0].level != ho(p).level && p.push(new M(p[0].level,n,n)),
                p;
            }
            ;
        }();
        return S.version = "5.13.4",
        S;
    }),
    function(i) {
        "use strict";
        var d = i.Pos;
        function r(c, a, e, t) {
            if (this.atOccurrence = !1,
            this.doc = c,
            null == t && "string" == typeof a && (t = !1),
            e = e ? c.clipPos(e) : d(0, 0),
            this.pos = {
                from: e,
                to: e
            },
            "string" != typeof a)
                a.global || (a = new RegExp(a.source,a.ignoreCase ? "ig" : "g")),
                this.matches = function(e, t) {
                    if (e) {
                        a.lastIndex = 0;
                        for (var n = c.getLine(t.line).slice(0, t.ch), r = 0; ; ) {
                            a.lastIndex = r;
                            var i = a.exec(n);
                            if (!i)
                                break;
                            if (l = (o = i).index,
                            (r = o.index + (o[0].length || 1)) == n.length)
                                break;
                        }
                        (s = o && o[0].length || 0) || (0 == l && 0 == n.length ? o = void 0 : l != c.getLine(t.line).length && s++);
                    } else {
                        a.lastIndex = t.ch;
                        n = c.getLine(t.line);
                        var o, l, s = (o = a.exec(n)) && o[0].length || 0;
                        (l = o && o.index) + s == n.length || s || (s = 1);
                    }
                    if (o && s)
                        return {
                            from: d(t.line, l),
                            to: d(t.line, l + s),
                            match: o
                        };
                }
                ;
            else {
                var o = a;
                t && (a = a.toLowerCase());
                var u = t ? function(e) {
                    return e.toLowerCase();
                }
                : function(e) {
                    return e;
                }
                  , f = a.split("\n");
                if (1 == f.length)
                    a.length ? this.matches = function(e, t) {
                        if (e) {
                            var n = c.getLine(t.line).slice(0, t.ch);
                            if (-1 < (i = (r = u(n)).lastIndexOf(a)))
                                return i = l(n, r, i),
                                {
                                    from: d(t.line, i),
                                    to: d(t.line, i + o.length)
                                };
                        } else {
                            var r, i;
                            n = c.getLine(t.line).slice(t.ch);
                            if (-1 < (i = (r = u(n)).indexOf(a)))
                                return i = l(n, r, i) + t.ch,
                                {
                                    from: d(t.line, i),
                                    to: d(t.line, i + o.length)
                                };
                        }
                    }
                    : this.matches = function() {}
                    ;
                else {
                    var h = o.split("\n");
                    this.matches = function(e, t) {
                        var n = f.length - 1;
                        if (e) {
                            if (t.line - (f.length - 1) < c.firstLine())
                                return;
                            if (u(c.getLine(t.line).slice(0, h[n].length)) != f[f.length - 1])
                                return;
                            for (var r = d(t.line, h[n].length), i = t.line - 1, o = n - 1; 1 <= o; --o,
                            --i)
                                if (f[o] != u(c.getLine(i)))
                                    return;
                            var l = (s = c.getLine(i)).length - h[0].length;
                            if (u(s.slice(l)) != f[0])
                                return;
                            return {
                                from: d(i, l),
                                to: r
                            };
                        }
                        if (!(t.line + (f.length - 1) > c.lastLine())) {
                            var s;
                            l = (s = c.getLine(t.line)).length - h[0].length;
                            if (u(s.slice(l)) == f[0]) {
                                var a = d(t.line, l);
                                for (i = t.line + 1,
                                o = 1; o < n; ++o,
                                ++i)
                                    if (f[o] != u(c.getLine(i)))
                                        return;
                                if (u(c.getLine(i).slice(0, h[n].length)) == f[n])
                                    return {
                                        from: a,
                                        to: d(i, h[n].length)
                                    };
                            }
                        }
                    }
                    ;
                }
            }
        }
        function l(e, t, n) {
            if (e.length == t.length)
                return n;
            for (var r = Math.min(n, e.length); ; ) {
                var i = e.slice(0, r).toLowerCase().length;
                if (i < n)
                    ++r;
                else {
                    if (!(n < i))
                        return r;
                    --r;
                }
            }
        }
        r.prototype = {
            findNext: function() {
                return this.find(!1);
            },
            findPrevious: function() {
                return this.find(!0);
            },
            find: function(e) {
                var n = this
                  , t = this.doc.clipPos(e ? this.pos.from : this.pos.to);
                function r(e) {
                    var t = d(e, 0);
                    return n.pos = {
                        from: t,
                        to: t
                    },
                    n.atOccurrence = !1;
                }
                for (; ; ) {
                    if (this.pos = this.matches(e, t))
                        return this.atOccurrence = !0,
                        this.pos.match || !0;
                    if (e) {
                        if (!t.line)
                            return r(0);
                        t = d(t.line - 1, this.doc.getLine(t.line - 1).length);
                    } else {
                        var i = this.doc.lineCount();
                        if (t.line == i - 1)
                            return r(i);
                        t = d(t.line + 1, 0);
                    }
                }
            },
            from: function() {
                if (this.atOccurrence)
                    return this.pos.from;
            },
            to: function() {
                if (this.atOccurrence)
                    return this.pos.to;
            },
            replace: function(e, t) {
                if (this.atOccurrence) {
                    var n = i.splitLines(e);
                    this.doc.replaceRange(n, this.pos.from, this.pos.to, t),
                    this.pos.to = d(this.pos.from.line + n.length - 1, n[n.length - 1].length + (1 == n.length ? this.pos.from.ch : 0));
                }
            }
        },
        i.defineExtension("getSearchCursor", function(e, t, n) {
            return new r(this.doc,e,t,n);
        }),
        i.defineDocExtension("getSearchCursor", function(e, t, n) {
            return new r(this,e,t,n);
        }),
        i.defineExtension("selectMatches", function(e, t) {
            for (var n = [], r = this.getSearchCursor(e, this.getCursor("from"), t); r.findNext() && !(0 < i.cmpPos(r.to(), this.getCursor("to"))); )
                n.push({
                    anchor: r.from(),
                    head: r.to()
                });
            n.length && this.setSelections(n, 0);
        });
    }(CodeMirror),
    function(u) {
        "use strict";
        function i(i, o, e, l) {
            if (e && e.call) {
                var s = e;
                e = null;
            } else
                s = f(i, e, "rangeFinder");
            "number" == typeof o && (o = u.Pos(o, 0));
            var a = f(i, e, "minFoldSize");
            function t(e) {
                var t = s(i, o);
                if (!t || t.to.line - t.from.line < a)
                    return null;
                for (var n = i.findMarksAt(t.from), r = 0; r < n.length; ++r)
                    if (n[r].__isFold && "fold" !== l) {
                        if (!e)
                            return null;
                        t.cleared = !0,
                        n[r].clear();
                    }
                return t;
            }
            var n = t(!0);
            if (f(i, e, "scanUp"))
                for (; !n && o.line > i.firstLine(); )
                    o = u.Pos(o.line - 1, 0),
                    n = t(!1);
            if (n && !n.cleared && "unfold" !== l) {
                var r = function(e, t) {
                    var n = f(e, t, "widget");
                    if ("string" == typeof n) {
                        var r = document.createTextNode(n);
                        (n = document.createElement("span")).appendChild(r),
                        n.className = "CodeMirror-foldmarker";
                    }
                    return n;
                }(i, e);
                u.on(r, "mousedown", function(e) {
                    c.clear(),
                    u.e_preventDefault(e);
                });
                var c = i.markText(n.from, n.to, {
                    replacedWith: r,
                    clearOnEnter: !0,
                    __isFold: !0
                });
                c.on("clear", function(e, t) {
                    u.signal(i, "unfold", i, e, t);
                }),
                u.signal(i, "fold", i, n.from, n.to);
            }
        }
        u.newFoldFunction = function(n, r) {
            return function(e, t) {
                i(e, t, {
                    rangeFinder: n,
                    widget: r
                });
            }
            ;
        }
        ,
        u.defineExtension("foldCode", function(e, t, n) {
            i(this, e, t, n);
        }),
        u.defineExtension("isFolded", function(e) {
            for (var t = this.findMarksAt(e), n = 0; n < t.length; ++n)
                if (t[n].__isFold)
                    return !0;
        }),
        u.commands.toggleFold = function(e) {
            e.foldCode(e.getCursor());
        }
        ,
        u.commands.fold = function(e) {
            e.foldCode(e.getCursor(), null, "fold");
        }
        ,
        u.commands.unfold = function(e) {
            e.foldCode(e.getCursor(), null, "unfold");
        }
        ,
        u.commands.foldAll = function(n) {
            n.operation(function() {
                for (var e = n.firstLine(), t = n.lastLine(); e <= t; e++)
                    n.foldCode(u.Pos(e, 0), null, "fold");
            });
        }
        ,
        u.commands.unfoldAll = function(n) {
            n.operation(function() {
                for (var e = n.firstLine(), t = n.lastLine(); e <= t; e++)
                    n.foldCode(u.Pos(e, 0), null, "unfold");
            });
        }
        ,
        u.registerHelper("fold", "combine", function() {
            var i = Array.prototype.slice.call(arguments, 0);
            return function(e, t) {
                for (var n = 0; n < i.length; ++n) {
                    var r = i[n](e, t);
                    if (r)
                        return r;
                }
            }
            ;
        }),
        u.registerHelper("fold", "auto", function(e, t) {
            for (var n = e.getHelpers(t, "fold"), r = 0; r < n.length; r++) {
                var i = n[r](e, t);
                if (i)
                    return i;
            }
        });
        var o = {
            rangeFinder: u.fold.auto,
            widget: "\u2194",
            minFoldSize: 0,
            scanUp: !1
        };
        function f(e, t, n) {
            if (t && void 0 !== t[n])
                return t[n];
            var r = e.options.foldOptions;
            return r && void 0 !== r[n] ? r[n] : o[n];
        }
        u.defineOption("foldOptions", null),
        u.defineExtension("foldOption", function(e, t) {
            return f(this, e, t);
        });
    }(CodeMirror),
    function(r) {
        "use strict";
        r.defineOption("foldGutter", !1, function(e, t, n) {
            n && n != r.Init && (e.clearGutter(e.state.foldGutter.options.gutter),
            e.state.foldGutter = null,
            e.off("gutterClick", s),
            e.off("change", a),
            e.off("viewportChange", h),
            e.off("fold", d),
            e.off("unfold", d),
            e.off("swapDoc", a)),
            t && (e.state.foldGutter = new i(function(e) {
                !0 === e && (e = {});
                null == e.gutter && (e.gutter = "CodeMirror-foldgutter");
                null == e.indicatorOpen && (e.indicatorOpen = "CodeMirror-foldgutter-open");
                null == e.indicatorFolded && (e.indicatorFolded = "CodeMirror-foldgutter-folded");
                return e;
            }(t)),
            l(e),
            e.on("gutterClick", s),
            e.on("change", a),
            e.on("viewportChange", h),
            e.on("fold", d),
            e.on("unfold", d),
            e.on("swapDoc", a));
        });
        var c = r.Pos;
        function i(e) {
            this.options = e,
            this.from = this.to = 0;
        }
        function u(e, t) {
            for (var n = e.findMarksAt(c(t)), r = 0; r < n.length; ++r)
                if (n[r].__isFold && n[r].find().from.line == t)
                    return n[r];
        }
        function f(e) {
            if ("string" == typeof e) {
                var t = document.createElement("div");
                return t.className = e + " CodeMirror-guttermarker-subtle",
                t;
            }
            return e.cloneNode(!0);
        }
        function o(i, e, t) {
            var o = i.state.foldGutter.options
              , l = e
              , s = i.foldOption(o, "minFoldSize")
              , a = i.foldOption(o, "rangeFinder");
            i.eachLine(e, t, function(e) {
                var t = null;
                if (u(i, l))
                    t = f(o.indicatorFolded);
                else {
                    var n = c(l, 0)
                      , r = a && a(i, n);
                    r && r.to.line - r.from.line >= s && (t = f(o.indicatorOpen));
                }
                i.setGutterMarker(e, o.gutter, t),
                ++l;
            });
        }
        function l(e) {
            var t = e.getViewport()
              , n = e.state.foldGutter;
            n && (e.operation(function() {
                o(e, t.from, t.to);
            }),
            n.from = t.from,
            n.to = t.to);
        }
        function s(e, t, n) {
            var r = e.state.foldGutter;
            if (r) {
                var i = r.options;
                if (n == i.gutter) {
                    var o = u(e, t);
                    o ? o.clear() : e.foldCode(c(t, 0), i.rangeFinder);
                }
            }
        }
        function a(e) {
            var t = e.state.foldGutter;
            if (t) {
                var n = t.options;
                t.from = t.to = 0,
                clearTimeout(t.changeUpdate),
                t.changeUpdate = setTimeout(function() {
                    l(e);
                }, n.foldOnChangeTimeSpan || 600);
            }
        }
        function h(t) {
            var n = t.state.foldGutter;
            if (n) {
                var e = n.options;
                clearTimeout(n.changeUpdate),
                n.changeUpdate = setTimeout(function() {
                    var e = t.getViewport();
                    n.from == n.to || 20 < e.from - n.to || 20 < n.from - e.to ? l(t) : t.operation(function() {
                        e.from < n.from && (o(t, e.from, n.from),
                        n.from = e.from),
                        e.to > n.to && (o(t, n.to, e.to),
                        n.to = e.to);
                    });
                }, e.updateViewportTimeSpan || 400);
            }
        }
        function d(e, t) {
            var n = e.state.foldGutter;
            if (n) {
                var r = t.line;
                r >= n.from && r < n.to && o(e, r, r + 1);
            }
        }
    }(CodeMirror),
    function(e) {
        "use strict";
        var u = e.Pos;
        var t = "A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD"
          , r = new RegExp("<(/?)([" + t + "][A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*)","g");
        function f(e, t, n, r) {
            this.line = t,
            this.ch = n,
            this.cm = e,
            this.text = e.getLine(t),
            this.min = r ? r.from : e.firstLine(),
            this.max = r ? r.to - 1 : e.lastLine();
        }
        function i(e, t) {
            var n = e.cm.getTokenTypeAt(u(e.line, t));
            return n && /\btag\b/.test(n);
        }
        function o(e) {
            if (!(e.line >= e.max))
                return e.ch = 0,
                e.text = e.cm.getLine(++e.line),
                !0;
        }
        function l(e) {
            if (!(e.line <= e.min))
                return e.text = e.cm.getLine(--e.line),
                e.ch = e.text.length,
                !0;
        }
        function h(e) {
            for (; ; ) {
                var t = e.text.indexOf(">", e.ch);
                if (-1 == t) {
                    if (o(e))
                        continue;
                    return;
                }
                if (i(e, t + 1)) {
                    var n = e.text.lastIndexOf("/", t)
                      , r = -1 < n && !/\S/.test(e.text.slice(n + 1, t));
                    return e.ch = t + 1,
                    r ? "selfClose" : "regular";
                }
                e.ch = t + 1;
            }
        }
        function d(e) {
            for (; ; ) {
                var t = e.ch ? e.text.lastIndexOf("<", e.ch - 1) : -1;
                if (-1 == t) {
                    if (l(e))
                        continue;
                    return;
                }
                if (i(e, t + 1)) {
                    r.lastIndex = t,
                    e.ch = t;
                    var n = r.exec(e.text);
                    if (n && n.index == t)
                        return n;
                } else
                    e.ch = t;
            }
        }
        function a(e) {
            for (; ; ) {
                r.lastIndex = e.ch;
                var t = r.exec(e.text);
                if (!t) {
                    if (o(e))
                        continue;
                    return;
                }
                if (i(e, t.index + 1))
                    return e.ch = t.index + t[0].length,
                    t;
                e.ch = t.index + 1;
            }
        }
        function c(e) {
            for (; ; ) {
                var t = e.ch ? e.text.lastIndexOf(">", e.ch - 1) : -1;
                if (-1 == t) {
                    if (l(e))
                        continue;
                    return;
                }
                if (i(e, t + 1)) {
                    var n = e.text.lastIndexOf("/", t)
                      , r = -1 < n && !/\S/.test(e.text.slice(n + 1, t));
                    return e.ch = t + 1,
                    r ? "selfClose" : "regular";
                }
                e.ch = t;
            }
        }
        function p(e, t) {
            for (var n = []; ; ) {
                var r, i = a(e), o = e.line, l = e.ch - (i ? i[0].length : 0);
                if (!i || !(r = h(e)))
                    return;
                if ("selfClose" != r)
                    if (i[1]) {
                        for (var s = n.length - 1; 0 <= s; --s)
                            if (n[s] == i[2]) {
                                n.length = s;
                                break;
                            }
                        if (s < 0 && (!t || t == i[2]))
                            return {
                                tag: i[2],
                                from: u(o, l),
                                to: u(e.line, e.ch)
                            };
                    } else
                        n.push(i[2]);
            }
        }
        function g(e, t) {
            for (var n = []; ; ) {
                var r = c(e);
                if (!r)
                    return;
                if ("selfClose" != r) {
                    var i = e.line
                      , o = e.ch
                      , l = d(e);
                    if (!l)
                        return;
                    if (l[1])
                        n.push(l[2]);
                    else {
                        for (var s = n.length - 1; 0 <= s; --s)
                            if (n[s] == l[2]) {
                                n.length = s;
                                break;
                            }
                        if (s < 0 && (!t || t == l[2]))
                            return {
                                tag: l[2],
                                from: u(e.line, e.ch),
                                to: u(i, o)
                            };
                    }
                } else
                    d(e);
            }
        }
        e.registerHelper("fold", "xml", function(e, t) {
            for (var n = new f(e,t.line,0); ; ) {
                var r, i = a(n);
                if (!i || n.line != t.line || !(r = h(n)))
                    return;
                if (!i[1] && "selfClose" != r) {
                    t = u(n.line, n.ch);
                    var o = p(n, i[2]);
                    return o && {
                        from: t,
                        to: o.from
                    };
                }
            }
        }),
        e.findMatchingTag = function(e, t, n) {
            var r = new f(e,t.line,t.ch,n);
            if (-1 != r.text.indexOf(">") || -1 != r.text.indexOf("<")) {
                var i = h(r)
                  , o = i && u(r.line, r.ch)
                  , l = i && d(r);
                if (i && l && (a = t,
                !(0 < ((s = r).line - a.line || s.ch - a.ch)))) {
                    var s, a, c = {
                        from: u(r.line, r.ch),
                        to: o,
                        tag: l[2]
                    };
                    return "selfClose" == i ? {
                        open: c,
                        close: null,
                        at: "open"
                    } : l[1] ? {
                        open: g(r, l[2]),
                        close: c,
                        at: "close"
                    } : {
                        open: c,
                        close: p(r = new f(e,o.line,o.ch,n), l[2]),
                        at: "open"
                    };
                }
            }
        }
        ,
        e.findEnclosingTag = function(e, t, n) {
            for (var r = new f(e,t.line,t.ch,n); ; ) {
                var i = g(r);
                if (!i)
                    break;
                var o = p(new f(e,t.line,t.ch,n), i.tag);
                if (o)
                    return {
                        open: i,
                        close: o
                    };
            }
        }
        ,
        e.scanForClosingTag = function(e, t, n, r) {
            return p(new f(e,t.line,t.ch,r ? {
                from: 0,
                to: r
            } : null), n);
        }
        ;
    }(CodeMirror),
    function(l) {
        "use strict";
        function s(e) {
            e.state.tagHit && e.state.tagHit.clear(),
            e.state.tagOther && e.state.tagOther.clear(),
            e.state.tagHit = e.state.tagOther = null;
        }
        function r(o) {
            o.state.failedTagMatch = !1,
            o.operation(function() {
                if (s(o),
                !o.somethingSelected()) {
                    var e = o.getCursor()
                      , t = o.getViewport();
                    t.from = Math.min(t.from, e.line),
                    t.to = Math.max(e.line + 1, t.to);
                    var n = l.findMatchingTag(o, e, t);
                    if (n) {
                        if (o.state.matchBothTags) {
                            var r = "open" == n.at ? n.open : n.close;
                            r && (o.state.tagHit = o.markText(r.from, r.to, {
                                className: "CodeMirror-matchingtag"
                            }));
                        }
                        var i = "close" == n.at ? n.open : n.close;
                        i ? o.state.tagOther = o.markText(i.from, i.to, {
                            className: "CodeMirror-matchingtag"
                        }) : o.state.failedTagMatch = !0;
                    }
                }
            });
        }
        function i(e) {
            e.state.failedTagMatch && r(e);
        }
        l.defineOption("matchTags", !1, function(e, t, n) {
            n && n != l.Init && (e.off("cursorActivity", r),
            e.off("viewportChange", i),
            s(e)),
            t && (e.state.matchBothTags = "object" == typeof t && t.bothTags,
            e.on("cursorActivity", r),
            e.on("viewportChange", i),
            r(e));
        }),
        l.commands.toMatchingTag = function(e) {
            var t = l.findMatchingTag(e, e.getCursor());
            if (t) {
                var n = "close" == t.at ? t.open : t.close;
                n && e.extendSelection(n.to, n.from);
            }
        }
        ;
    }(CodeMirror),
    function(C) {
        "use strict";
        var S = "CodeMirror-hint-active";
        function i(e, t) {
            this.cm = e,
            this.options = t,
            this.widget = null,
            this.debounce = 0,
            this.tick = 0,
            this.startPos = this.cm.getCursor("start"),
            this.startLen = this.cm.getLine(this.startPos.line).length - this.cm.getSelection().length;
            var n = this;
            e.on("cursorActivity", this.activityFunc = function() {
                n.cursorActivity();
            }
            );
        }
        C.showHint = function(e, t, n) {
            if (!t)
                return e.showHint(n);
            n && n.async && (t.async = !0);
            var r = {
                hint: t
            };
            if (n)
                for (var i in n)
                    r[i] = n[i];
            return e.showHint(r);
        }
        ,
        C.defineExtension("showHint", function(e) {
            e = function(e, t, n) {
                var r = e.options.hintOptions
                  , i = {};
                for (var o in s)
                    i[o] = s[o];
                if (r)
                    for (var o in r)
                        void 0 !== r[o] && (i[o] = r[o]);
                if (n)
                    for (var o in n)
                        void 0 !== n[o] && (i[o] = n[o]);
                i.hint.resolve && (i.hint = i.hint.resolve(e, t));
                return i;
            }(this, this.getCursor("start"), e);
            var t = this.listSelections();
            if (!(1 < t.length)) {
                if (this.somethingSelected()) {
                    if (!e.hint.supportsSelection)
                        return;
                    for (var n = 0; n < t.length; n++)
                        if (t[n].head.line != t[n].anchor.line)
                            return;
                }
                this.state.completionActive && this.state.completionActive.close();
                var r = this.state.completionActive = new i(this,e);
                r.options.hint && (C.signal(this, "startCompletion", this),
                r.update(!0));
            }
        });
        var r = window.requestAnimationFrame || function(e) {
            return setTimeout(e, 1e3 / 60);
        }
          , o = window.cancelAnimationFrame || clearTimeout;
        function k(e) {
            return "string" == typeof e ? e : e.text;
        }
        function L(e, t) {
            for (; t && t != e; ) {
                if ("LI" === t.nodeName.toUpperCase() && t.parentNode == e)
                    return t;
                t = t.parentNode;
            }
        }
        function l(i, e) {
            this.completion = i,
            this.data = e,
            this.picked = !1;
            var n = this
              , o = i.cm
              , l = this.hints = document.createElement("ul");
            l.className = "CodeMirror-hints",
            this.selectedHint = e.selectedHint || 0;
            for (var t = e.list, r = 0; r < t.length; ++r) {
                var s = l.appendChild(document.createElement("li"))
                  , a = t[r]
                  , c = "CodeMirror-hint" + (r != this.selectedHint ? "" : " " + S);
                null != a.className && (c = a.className + " " + c),
                s.className = c,
                a.render ? a.render(s, e, a) : s.appendChild(document.createTextNode(a.displayText || k(a))),
                s.hintId = r;
            }
            var u = o.cursorCoords(i.options.alignWithWord ? e.from : null)
              , f = u.left
              , h = u.bottom
              , d = !0;
            l.style.left = f + "px",
            l.style.top = h + "px";
            var p = window.innerWidth || Math.max(document.body.offsetWidth, document.documentElement.offsetWidth)
              , g = window.innerHeight || Math.max(document.body.offsetHeight, document.documentElement.offsetHeight);
            (i.options.container || document.body).appendChild(l);
            var m = l.getBoundingClientRect();
            if (0 < m.bottom - g) {
                var v = m.bottom - m.top;
                if (0 < u.top - (u.bottom - m.top) - v)
                    l.style.top = (h = u.top - v) + "px",
                    d = !1;
                else if (g < v) {
                    l.style.height = g - 5 + "px",
                    l.style.top = (h = u.bottom - m.top) + "px";
                    var y = o.getCursor();
                    e.from.ch != y.ch && (u = o.cursorCoords(y),
                    l.style.left = (f = u.left) + "px",
                    m = l.getBoundingClientRect());
                }
            }
            var b, w = m.right - p;
            (0 < w && (m.right - m.left > p && (l.style.width = p - 5 + "px",
            w -= m.right - m.left - p),
            l.style.left = (f = u.left - w) + "px"),
            o.addKeyMap(this.keyMap = function(e, r) {
                var i = {
                    Up: function() {
                        r.moveFocus(-1);
                    },
                    Down: function() {
                        r.moveFocus(1);
                    },
                    PageUp: function() {
                        r.moveFocus(1 - r.menuSize(), !0);
                    },
                    PageDown: function() {
                        r.moveFocus(r.menuSize() - 1, !0);
                    },
                    Home: function() {
                        r.setFocus(0);
                    },
                    End: function() {
                        r.setFocus(r.length - 1);
                    },
                    Enter: r.pick,
                    Tab: r.pick,
                    Esc: r.close
                }
                  , t = e.options.customKeys
                  , o = t ? {} : i;
                function n(e, t) {
                    var n;
                    n = "string" != typeof t ? function(e) {
                        return t(e, r);
                    }
                    : i.hasOwnProperty(t) ? i[t] : t,
                    o[e] = n;
                }
                if (t)
                    for (var l in t)
                        t.hasOwnProperty(l) && n(l, t[l]);
                var s = e.options.extraKeys;
                if (s)
                    for (var l in s)
                        s.hasOwnProperty(l) && n(l, s[l]);
                return o;
            }(i, {
                moveFocus: function(e, t) {
                    n.changeActive(n.selectedHint + e, t);
                },
                setFocus: function(e) {
                    n.changeActive(e);
                },
                menuSize: function() {
                    return n.screenAmount();
                },
                length: t.length,
                close: function() {
                    i.close();
                },
                pick: function() {
                    n.pick();
                },
                data: e
            })),
            i.options.closeOnUnfocus) && (o.on("blur", this.onBlur = function() {
                b = setTimeout(function() {
                    i.close();
                }, 100);
            }
            ),
            o.on("focus", this.onFocus = function() {
                clearTimeout(b);
            }
            ));
            var x = o.getScrollInfo();
            return o.on("scroll", this.onScroll = function() {
                var e = o.getScrollInfo()
                  , t = o.getWrapperElement().getBoundingClientRect()
                  , n = h + x.top - e.top
                  , r = n - (window.pageYOffset || (document.documentElement || document.body).scrollTop);
                if (d || (r += l.offsetHeight),
                r <= t.top || r >= t.bottom)
                    return i.close();
                l.style.top = n + "px",
                l.style.left = f + x.left - e.left + "px";
            }
            ),
            C.on(l, "dblclick", function(e) {
                var t = L(l, e.target || e.srcElement);
                t && null != t.hintId && (n.changeActive(t.hintId),
                n.pick());
            }),
            C.on(l, "click", function(e) {
                var t = L(l, e.target || e.srcElement);
                t && null != t.hintId && (n.changeActive(t.hintId),
                i.options.completeOnSingleClick && n.pick());
            }),
            C.on(l, "mousedown", function() {
                setTimeout(function() {
                    o.focus();
                }, 20);
            }),
            C.signal(e, "select", t[0], l.firstChild),
            !0;
        }
        function c(e, t) {
            if (!e.somethingSelected())
                return t;
            for (var n = [], r = 0; r < t.length; r++)
                t[r].supportsSelection && n.push(t[r]);
            return n;
        }
        i.prototype = {
            close: function() {
                this.active() && (this.cm.state.completionActive = null,
                this.tick = null,
                this.cm.off("cursorActivity", this.activityFunc),
                this.widget && this.data && C.signal(this.data, "close"),
                this.widget && this.widget.close(),
                C.signal(this.cm, "endCompletion", this.cm));
            },
            active: function() {
                return this.cm.state.completionActive == this;
            },
            pick: function(e, t) {
                var n = e.list[t];
                n.hint ? n.hint(this.cm, e, n) : this.cm.replaceRange(k(n), n.from || e.from, n.to || e.to, "complete"),
                C.signal(e, "pick", n),
                this.close();
            },
            cursorActivity: function() {
                this.debounce && (o(this.debounce),
                this.debounce = 0);
                var e = this.cm.getCursor()
                  , t = this.cm.getLine(e.line);
                if (e.line != this.startPos.line || t.length - e.ch != this.startLen - this.startPos.ch || e.ch < this.startPos.ch || this.cm.somethingSelected() || e.ch && this.options.closeCharacters.test(t.charAt(e.ch - 1)))
                    this.close();
                else {
                    var n = this;
                    this.debounce = r(function() {
                        n.update();
                    }),
                    this.widget && this.widget.disable();
                }
            },
            update: function(t) {
                if (null != this.tick)
                    if (this.options.hint.async) {
                        var n = ++this.tick
                          , r = this;
                        this.options.hint(this.cm, function(e) {
                            r.tick == n && r.finishUpdate(e, t);
                        }, this.options);
                    } else
                        this.finishUpdate(this.options.hint(this.cm, this.options), t);
            },
            finishUpdate: function(e, t) {
                this.data && C.signal(this.data, "update");
                var n, r, i = this.widget && this.widget.picked || t && this.options.completeSingle;
                (this.widget && this.widget.close(),
                e && this.data && (n = this.data,
                r = e,
                0 < C.cmpPos(r.from, n.from) && n.to.ch - n.from.ch != r.to.ch - r.from.ch)) || (this.data = e) && e.list.length && (i && 1 == e.list.length ? this.pick(e, 0) : (this.widget = new l(this,e),
                C.signal(e, "shown")));
            }
        },
        l.prototype = {
            close: function() {
                if (this.completion.widget == this) {
                    this.completion.widget = null,
                    this.hints.parentNode.removeChild(this.hints),
                    this.completion.cm.removeKeyMap(this.keyMap);
                    var e = this.completion.cm;
                    this.completion.options.closeOnUnfocus && (e.off("blur", this.onBlur),
                    e.off("focus", this.onFocus)),
                    e.off("scroll", this.onScroll);
                }
            },
            disable: function() {
                this.completion.cm.removeKeyMap(this.keyMap);
                var e = this;
                this.keyMap = {
                    Enter: function() {
                        e.picked = !0;
                    }
                },
                this.completion.cm.addKeyMap(this.keyMap);
            },
            pick: function() {
                this.completion.pick(this.data, this.selectedHint);
            },
            changeActive: function(e, t) {
                if (e >= this.data.list.length ? e = t ? this.data.list.length - 1 : 0 : e < 0 && (e = t ? 0 : this.data.list.length - 1),
                this.selectedHint != e) {
                    var n = this.hints.childNodes[this.selectedHint];
                    n.className = n.className.replace(" " + S, ""),
                    (n = this.hints.childNodes[this.selectedHint = e]).className += " " + S,
                    n.offsetTop < this.hints.scrollTop ? this.hints.scrollTop = n.offsetTop - 3 : n.offsetTop + n.offsetHeight > this.hints.scrollTop + this.hints.clientHeight && (this.hints.scrollTop = n.offsetTop + n.offsetHeight - this.hints.clientHeight + 3),
                    C.signal(this.data, "select", this.data.list[this.selectedHint], n);
                }
            },
            screenAmount: function() {
                return Math.floor(this.hints.clientHeight / this.hints.firstChild.offsetHeight) || 1;
            }
        },
        C.registerHelper("hint", "auto", {
            resolve: function(e, t) {
                var n, a = e.getHelpers(t, "hint");
                if (a.length) {
                    for (var r, i = !1, o = 0; o < a.length; o++)
                        a[o].async && (i = !0);
                    return i ? (r = function(i, o, l) {
                        var s = c(i, a);
                        !function t(n, e) {
                            if (n == s.length)
                                return o(null);
                            var r = s[n];
                            r.async ? r(i, function(e) {
                                e ? o(e) : t(n + 1);
                            }, l) : (e = r(i, l)) ? o(e) : t(n + 1);
                        }(0);
                    }
                    ).async = !0 : r = function(e, t) {
                        for (var n = c(e, a), r = 0; r < n.length; r++) {
                            var i = n[r](e, t);
                            if (i && i.list.length)
                                return i;
                        }
                    }
                    ,
                    r.supportsSelection = !0,
                    r;
                }
                return (n = e.getHelper(e.getCursor(), "hintWords")) ? function(e) {
                    return C.hint.fromList(e, {
                        words: n
                    });
                }
                : C.hint.anyword ? function(e, t) {
                    return C.hint.anyword(e, t);
                }
                : function() {}
                ;
            }
        }),
        C.registerHelper("hint", "fromList", function(e, t) {
            var n = e.getCursor()
              , r = e.getTokenAt(n)
              , i = C.Pos(n.line, r.end);
            if (r.string && /\w/.test(r.string[r.string.length - 1]))
                var o = r.string
                  , l = C.Pos(n.line, r.start);
            else
                o = "",
                l = i;
            for (var s = [], a = 0; a < t.words.length; a++) {
                var c = t.words[a];
                c.slice(0, o.length) == o && s.push(c);
            }
            if (s.length)
                return {
                    list: s,
                    from: l,
                    to: i
                };
        }),
        C.commands.autocomplete = C.showHint;
        var s = {
            hint: C.hint.auto,
            completeSingle: !0,
            alignWithWord: !0,
            closeCharacters: /[\s()\[\]{};:>,]/,
            closeOnUnfocus: !0,
            completeOnSingleClick: !0,
            container: null,
            customKeys: null,
            extraKeys: null
        };
        C.defineOption("hintOptions", null);
    }(CodeMirror),
    function(O) {
        "use strict";
        var A = O.Pos;
        O.registerHelper("hint", "xml", function(e, t) {
            var n = t && t.schemaInfo
              , r = t && t.quoteChar || '"';
            if (n) {
                var i = e.getCursor()
                  , o = e.getTokenAt(i);
                o.end > i.ch && (o.end = i.ch,
                o.string = o.string.slice(0, i.ch - o.start));
                var l = O.innerMode(e.getMode(), o.state);
                if ("xml" == l.mode.name) {
                    var s, a, c = [], u = !1, f = /\btag\b/.test(o.type) && !/>$/.test(o.string), h = f && /^\w/.test(o.string);
                    if (h) {
                        var d = e.getLine(i.line).slice(Math.max(0, o.start - 2), o.start)
                          , p = /<\/$/.test(d) ? "close" : /<$/.test(d) ? "open" : null;
                        p && (a = o.start - ("close" == p ? 2 : 1));
                    } else
                        f && "<" == o.string ? p = "open" : f && "</" == o.string && (p = "close");
                    if (!f && !l.state.tagName || p) {
                        h && (s = o.string),
                        u = p;
                        var g = l.state.context
                          , m = g && n[g.tagName]
                          , v = g ? m && m.children : n["!top"];
                        if (v && "close" != p)
                            for (var y = 0; y < v.length; ++y)
                                s && 0 != v[y].lastIndexOf(s, 0) || c.push("<" + v[y]);
                        else if ("close" != p)
                            for (var b in n)
                                !n.hasOwnProperty(b) || "!top" == b || "!attrs" == b || s && 0 != b.lastIndexOf(s, 0) || c.push("<" + b);
                        g && (!s || "close" == p && 0 == g.tagName.lastIndexOf(s, 0)) && c.push("</" + g.tagName + ">");
                    } else {
                        var w = (m = n[l.state.tagName]) && m.attrs
                          , x = n["!attrs"];
                        if (!w && !x)
                            return;
                        if (w) {
                            if (x) {
                                var C = {};
                                for (var S in x)
                                    x.hasOwnProperty(S) && (C[S] = x[S]);
                                for (var S in w)
                                    w.hasOwnProperty(S) && (C[S] = w[S]);
                                w = C;
                            }
                        } else
                            w = x;
                        if ("string" == o.type || "=" == o.string) {
                            var k, L = (d = e.getRange(A(i.line, Math.max(0, i.ch - 60)), A(i.line, "string" == o.type ? o.start : o.end))).match(/([^\s\u00a0=<>\"\']+)=$/);
                            if (!L || !w.hasOwnProperty(L[1]) || !(k = w[L[1]]))
                                return;
                            if ("function" == typeof k && (k = k.call(this, e)),
                            "string" == o.type) {
                                s = o.string;
                                var M = 0;
                                /['"]/.test(o.string.charAt(0)) && (r = o.string.charAt(0),
                                s = o.string.slice(1),
                                M++);
                                var T = o.string.length;
                                /['"]/.test(o.string.charAt(T - 1)) && (r = o.string.charAt(T - 1),
                                s = o.string.substr(M, T - 2)),
                                u = !0;
                            }
                            for (y = 0; y < k.length; ++y)
                                s && 0 != k[y].lastIndexOf(s, 0) || c.push(r + k[y] + r);
                        } else
                            for (var N in "attribute" == o.type && (s = o.string,
                            u = !0),
                            w)
                                !w.hasOwnProperty(N) || s && 0 != N.lastIndexOf(s, 0) || c.push(N);
                    }
                    return {
                        list: c,
                        from: u ? A(i.line, null == a ? o.start : a) : i,
                        to: u ? A(i.line, o.end) : i
                    };
                }
            }
        });
    }(CodeMirror),
    function(i) {
        "use strict";
        var e = "ab aa af ak sq am ar an hy as av ae ay az bm ba eu be bn bh bi bs br bg my ca ch ce ny zh cv kw co cr hr cs da dv nl dz en eo et ee fo fj fi fr ff gl ka de el gn gu ht ha he hz hi ho hu ia id ie ga ig ik io is it iu ja jv kl kn kr ks kk km ki rw ky kv kg ko ku kj la lb lg li ln lo lt lu lv gv mk mg ms ml mt mi mr mh mn na nv nb nd ne ng nn no ii nr oc oj cu om or os pa pi fa pl ps pt qu rm rn ro ru sa sc sd se sm sg sr gd sn si sk sl so st es su sw ss sv ta te tg th ti bo tk tl tn to tr ts tt tw ty ug uk ur uz ve vi vo wa cy wo fy xh yi yo za zu".split(" ")
          , t = ["_blank", "_self", "_top", "_parent"]
          , n = ["ascii", "utf-8", "utf-16", "latin1", "latin1"]
          , r = ["get", "post", "put", "delete"]
          , o = ["application/x-www-form-urlencoded", "multipart/form-data", "text/plain"]
          , l = ["all", "screen", "print", "embossed", "braille", "handheld", "print", "projection", "screen", "tty", "tv", "speech", "3d-glasses", "resolution [>][<][=] [X]", "device-aspect-ratio: X/Y", "orientation:portrait", "orientation:landscape", "device-height: [X]", "device-width: [X]"]
          , s = {
            attrs: {}
        }
          , a = {
            a: {
                attrs: {
                    href: null,
                    ping: null,
                    type: null,
                    media: l,
                    target: t,
                    hreflang: e
                }
            },
            abbr: s,
            acronym: s,
            address: s,
            applet: s,
            area: {
                attrs: {
                    alt: null,
                    coords: null,
                    href: null,
                    target: null,
                    ping: null,
                    media: l,
                    hreflang: e,
                    type: null,
                    shape: ["default", "rect", "circle", "poly"]
                }
            },
            article: s,
            aside: s,
            audio: {
                attrs: {
                    src: null,
                    mediagroup: null,
                    crossorigin: ["anonymous", "use-credentials"],
                    preload: ["none", "metadata", "auto"],
                    autoplay: ["", "autoplay"],
                    loop: ["", "loop"],
                    controls: ["", "controls"]
                }
            },
            b: s,
            base: {
                attrs: {
                    href: null,
                    target: t
                }
            },
            basefont: s,
            bdi: s,
            bdo: s,
            big: s,
            blockquote: {
                attrs: {
                    cite: null
                }
            },
            body: s,
            br: s,
            button: {
                attrs: {
                    form: null,
                    formaction: null,
                    name: null,
                    value: null,
                    autofocus: ["", "autofocus"],
                    disabled: ["", "autofocus"],
                    formenctype: o,
                    formmethod: r,
                    formnovalidate: ["", "novalidate"],
                    formtarget: t,
                    type: ["submit", "reset", "button"]
                }
            },
            canvas: {
                attrs: {
                    width: null,
                    height: null
                }
            },
            caption: s,
            center: s,
            cite: s,
            code: s,
            col: {
                attrs: {
                    span: null
                }
            },
            colgroup: {
                attrs: {
                    span: null
                }
            },
            command: {
                attrs: {
                    type: ["command", "checkbox", "radio"],
                    label: null,
                    icon: null,
                    radiogroup: null,
                    command: null,
                    title: null,
                    disabled: ["", "disabled"],
                    checked: ["", "checked"]
                }
            },
            data: {
                attrs: {
                    value: null
                }
            },
            datagrid: {
                attrs: {
                    disabled: ["", "disabled"],
                    multiple: ["", "multiple"]
                }
            },
            datalist: {
                attrs: {
                    data: null
                }
            },
            dd: s,
            del: {
                attrs: {
                    cite: null,
                    datetime: null
                }
            },
            details: {
                attrs: {
                    open: ["", "open"]
                }
            },
            dfn: s,
            dir: s,
            div: s,
            dl: s,
            dt: s,
            em: s,
            embed: {
                attrs: {
                    src: null,
                    type: null,
                    width: null,
                    height: null
                }
            },
            eventsource: {
                attrs: {
                    src: null
                }
            },
            fieldset: {
                attrs: {
                    disabled: ["", "disabled"],
                    form: null,
                    name: null
                }
            },
            figcaption: s,
            figure: s,
            font: s,
            footer: s,
            form: {
                attrs: {
                    action: null,
                    name: null,
                    "accept-charset": n,
                    autocomplete: ["on", "off"],
                    enctype: o,
                    method: r,
                    novalidate: ["", "novalidate"],
                    target: t
                }
            },
            frame: s,
            frameset: s,
            h1: s,
            h2: s,
            h3: s,
            h4: s,
            h5: s,
            h6: s,
            head: {
                attrs: {},
                children: ["title", "base", "link", "style", "meta", "script", "noscript", "command"]
            },
            header: s,
            hgroup: s,
            hr: s,
            html: {
                attrs: {
                    manifest: null
                },
                children: ["head", "body"]
            },
            i: s,
            iframe: {
                attrs: {
                    src: null,
                    srcdoc: null,
                    name: null,
                    width: null,
                    height: null,
                    sandbox: ["allow-top-navigation", "allow-same-origin", "allow-forms", "allow-scripts"],
                    seamless: ["", "seamless"]
                }
            },
            img: {
                attrs: {
                    alt: null,
                    src: null,
                    ismap: null,
                    usemap: null,
                    width: null,
                    height: null,
                    crossorigin: ["anonymous", "use-credentials"]
                }
            },
            input: {
                attrs: {
                    alt: null,
                    dirname: null,
                    form: null,
                    formaction: null,
                    height: null,
                    list: null,
                    max: null,
                    maxlength: null,
                    min: null,
                    name: null,
                    pattern: null,
                    placeholder: null,
                    size: null,
                    src: null,
                    step: null,
                    value: null,
                    width: null,
                    accept: ["audio/*", "video/*", "image/*"],
                    autocomplete: ["on", "off"],
                    autofocus: ["", "autofocus"],
                    checked: ["", "checked"],
                    disabled: ["", "disabled"],
                    formenctype: o,
                    formmethod: r,
                    formnovalidate: ["", "novalidate"],
                    formtarget: t,
                    multiple: ["", "multiple"],
                    readonly: ["", "readonly"],
                    required: ["", "required"],
                    type: ["hidden", "text", "search", "tel", "url", "email", "password", "datetime", "date", "month", "week", "time", "datetime-local", "number", "range", "color", "checkbox", "radio", "file", "submit", "image", "reset", "button"]
                }
            },
            ins: {
                attrs: {
                    cite: null,
                    datetime: null
                }
            },
            kbd: s,
            keygen: {
                attrs: {
                    challenge: null,
                    form: null,
                    name: null,
                    autofocus: ["", "autofocus"],
                    disabled: ["", "disabled"],
                    keytype: ["RSA"]
                }
            },
            label: {
                attrs: {
                    for: null,
                    form: null
                }
            },
            legend: s,
            li: {
                attrs: {
                    value: null
                }
            },
            link: {
                attrs: {
                    href: null,
                    type: null,
                    hreflang: e,
                    media: l,
                    sizes: ["all", "16x16", "16x16 32x32", "16x16 32x32 64x64"]
                }
            },
            map: {
                attrs: {
                    name: null
                }
            },
            mark: s,
            menu: {
                attrs: {
                    label: null,
                    type: ["list", "context", "toolbar"]
                }
            },
            meta: {
                attrs: {
                    content: null,
                    charset: n,
                    name: ["viewport", "application-name", "author", "description", "generator", "keywords"],
                    "http-equiv": ["content-language", "content-type", "default-style", "refresh"]
                }
            },
            meter: {
                attrs: {
                    value: null,
                    min: null,
                    low: null,
                    high: null,
                    max: null,
                    optimum: null
                }
            },
            nav: s,
            noframes: s,
            noscript: s,
            object: {
                attrs: {
                    data: null,
                    type: null,
                    name: null,
                    usemap: null,
                    form: null,
                    width: null,
                    height: null,
                    typemustmatch: ["", "typemustmatch"]
                }
            },
            ol: {
                attrs: {
                    reversed: ["", "reversed"],
                    start: null,
                    type: ["1", "a", "A", "i", "I"]
                }
            },
            optgroup: {
                attrs: {
                    disabled: ["", "disabled"],
                    label: null
                }
            },
            option: {
                attrs: {
                    disabled: ["", "disabled"],
                    label: null,
                    selected: ["", "selected"],
                    value: null
                }
            },
            output: {
                attrs: {
                    for: null,
                    form: null,
                    name: null
                }
            },
            p: s,
            param: {
                attrs: {
                    name: null,
                    value: null
                }
            },
            pre: s,
            progress: {
                attrs: {
                    value: null,
                    max: null
                }
            },
            q: {
                attrs: {
                    cite: null
                }
            },
            rp: s,
            rt: s,
            ruby: s,
            s: s,
            samp: s,
            script: {
                attrs: {
                    type: ["text/javascript"],
                    src: null,
                    async: ["", "async"],
                    defer: ["", "defer"],
                    charset: n
                }
            },
            section: s,
            select: {
                attrs: {
                    form: null,
                    name: null,
                    size: null,
                    autofocus: ["", "autofocus"],
                    disabled: ["", "disabled"],
                    multiple: ["", "multiple"]
                }
            },
            small: s,
            source: {
                attrs: {
                    src: null,
                    type: null,
                    media: null
                }
            },
            span: s,
            strike: s,
            strong: s,
            style: {
                attrs: {
                    type: ["text/css"],
                    media: l,
                    scoped: null
                }
            },
            sub: s,
            summary: s,
            sup: s,
            table: s,
            tbody: s,
            td: {
                attrs: {
                    colspan: null,
                    rowspan: null,
                    headers: null
                }
            },
            textarea: {
                attrs: {
                    dirname: null,
                    form: null,
                    maxlength: null,
                    name: null,
                    placeholder: null,
                    rows: null,
                    cols: null,
                    autofocus: ["", "autofocus"],
                    disabled: ["", "disabled"],
                    readonly: ["", "readonly"],
                    required: ["", "required"],
                    wrap: ["soft", "hard"]
                }
            },
            tfoot: s,
            th: {
                attrs: {
                    colspan: null,
                    rowspan: null,
                    headers: null,
                    scope: ["row", "col", "rowgroup", "colgroup"]
                }
            },
            thead: s,
            time: {
                attrs: {
                    datetime: null
                }
            },
            title: s,
            tr: s,
            track: {
                attrs: {
                    src: null,
                    label: null,
                    default: null,
                    kind: ["subtitles", "captions", "descriptions", "chapters", "metadata"],
                    srclang: e
                }
            },
            tt: s,
            u: s,
            ul: s,
            var: s,
            video: {
                attrs: {
                    src: null,
                    poster: null,
                    width: null,
                    height: null,
                    crossorigin: ["anonymous", "use-credentials"],
                    preload: ["auto", "metadata", "none"],
                    autoplay: ["", "autoplay"],
                    mediagroup: ["movie"],
                    muted: ["", "muted"],
                    controls: ["", "controls"]
                }
            },
            wbr: s
        }
          , c = {
            accesskey: ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"],
            class: null,
            contenteditable: ["true", "false"],
            contextmenu: null,
            dir: ["ltr", "rtl", "auto"],
            draggable: ["true", "false", "auto"],
            dropzone: ["copy", "move", "link", "string:", "file:"],
            hidden: ["hidden"],
            id: null,
            inert: ["inert"],
            itemid: null,
            itemprop: null,
            itemref: null,
            itemscope: ["itemscope"],
            itemtype: null,
            lang: ["en", "es"],
            spellcheck: ["true", "false"],
            style: null,
            tabindex: ["1", "2", "3", "4", "5", "6", "7", "8", "9"],
            title: null,
            translate: ["yes", "no"],
            onclick: null,
            rel: ["stylesheet", "alternate", "author", "bookmark", "help", "license", "next", "nofollow", "noreferrer", "prefetch", "prev", "search", "tag"]
        };
        function u(e) {
            for (var t in c)
                c.hasOwnProperty(t) && (e.attrs[t] = c[t]);
        }
        for (var f in u(s),
        a)
            a.hasOwnProperty(f) && a[f] != s && u(a[f]);
        i.htmlSchema = a,
        i.registerHelper("hint", "html", function(e, t) {
            var n = {
                schemaInfo: a
            };
            if (t)
                for (var r in t)
                    n[r] = t[r];
            return i.hint.xml(e, n);
        });
    }(CodeMirror),
    function(S) {
        "use strict";
        var k = {
            autoSelfClosers: {
                area: !0,
                base: !0,
                br: !0,
                col: !0,
                command: !0,
                embed: !0,
                frame: !0,
                hr: !0,
                img: !0,
                input: !0,
                keygen: !0,
                link: !0,
                meta: !0,
                param: !0,
                source: !0,
                track: !0,
                wbr: !0,
                menuitem: !0
            },
            implicitlyClosed: {
                dd: !0,
                li: !0,
                optgroup: !0,
                option: !0,
                p: !0,
                rp: !0,
                rt: !0,
                tbody: !0,
                td: !0,
                tfoot: !0,
                th: !0,
                tr: !0
            },
            contextGrabbers: {
                dd: {
                    dd: !0,
                    dt: !0
                },
                dt: {
                    dd: !0,
                    dt: !0
                },
                li: {
                    li: !0
                },
                option: {
                    option: !0,
                    optgroup: !0
                },
                optgroup: {
                    optgroup: !0
                },
                p: {
                    address: !0,
                    article: !0,
                    aside: !0,
                    blockquote: !0,
                    dir: !0,
                    div: !0,
                    dl: !0,
                    fieldset: !0,
                    footer: !0,
                    form: !0,
                    h1: !0,
                    h2: !0,
                    h3: !0,
                    h4: !0,
                    h5: !0,
                    h6: !0,
                    header: !0,
                    hgroup: !0,
                    hr: !0,
                    menu: !0,
                    nav: !0,
                    ol: !0,
                    p: !0,
                    pre: !0,
                    section: !0,
                    table: !0,
                    ul: !0
                },
                rp: {
                    rp: !0,
                    rt: !0
                },
                rt: {
                    rp: !0,
                    rt: !0
                },
                tbody: {
                    tbody: !0,
                    tfoot: !0
                },
                td: {
                    td: !0,
                    th: !0
                },
                tfoot: {
                    tbody: !0
                },
                th: {
                    td: !0,
                    th: !0
                },
                thead: {
                    tbody: !0,
                    tfoot: !0
                },
                tr: {
                    tr: !0
                }
            },
            doNotIndent: {
                pre: !0
            },
            allowUnquoted: !0,
            allowMissing: !0,
            caseFold: !0
        }
          , L = {
            autoSelfClosers: {},
            implicitlyClosed: {},
            contextGrabbers: {},
            doNotIndent: {},
            allowUnquoted: !1,
            allowMissing: !1,
            caseFold: !1
        };
        S.defineMode("xml", function(e, t) {
            var l, o, s = e.indentUnit, a = {}, n = t.htmlMode ? k : L;
            for (var r in n)
                a[r] = n[r];
            for (var r in t)
                a[r] = t[r];
            function c(t, n) {
                function e(e) {
                    return (n.tokenize = e)(t, n);
                }
                var r = t.next();
                return "<" == r ? t.eat("!") ? t.eat("[") ? t.match("CDATA[") ? e(i("atom", "]]>")) : null : t.match("--") ? e(i("comment", "--\x3e")) : t.match("DOCTYPE", !0, !0) ? (t.eatWhile(/[\w\._\-]/),
                e(function r(i) {
                    return function(e, t) {
                        for (var n; null != (n = e.next()); ) {
                            if ("<" == n)
                                return t.tokenize = r(i + 1),
                                t.tokenize(e, t);
                            if (">" == n) {
                                if (1 == i) {
                                    t.tokenize = c;
                                    break;
                                }
                                return t.tokenize = r(i - 1),
                                t.tokenize(e, t);
                            }
                        }
                        return "meta";
                    }
                    ;
                }(1))) : null : t.eat("?") ? (t.eatWhile(/[\w\._\-]/),
                n.tokenize = i("meta", "?>"),
                "meta") : (l = t.eat("/") ? "closeTag" : "openTag",
                n.tokenize = u,
                "tag bracket") : "&" == r ? (t.eat("#") ? t.eat("x") ? t.eatWhile(/[a-fA-F\d]/) && t.eat(";") : t.eatWhile(/[\d]/) && t.eat(";") : t.eatWhile(/[\w\.\-:]/) && t.eat(";")) ? "atom" : "error" : (t.eatWhile(/[^&<]/),
                null);
            }
            function u(e, t) {
                var n, r, i = e.next();
                if (">" == i || "/" == i && e.eat(">"))
                    return t.tokenize = c,
                    l = ">" == i ? "endTag" : "selfcloseTag",
                    "tag bracket";
                if ("=" == i)
                    return l = "equals",
                    null;
                if ("<" == i) {
                    t.tokenize = c,
                    t.state = p,
                    t.tagName = t.tagStart = null;
                    var o = t.tokenize(e, t);
                    return o ? o + " tag error" : "tag error";
                }
                return /[\'\"]/.test(i) ? (t.tokenize = (n = i,
                (r = function(e, t) {
                    for (; !e.eol(); )
                        if (e.next() == n) {
                            t.tokenize = u;
                            break;
                        }
                    return "string";
                }
                ).isInAttribute = !0,
                r),
                t.stringStartCol = e.column(),
                t.tokenize(e, t)) : (e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),
                "word");
            }
            function i(n, r) {
                return function(e, t) {
                    for (; !e.eol(); ) {
                        if (e.match(r)) {
                            t.tokenize = c;
                            break;
                        }
                        e.next();
                    }
                    return n;
                }
                ;
            }
            function f(e, t, n) {
                this.prev = e.context,
                this.tagName = t,
                this.indent = e.indented,
                this.startOfLine = n,
                (a.doNotIndent.hasOwnProperty(t) || e.context && e.context.noIndent) && (this.noIndent = !0);
            }
            function h(e) {
                e.context && (e.context = e.context.prev);
            }
            function d(e, t) {
                for (var n; ; ) {
                    if (!e.context)
                        return;
                    if (n = e.context.tagName,
                    !a.contextGrabbers.hasOwnProperty(n) || !a.contextGrabbers[n].hasOwnProperty(t))
                        return;
                    h(e);
                }
            }
            function p(e, t, n) {
                return "openTag" == e ? (n.tagStart = t.column(),
                g) : "closeTag" == e ? m : p;
            }
            function g(e, t, n) {
                return "word" == e ? (n.tagName = t.current(),
                o = "tag",
                b) : (o = "error",
                g);
            }
            function m(e, t, n) {
                if ("word" == e) {
                    var r = t.current();
                    return n.context && n.context.tagName != r && a.implicitlyClosed.hasOwnProperty(n.context.tagName) && h(n),
                    n.context && n.context.tagName == r || !1 === a.matchClosing ? (o = "tag",
                    v) : (o = "tag error",
                    y);
                }
                return o = "error",
                y;
            }
            function v(e, t, n) {
                return "endTag" != e ? (o = "error",
                v) : (h(n),
                p);
            }
            function y(e, t, n) {
                return o = "error",
                v(e, 0, n);
            }
            function b(e, t, n) {
                if ("word" == e)
                    return o = "attribute",
                    w;
                if ("endTag" == e || "selfcloseTag" == e) {
                    var r = n.tagName
                      , i = n.tagStart;
                    return n.tagName = n.tagStart = null,
                    "selfcloseTag" == e || a.autoSelfClosers.hasOwnProperty(r) ? d(n, r) : (d(n, r),
                    n.context = new f(n,r,i == n.indented)),
                    p;
                }
                return o = "error",
                b;
            }
            function w(e, t, n) {
                return "equals" == e ? x : (a.allowMissing || (o = "error"),
                b(e, 0, n));
            }
            function x(e, t, n) {
                return "string" == e ? C : "word" == e && a.allowUnquoted ? (o = "string",
                b) : (o = "error",
                b(e, 0, n));
            }
            function C(e, t, n) {
                return "string" == e ? C : b(e, 0, n);
            }
            return c.isInText = !0,
            {
                startState: function(e) {
                    var t = {
                        tokenize: c,
                        state: p,
                        indented: e || 0,
                        tagName: null,
                        tagStart: null,
                        context: null
                    };
                    return null != e && (t.baseIndent = e),
                    t;
                },
                token: function(e, t) {
                    if (!t.tagName && e.sol() && (t.indented = e.indentation()),
                    e.eatSpace())
                        return null;
                    l = null;
                    var n = t.tokenize(e, t);
                    return (n || l) && "comment" != n && (o = null,
                    t.state = t.state(l || n, e, t),
                    o && (n = "error" == o ? n + " error" : o)),
                    n;
                },
                indent: function(e, t, n) {
                    var r = e.context;
                    if (e.tokenize.isInAttribute)
                        return e.tagStart == e.indented ? e.stringStartCol + 1 : e.indented + s;
                    if (r && r.noIndent)
                        return S.Pass;
                    if (e.tokenize != u && e.tokenize != c)
                        return n ? n.match(/^(\s*)/)[0].length : 0;
                    if (e.tagName)
                        return !1 !== a.multilineTagIndentPastTag ? e.tagStart + e.tagName.length + 2 : e.tagStart + s * (a.multilineTagIndentFactor || 1);
                    if (a.alignCDATA && /<!\[CDATA\[/.test(t))
                        return 0;
                    var i = t && /^<(\/)?([\w_:\.-]*)/.exec(t);
                    if (i && i[1])
                        for (; r; ) {
                            if (r.tagName == i[2]) {
                                r = r.prev;
                                break;
                            }
                            if (!a.implicitlyClosed.hasOwnProperty(r.tagName))
                                break;
                            r = r.prev;
                        }
                    else if (i)
                        for (; r; ) {
                            var o = a.contextGrabbers[r.tagName];
                            if (!o || !o.hasOwnProperty(i[2]))
                                break;
                            r = r.prev;
                        }
                    for (; r && r.prev && !r.startOfLine; )
                        r = r.prev;
                    return r ? r.indent + s : e.baseIndent || 0;
                },
                electricInput: /<\/[\s\w:]+>$/,
                blockCommentStart: "\x3c!--",
                blockCommentEnd: "--\x3e",
                configuration: a.htmlMode ? "html" : "xml",
                helperType: a.htmlMode ? "html" : "xml",
                skipAttribute: function(e) {
                    e.state == x && (e.state = b);
                }
            };
        }),
        S.defineMIME("text/xml", "xml"),
        S.defineMIME("application/xml", "xml"),
        S.mimeModes.hasOwnProperty("text/html") || S.defineMIME("text/html", {
            name: "xml",
            htmlMode: !0
        });
    }(CodeMirror),
    function(p) {
        "use strict";
        var i = {
            script: [["lang", /(javascript|babel)/i, "javascript"], ["type", /^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i, "javascript"], ["type", /./, "text/plain"], [null, null, "javascript"]],
            style: [["lang", /^css$/i, "css"], ["type", /^(text\/)?(x-)?(stylesheet|css)$/i, "css"], ["type", /./, "text/plain"], [null, null, "css"]]
        };
        var o = {};
        function g(e, t) {
            var n, r = e.match(o[n = t] || (o[n] = new RegExp("\\s+" + n + "\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*")));
            return r ? r[2] : "";
        }
        function m(e, t) {
            return new RegExp((t ? "^" : "") + "</s*" + e + "s*>","i");
        }
        function l(e, t) {
            for (var n in e)
                for (var r = t[n] || (t[n] = []), i = e[n], o = i.length - 1; 0 <= o; o--)
                    r.unshift(i[o]);
        }
        p.defineMode("htmlmixed", function(u, e) {
            var f = p.getMode(u, {
                name: "xml",
                htmlMode: !0,
                multilineTagIndentFactor: e.multilineTagIndentFactor,
                multilineTagIndentPastTag: e.multilineTagIndentPastTag
            })
              , h = {}
              , t = e && e.tags
              , n = e && e.scriptTypes;
            if (l(i, h),
            t && l(t, h),
            n)
                for (var r = n.length - 1; 0 <= r; r--)
                    h.script.unshift(["type", n[r].matches, n[r].mode]);
            function d(e, t) {
                var n, r = f.token(e, t.htmlState), i = /\btag\b/.test(r);
                if (i && !/[<>\s\/]/.test(e.current()) && (n = t.htmlState.tagName && t.htmlState.tagName.toLowerCase()) && h.hasOwnProperty(n))
                    t.inTag = n + " ";
                else if (t.inTag && i && />$/.test(e.current())) {
                    var o = /^([\S]+) (.*)/.exec(t.inTag);
                    t.inTag = null;
                    var l = ">" == e.current() && function(e, t) {
                        for (var n = 0; n < e.length; n++) {
                            var r = e[n];
                            if (!r[0] || r[1].test(g(t, r[0])))
                                return r[2];
                        }
                    }(h[o[1]], o[2])
                      , s = p.getMode(u, l)
                      , a = m(o[1], !0)
                      , c = m(o[1], !1);
                    t.token = function(e, t) {
                        return e.match(a, !1) ? (t.token = d,
                        t.localState = t.localMode = null,
                        null) : (n = e,
                        r = c,
                        i = t.localMode.token(e, t.localState),
                        o = n.current(),
                        -1 < (l = o.search(r)) ? n.backUp(o.length - l) : o.match(/<\/?$/) && (n.backUp(o.length),
                        n.match(r, !1) || n.match(o)),
                        i);
                        var n, r, i, o, l;
                    }
                    ,
                    t.localMode = s,
                    t.localState = p.startState(s, f.indent(t.htmlState, ""));
                } else
                    t.inTag && (t.inTag += e.current(),
                    e.eol() && (t.inTag += " "));
                return r;
            }
            return {
                startState: function() {
                    return {
                        token: d,
                        inTag: null,
                        localMode: null,
                        localState: null,
                        htmlState: f.startState()
                    };
                },
                copyState: function(e) {
                    var t;
                    return e.localState && (t = p.copyState(e.localMode, e.localState)),
                    {
                        token: e.token,
                        inTag: e.inTag,
                        localMode: e.localMode,
                        localState: t,
                        htmlState: p.copyState(f, e.htmlState)
                    };
                },
                token: function(e, t) {
                    return t.token(e, t);
                },
                indent: function(e, t) {
                    return !e.localMode || /^\s*<\//.test(t) ? f.indent(e.htmlState, t) : e.localMode.indent ? e.localMode.indent(e.localState, t) : p.Pass;
                },
                innerMode: function(e) {
                    return {
                        state: e.localState || e.htmlState,
                        mode: e.localMode || f
                    };
                }
            };
        }, "xml", "javascript", "css"),
        p.defineMIME("text/html", "htmlmixed");
    }(CodeMirror),
    function(f) {
        "use strict";
        var e = f.keyMap.sublime = {
            fallthrough: "default"
        }
          , t = f.commands
          , h = f.Pos
          , n = f.keyMap.default == f.keyMap.macDefault
          , r = n ? "Cmd-" : "Ctrl-";
        function i(t, n) {
            t.extendSelectionsBy(function(e) {
                return t.display.shift || t.doc.extend || e.empty() ? function(e, t, n) {
                    if (n < 0 && 0 == t.ch)
                        return e.clipPos(h(t.line - 1));
                    var r = e.getLine(t.line);
                    if (0 < n && t.ch >= r.length)
                        return e.clipPos(h(t.line + 1, 0));
                    for (var i, o = "start", l = t.ch, s = n < 0 ? 0 : r.length, a = 0; l != s; l += n,
                    a++) {
                        var c = r.charAt(n < 0 ? l - 1 : l)
                          , u = "_" != c && f.isWordChar(c) ? "w" : "o";
                        if ("w" == u && c.toUpperCase() == c && (u = "W"),
                        "start" == o)
                            "o" != u && (o = "in",
                            i = u);
                        else if ("in" == o && i != u) {
                            if ("w" == i && "W" == u && n < 0 && l--,
                            "W" == i && "w" == u && 0 < n) {
                                i = "w";
                                continue;
                            }
                            break;
                        }
                    }
                    return h(t.line, l);
                }(t.doc, e.head, n) : n < 0 ? e.from() : e.to();
            });
        }
        t[e["Alt-Left"] = "goSubwordLeft"] = function(e) {
            i(e, -1);
        }
        ,
        t[e["Alt-Right"] = "goSubwordRight"] = function(e) {
            i(e, 1);
        }
        ;
        var o = n ? "Ctrl-Alt-" : "Ctrl-";
        function l(l, s) {
            if (l.isReadOnly())
                return f.Pass;
            l.operation(function() {
                for (var e = l.listSelections().length, t = [], n = -1, r = 0; r < e; r++) {
                    var i = l.listSelections()[r].head;
                    if (!(i.line <= n)) {
                        var o = h(i.line + (s ? 0 : 1), 0);
                        l.replaceRange("\n", o, null, "+insertLine"),
                        l.indentLine(o.line, null, !0),
                        t.push({
                            head: o,
                            anchor: o
                        }),
                        n = i.line + 1;
                    }
                }
                l.setSelections(t);
            });
        }
        function c(e, t) {
            for (var n = t.ch, r = n, i = e.getLine(t.line); n && f.isWordChar(i.charAt(n - 1)); )
                --n;
            for (; r < i.length && f.isWordChar(i.charAt(r)); )
                ++r;
            return {
                from: h(t.line, n),
                to: h(t.line, r),
                word: i.slice(n, r)
            };
        }
        t[e[o + "Up"] = "scrollLineUp"] = function(e) {
            var t = e.getScrollInfo();
            if (!e.somethingSelected()) {
                var n = e.lineAtHeight(t.top + t.clientHeight, "local");
                e.getCursor().line >= n && e.execCommand("goLineUp");
            }
            e.scrollTo(null, t.top - e.defaultTextHeight());
        }
        ,
        t[e[o + "Down"] = "scrollLineDown"] = function(e) {
            var t = e.getScrollInfo();
            if (!e.somethingSelected()) {
                var n = e.lineAtHeight(t.top, "local") + 1;
                e.getCursor().line <= n && e.execCommand("goLineDown");
            }
            e.scrollTo(null, t.top + e.defaultTextHeight());
        }
        ,
        t[e["Shift-" + r + "L"] = "splitSelectionByLine"] = function(e) {
            for (var t = e.listSelections(), n = [], r = 0; r < t.length; r++)
                for (var i = t[r].from(), o = t[r].to(), l = i.line; l <= o.line; ++l)
                    o.line > i.line && l == o.line && 0 == o.ch || n.push({
                        anchor: l == i.line ? i : h(l, 0),
                        head: l == o.line ? o : h(l)
                    });
            e.setSelections(n, 0);
        }
        ,
        e["Shift-Tab"] = "indentLess",
        t[e.Esc = "singleSelectionTop"] = function(e) {
            var t = e.listSelections()[0];
            e.setSelection(t.anchor, t.head, {
                scroll: !1
            });
        }
        ,
        t[e[r + "L"] = "selectLine"] = function(e) {
            for (var t = e.listSelections(), n = [], r = 0; r < t.length; r++) {
                var i = t[r];
                n.push({
                    anchor: h(i.from().line, 0),
                    head: h(i.to().line + 1, 0)
                });
            }
            e.setSelections(n);
        }
        ,
        e["Shift-Ctrl-K"] = "deleteLine",
        t[e[r + "Enter"] = "insertLineAfter"] = function(e) {
            return l(e, !1);
        }
        ,
        t[e["Shift-" + r + "Enter"] = "insertLineBefore"] = function(e) {
            return l(e, !0);
        }
        ,
        t[e[r + "D"] = "selectNextOccurrence"] = function(e) {
            var t = e.getCursor("from")
              , n = e.getCursor("to")
              , r = e.state.sublimeFindFullWord == e.doc.sel;
            if (0 == f.cmpPos(t, n)) {
                var i = c(e, t);
                if (!i.word)
                    return;
                e.setSelection(i.from, i.to),
                r = !0;
            } else {
                var o = e.getRange(t, n)
                  , l = r ? new RegExp("\\b" + o + "\\b") : o
                  , s = e.getSearchCursor(l, n);
                s.findNext() ? e.addSelection(s.from(), s.to()) : (s = e.getSearchCursor(l, h(e.firstLine(), 0))).findNext() && e.addSelection(s.from(), s.to());
            }
            r && (e.state.sublimeFindFullWord = e.doc.sel);
        }
        ;
        function s(e) {
            var t = e.getCursor()
              , n = e.scanForBracket(t, -1);
            if (n)
                for (; ; ) {
                    var r = e.scanForBracket(t, 1);
                    if (!r)
                        return;
                    if (r.ch == "(){}[]".charAt("(){}[]".indexOf(n.ch) + 1))
                        return e.setSelection(h(n.pos.line, n.pos.ch + 1), r.pos, !1),
                        !0;
                    t = h(r.pos.line, r.pos.ch + 1);
                }
        }
        t[e["Shift-" + r + "Space"] = "selectScope"] = function(e) {
            s(e) || e.execCommand("selectAll");
        }
        ,
        t[e["Shift-" + r + "M"] = "selectBetweenBrackets"] = function(e) {
            if (!s(e))
                return f.Pass;
        }
        ,
        t[e[r + "M"] = "goToBracket"] = function(r) {
            r.extendSelectionsBy(function(e) {
                var t = r.scanForBracket(e.head, 1);
                if (t && 0 != f.cmpPos(t.pos, e.head))
                    return t.pos;
                var n = r.scanForBracket(e.head, -1);
                return n && h(n.pos.line, n.pos.ch + 1) || e.head;
            });
        }
        ;
        var a = n ? "Cmd-Ctrl-" : "Shift-Ctrl-";
        function u(s, a) {
            if (s.isReadOnly())
                return f.Pass;
            for (var c, e = s.listSelections(), u = [], t = 0; t < e.length; t++) {
                var n = e[t];
                if (!n.empty()) {
                    for (var r = n.from().line, i = n.to().line; t < e.length - 1 && e[t + 1].from().line == i; )
                        i = n[++t].to().line;
                    u.push(r, i);
                }
            }
            u.length ? c = !0 : u.push(s.firstLine(), s.lastLine()),
            s.operation(function() {
                for (var e = [], t = 0; t < u.length; t += 2) {
                    var n = u[t]
                      , r = u[t + 1]
                      , i = h(n, 0)
                      , o = h(r)
                      , l = s.getRange(i, o, !1);
                    a ? l.sort() : l.sort(function(e, t) {
                        var n = e.toUpperCase()
                          , r = t.toUpperCase();
                        return n != r && (e = n,
                        t = r),
                        e < t ? -1 : e == t ? 0 : 1;
                    }),
                    s.replaceRange(l, i, o),
                    c && e.push({
                        anchor: i,
                        head: o
                    });
                }
                c && s.setSelections(e, 0);
            });
        }
        t[e[a + "Up"] = "swapLineUp"] = function(i) {
            if (i.isReadOnly())
                return f.Pass;
            for (var e = i.listSelections(), o = [], t = i.firstLine() - 1, l = [], n = 0; n < e.length; n++) {
                var r = e[n]
                  , s = r.from().line - 1
                  , a = r.to().line;
                l.push({
                    anchor: h(r.anchor.line - 1, r.anchor.ch),
                    head: h(r.head.line - 1, r.head.ch)
                }),
                0 != r.to().ch || r.empty() || --a,
                t < s ? o.push(s, a) : o.length && (o[o.length - 1] = a),
                t = a;
            }
            i.operation(function() {
                for (var e = 0; e < o.length; e += 2) {
                    var t = o[e]
                      , n = o[e + 1]
                      , r = i.getLine(t);
                    i.replaceRange("", h(t, 0), h(t + 1, 0), "+swapLine"),
                    n > i.lastLine() ? i.replaceRange("\n" + r, h(i.lastLine()), null, "+swapLine") : i.replaceRange(r + "\n", h(n, 0), null, "+swapLine");
                }
                i.setSelections(l),
                i.scrollIntoView();
            });
        }
        ,
        t[e[a + "Down"] = "swapLineDown"] = function(i) {
            if (i.isReadOnly())
                return f.Pass;
            for (var e = i.listSelections(), o = [], t = i.lastLine() + 1, n = e.length - 1; 0 <= n; n--) {
                var r = e[n]
                  , l = r.to().line + 1
                  , s = r.from().line;
                0 != r.to().ch || r.empty() || l--,
                l < t ? o.push(l, s) : o.length && (o[o.length - 1] = s),
                t = s;
            }
            i.operation(function() {
                for (var e = o.length - 2; 0 <= e; e -= 2) {
                    var t = o[e]
                      , n = o[e + 1]
                      , r = i.getLine(t);
                    t == i.lastLine() ? i.replaceRange("", h(t - 1), h(t), "+swapLine") : i.replaceRange("", h(t, 0), h(t + 1, 0), "+swapLine"),
                    i.replaceRange(r + "\n", h(n, 0), null, "+swapLine");
                }
                i.scrollIntoView();
            });
        }
        ,
        t[e[r + "/"] = "toggleCommentIndented"] = function(e) {
            e.toggleComment({
                indent: !0
            });
        }
        ,
        t[e[r + "J"] = "joinLines"] = function(a) {
            for (var e = a.listSelections(), c = [], t = 0; t < e.length; t++) {
                for (var n = e[t], r = n.from(), i = r.line, o = n.to().line; t < e.length - 1 && e[t + 1].from().line == o; )
                    o = e[++t].to().line;
                c.push({
                    start: i,
                    end: o,
                    anchor: !n.empty() && r
                });
            }
            a.operation(function() {
                for (var e = 0, t = [], n = 0; n < c.length; n++) {
                    for (var r, i = c[n], o = i.anchor && h(i.anchor.line - e, i.anchor.ch), l = i.start; l <= i.end; l++) {
                        var s = l - e;
                        l == i.end && (r = h(s, a.getLine(s).length + 1)),
                        s < a.lastLine() && (a.replaceRange(" ", h(s), h(s + 1, /^\s*/.exec(a.getLine(s + 1))[0].length)),
                        ++e);
                    }
                    t.push({
                        anchor: o || r,
                        head: r
                    });
                }
                a.setSelections(t, 0);
            });
        }
        ,
        t[e["Shift-" + r + "D"] = "duplicateLine"] = function(r) {
            r.operation(function() {
                for (var e = r.listSelections().length, t = 0; t < e; t++) {
                    var n = r.listSelections()[t];
                    n.empty() ? r.replaceRange(r.getLine(n.head.line) + "\n", h(n.head.line, 0)) : r.replaceRange(r.getRange(n.from(), n.to()), n.from());
                }
                r.scrollIntoView();
            });
        }
        ,
        e[r + "T"] = "transposeChars",
        t[e.F9 = "sortLines"] = function(e) {
            u(e, !0);
        }
        ,
        t[e[r + "F9"] = "sortLinesInsensitive"] = function(e) {
            u(e, !1);
        }
        ,
        t[e.F2 = "nextBookmark"] = function(e) {
            var t = e.state.sublimeBookmarks;
            if (t)
                for (; t.length; ) {
                    var n = t.shift()
                      , r = n.find();
                    if (r)
                        return t.push(n),
                        e.setSelection(r.from, r.to);
                }
        }
        ,
        t[e["Shift-F2"] = "prevBookmark"] = function(e) {
            var t = e.state.sublimeBookmarks;
            if (t)
                for (; t.length; ) {
                    t.unshift(t.pop());
                    var n = t[t.length - 1].find();
                    if (n)
                        return e.setSelection(n.from, n.to);
                    t.pop();
                }
        }
        ,
        t[e[r + "F2"] = "toggleBookmark"] = function(e) {
            for (var t = e.listSelections(), n = e.state.sublimeBookmarks || (e.state.sublimeBookmarks = []), r = 0; r < t.length; r++) {
                for (var i = t[r].from(), o = t[r].to(), l = e.findMarks(i, o), s = 0; s < l.length; s++)
                    if (l[s].sublimeBookmark) {
                        l[s].clear();
                        for (var a = 0; a < n.length; a++)
                            n[a] == l[s] && n.splice(a--, 1);
                        break;
                    }
                s == l.length && n.push(e.markText(i, o, {
                    sublimeBookmark: !0,
                    clearWhenEmpty: !1
                }));
            }
        }
        ,
        t[e["Shift-" + r + "F2"] = "clearBookmarks"] = function(e) {
            var t = e.state.sublimeBookmarks;
            if (t)
                for (var n = 0; n < t.length; n++)
                    t[n].clear();
            t.length = 0;
        }
        ,
        t[e["Alt-F2"] = "selectBookmarks"] = function(e) {
            var t = e.state.sublimeBookmarks
              , n = [];
            if (t)
                for (var r = 0; r < t.length; r++) {
                    var i = t[r].find();
                    i ? n.push({
                        anchor: i.from,
                        head: i.to
                    }) : t.splice(r--, 0);
                }
            n.length && e.setSelections(n, 0);
        }
        ,
        e["Alt-Q"] = "wrapLines";
        var d = r + "K ";
        function p(s, a) {
            s.operation(function() {
                for (var e = s.listSelections(), t = [], n = [], r = 0; r < e.length; r++) {
                    (o = e[r]).empty() ? (t.push(r),
                    n.push("")) : n.push(a(s.getRange(o.from(), o.to())));
                }
                s.replaceSelections(n, "around", "case");
                var i;
                for (r = t.length - 1; 0 <= r; r--) {
                    var o = e[t[r]];
                    if (!(i && 0 < f.cmpPos(o.head, i))) {
                        var l = c(s, o.head);
                        i = l.from,
                        s.replaceRange(a(l.word), l.from, l.to);
                    }
                }
            });
        }
        function g(e) {
            var t = e.getCursor("from")
              , n = e.getCursor("to");
            if (0 == f.cmpPos(t, n)) {
                var r = c(e, t);
                if (!r.word)
                    return;
                t = r.from,
                n = r.to;
            }
            return {
                from: t,
                to: n,
                query: e.getRange(t, n),
                word: r
            };
        }
        function m(e, t) {
            var n = g(e);
            if (n) {
                var r = n.query
                  , i = e.getSearchCursor(r, t ? n.to : n.from);
                (t ? i.findNext() : i.findPrevious()) ? e.setSelection(i.from(), i.to()) : (i = e.getSearchCursor(r, t ? h(e.firstLine(), 0) : e.clipPos(h(e.lastLine()))),
                (t ? i.findNext() : i.findPrevious()) ? e.setSelection(i.from(), i.to()) : n.word && e.setSelection(n.from, n.to));
            }
        }
        e[d + r + "Backspace"] = "delLineLeft",
        t[e.Backspace = "smartBackspace"] = function(e) {
            if (e.somethingSelected())
                return f.Pass;
            var t = e.getCursor()
              , n = e.getRange({
                line: t.line,
                ch: 0
            }, t)
              , r = f.countColumn(n, null, e.getOption("tabSize"))
              , i = e.getOption("indentUnit");
            if (n && !/\S/.test(n) && r % i == 0) {
                var o = new h(t.line,f.findColumn(n, r - i, i));
                return o.ch == t.ch ? f.Pass : e.replaceRange("", o, t, "+delete");
            }
            return f.Pass;
        }
        ,
        t[e[d + r + "K"] = "delLineRight"] = function(n) {
            n.operation(function() {
                for (var e = n.listSelections(), t = e.length - 1; 0 <= t; t--)
                    n.replaceRange("", e[t].anchor, h(e[t].to().line), "+delete");
                n.scrollIntoView();
            });
        }
        ,
        t[e[d + r + "U"] = "upcaseAtCursor"] = function(e) {
            p(e, function(e) {
                return e.toUpperCase();
            });
        }
        ,
        t[e[d + r + "L"] = "downcaseAtCursor"] = function(e) {
            p(e, function(e) {
                return e.toLowerCase();
            });
        }
        ,
        t[e[d + r + "Space"] = "setSublimeMark"] = function(e) {
            e.state.sublimeMark && e.state.sublimeMark.clear(),
            e.state.sublimeMark = e.setBookmark(e.getCursor());
        }
        ,
        t[e[d + r + "A"] = "selectToSublimeMark"] = function(e) {
            var t = e.state.sublimeMark && e.state.sublimeMark.find();
            t && e.setSelection(e.getCursor(), t);
        }
        ,
        t[e[d + r + "W"] = "deleteToSublimeMark"] = function(e) {
            var t = e.state.sublimeMark && e.state.sublimeMark.find();
            if (t) {
                var n = e.getCursor()
                  , r = t;
                if (0 < f.cmpPos(n, r)) {
                    var i = r;
                    r = n,
                    n = i;
                }
                e.state.sublimeKilled = e.getRange(n, r),
                e.replaceRange("", n, r);
            }
        }
        ,
        t[e[d + r + "X"] = "swapWithSublimeMark"] = function(e) {
            var t = e.state.sublimeMark && e.state.sublimeMark.find();
            t && (e.state.sublimeMark.clear(),
            e.state.sublimeMark = e.setBookmark(e.getCursor()),
            e.setCursor(t));
        }
        ,
        t[e[d + r + "Y"] = "sublimeYank"] = function(e) {
            null != e.state.sublimeKilled && e.replaceSelection(e.state.sublimeKilled, null, "paste");
        }
        ,
        e[d + r + "G"] = "clearBookmarks",
        t[e[d + r + "C"] = "showInCenter"] = function(e) {
            var t = e.cursorCoords(null, "local");
            e.scrollTo(null, (t.top + t.bottom) / 2 - e.getScrollInfo().clientHeight / 2);
        }
        ,
        t[e["Shift-Alt-Up"] = "selectLinesUpward"] = function(r) {
            r.operation(function() {
                for (var e = r.listSelections(), t = 0; t < e.length; t++) {
                    var n = e[t];
                    n.head.line > r.firstLine() && r.addSelection(h(n.head.line - 1, n.head.ch));
                }
            });
        }
        ,
        t[e["Shift-Alt-Down"] = "selectLinesDownward"] = function(r) {
            r.operation(function() {
                for (var e = r.listSelections(), t = 0; t < e.length; t++) {
                    var n = e[t];
                    n.head.line < r.lastLine() && r.addSelection(h(n.head.line + 1, n.head.ch));
                }
            });
        }
        ,
        t[e[r + "F3"] = "findUnder"] = function(e) {
            m(e, !0);
        }
        ,
        t[e["Shift-" + r + "F3"] = "findUnderPrevious"] = function(e) {
            m(e, !1);
        }
        ,
        t[e["Alt-F3"] = "findAllUnder"] = function(e) {
            var t = g(e);
            if (t) {
                for (var n = e.getSearchCursor(t.query), r = [], i = -1; n.findNext(); )
                    r.push({
                        anchor: n.from(),
                        head: n.to()
                    }),
                    n.from().line <= t.from.line && n.from().ch <= t.from.ch && i++;
                e.setSelections(r, i);
            }
        }
        ,
        e["Shift-" + r + "["] = "fold",
        e["Shift-" + r + "]"] = "unfold",
        e[d + r + "0"] = e[d + r + "j"] = "unfoldAll",
        e[r + "I"] = "findIncremental",
        e["Shift-" + r + "I"] = "findIncrementalReverse",
        e[r + "H"] = "replace",
        e.F3 = "findNext",
        e["Shift-F3"] = "findPrev",
        f.normalizeKeyMap(e);
    }(CodeMirror);
    var t = window.CodeMirror;
    return window.CodeMirror = e,
    t;
});
